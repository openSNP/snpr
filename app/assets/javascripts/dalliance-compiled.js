var BAM_MAGIC=21840194,BAI_MAGIC=21578050;function BamFile(){}function Vob(a,b){this.block=a;this.offset=b}Vob.prototype.toString=function(){return""+this.block+":"+this.offset};function Chunk(a,b){this.minv=a;this.maxv=b}
function makeBam(a,b,c){var d=new BamFile;d.data=a;d.bai=b;d.data.slice(0,65536).fetch(function(e){if(!e)return dlog("Couldn't access BAM");e=unbgzf(e);e=new Uint8Array(e);readInt(e,0);for(var f=readInt(e,4),i="",h=0;h<f;++h)i+=String.fromCharCode(e[h+8]);i=readInt(e,f+8);f=f+12;d.chrToIndex={};d.indexToChr=[];for(h=0;h<i;++h){for(var j=readInt(e,f),l="",p=0;p<j-1;++p)l+=String.fromCharCode(e[f+4+p]);readInt(e,f+j+4);d.chrToIndex[l]=h;if(l.indexOf("chr")==0)d.chrToIndex[l.substring(3)]=h;else d.chrToIndex["chr"+
l]=h;d.indexToChr.push(l);f=f+8+j}if(d.indices)return c(d)});d.bai.fetch(function(e){if(!e)return dlog("Couldn't access BAI");var f=new Uint8Array(e);if(readInt(f,0)!=BAI_MAGIC)return dlog("Not a BAI file");var i=readInt(f,4);d.indices=[];for(var h=8,j=0;j<i;++j){var l=h,p=readInt(f,h);h+=4;for(var m=0;m<p;++m){readInt(f,h);var r=readInt(f,h+4);h+=8+r*16}m=readInt(f,h);h+=4;h+=m*8;if(p>0)d.indices[j]=new Uint8Array(e,l,h-l)}if(d.chrToIndex)return c(d)})}
BamFile.prototype.blocksForRange=function(a,b,c){var d=this.indices[a];if(!d)return[];a=reg2bins(b,c);for(var e=[],f=0;f<a.length;++f)e[a[f]]=true;a=[];var i=[];f=readInt(d,0);for(var h=4,j=0;j<f;++j){var l=readInt(d,h),p=readInt(d,h+4);h+=8;if(e[l])for(var m=0;m<p;++m){var r=readVob(d,h),s=readVob(d,h+8);(l<4681?i:a).push(new Chunk(r,s));h+=16}else h+=p*16}f=readInt(d,h);e=null;b=Math.min(b>>14,f-1);c=Math.min(c>>14,f-1);for(f=b;f<=c;++f)if(b=readVob(d,h+4+f*8))if(!e||b.block<e.block||b.offset<e.offset)e=
b;d=[];if(e!=null)for(f=0;f<i.length;++f){c=i[f];c.maxv.block>=e.block&&c.maxv.offset>=e.offset&&d.push(c)}i=d;d=[];for(f=0;f<i.length;++f)d.push(i[f]);for(f=0;f<a.length;++f)d.push(a[f]);d.sort(function(o,q){var t=o.minv.block-q.minv.block;return t!=0?t:o.minv.offset-q.minv.offset});a=[];if(d.length>0){i=d[0];for(f=1;f<d.length;++f){c=d[f];if(c.minv.block==i.maxv.block)i=new Chunk(i.minv,c.maxv);else{a.push(i);i=c}}a.push(i)}return a};
BamFile.prototype.fetch=function(a,b,c,d){function e(){if(l>=h.length)return d(j);else if(p){var m=new Uint8Array(p);f.readBamRecords(m,h[l].minv.offset,j,b,c,i);p=null;++l;return e()}else{var r=h[l];m=r.minv.block;f.data.slice(m,r.maxv.block+65536-m).fetch(function(s){p=unbgzf(s,r.maxv.block-r.minv.block+1);return e()})}}var f=this,i=this.chrToIndex[a],h;if(i===undefined)h=[];else(h=this.blocksForRange(i,b,c))||d(null,"Error in index fetch");var j=[],l=0,p;e()};
var SEQRET_DECODER=["=","A","C","x","G","x","x","x","T","x","x","x","x","x","x","N"],CIGAR_DECODER=["M","I","D","N","S","H","P","=","X","?","?","?","?","?","?","?"];function BamRecord(){}
BamFile.prototype.readBamRecords=function(a,b,c,d,e,f){for(;;){var i=readInt(a,b);i=b+i+4;if(i>=a.length)return c;var h=new BamRecord,j=readInt(a,b+4),l=readInt(a,b+8),p=readInt(a,b+12),m=(p&65280)>>8,r=p&255,s=readInt(a,b+16)&65535;p=readInt(a,b+20);readInt(a,b+24);readInt(a,b+28);readInt(a,b+32);for(var o="",q=0;q<r-1;++q)o+=String.fromCharCode(a[b+36+q]);b=b+36+r;q="";for(r=0;r<s;++r){var t=readInt(a,b);q=q+(t>>4)+CIGAR_DECODER[t&15];b+=4}h.cigar=q;s="";r=p+1>>1;for(q=0;q<r;++q){t=a[b+q];s+=SEQRET_DECODER[(t&
240)>>4];s+=SEQRET_DECODER[t&15]}b+=r;h.seq=s;s="";for(q=0;q<p;++q)s+=String.fromCharCode(a[b+q]);b+=p;h.quals=s;h.pos=l;h.mq=m;h.readName=o;for(h.segment=this.indexToChr[j];b<i;){l=String.fromCharCode(a[b])+String.fromCharCode(a[b+1]);m=String.fromCharCode(a[b+2]);if(m=="A"){m=String.fromCharCode(a[b+3]);b+=4}else if(m=="i"||m=="I"){m=readInt(a,b+3);b+=7}else if(m=="c"||m=="C"){m=a[b+3];b+=4}else if(m=="s"||m=="S"){m=readShort(a,b+3);b+=5}else if(m=="f")throw"FIXME need floats";else if(m=="Z"){b+=
3;for(m="";;){o=a[b++];if(o==0)break;else m+=String.fromCharCode(o)}}else throw"Unknown type "+m;h[l]=m}if(!d||h.pos<=e&&h.pos+p>=d)if(f===undefined||j==f)c.push(h);b=i}};function readInt(a,b){return a[b+3]<<24|a[b+2]<<16|a[b+1]<<8|a[b]}function readShort(a,b){return a[b+1]<<8|a[b]}function readVob(a,b){var c=(a[b+6]&255)*4294967296+(a[b+5]&255)*16777216+(a[b+4]&255)*65536+(a[b+3]&255)*256+(a[b+2]&255),d=a[b+1]<<8|a[b];return c==0&&d==0?null:new Vob(c,d)}
function unbgzf(a,b){b=Math.min(b||1,a.byteLength-100);for(var c=[],d=[0],e=0;d[0]<b;){var f=new Uint8Array(a,d[0],100);f=f[11]<<8|f[10];f=jszlib_inflate_buffer(a,12+f+d[0],Math.min(65536,a.byteLength-12-f-d[0]),d);d[0]+=8;e+=f.byteLength;c.push(f)}if(c.length==1)return c[0];else{d=new Uint8Array(e);for(f=e=0;f<c.length;++f){var i=new Uint8Array(c[f]);arrayCopy(i,0,d,e,i.length);e+=i.length}return d.buffer}}
function reg2bin(a,b){--b;if(a>>14==b>>14)return 4681+(a>>14);if(a>>17==b>>17)return 585+(a>>17);if(a>>20==b>>20)return 73+(a>>20);if(a>>23==b>>23)return 9+(a>>23);if(a>>26==b>>26)return 1+(a>>26);return 0}var MAX_BIN=37449;
function reg2bins(a,b){var c,d=[];--b;d.push(0);for(c=1+(a>>26);c<=1+(b>>26);++c)d.push(c);for(c=9+(a>>23);c<=9+(b>>23);++c)d.push(c);for(c=73+(a>>20);c<=73+(b>>20);++c)d.push(c);for(c=585+(a>>17);c<=585+(b>>17);++c)d.push(c);for(c=4681+(a>>14);c<=4681+(b>>14);++c)d.push(c);return d}var BIG_WIG_MAGIC=-2003829722,BIG_BED_MAGIC=-2021002517,BIG_WIG_TYPE_GRAPH=1,BIG_WIG_TYPE_VSTEP=2,BIG_WIG_TYPE_FSTEP=3;function BigWig(){}
BigWig.prototype.readChromTree=function(a){var b=this;this.chromsToIDs={};this.idsToChroms={};for(var c=this.unzoomedDataOffset;c%4!=0;)++c;this.data.slice(this.chromTreeOffset,c-this.chromTreeOffset).fetch(function(d){var e=new Uint8Array(d),f=new Int16Array(d),i=new Int32Array(d),h=i[2],j=function(l){var p=e[l],m=f[l/2+1];l+=4;for(var r=0;r<m;++r)if(p==0){l+=h;var s=i[l/4]<<32|i[l/4+1];l+=8;s-=b.chromTreeOffset;j(s)}else{s="";for(var o=0;o<h;++o){var q=e[l++];if(q!=0)s+=String.fromCharCode(q)}o=
e[l+3]<<24|e[l+2]<<16|e[l+1]<<8|e[l+0];l+=8;b.chromsToIDs[s]=o;if(s.indexOf("chr")==0)b.chromsToIDs[s.substr(3)]=o;b.idsToChroms[o]=s}};j(32);a(b)})};function BigWigView(a,b,c,d){this.bwg=a;this.cirTreeOffset=b;this.cirTreeLength=c;this.isSummary=d}BED_COLOR_REGEXP=/^[0-9]+,[0-9]+,[0-9]+/;BigWigView.prototype.readWigData=function(a,b,c,d){a=this.bwg.chromsToIDs[a];if(a===undefined)return d([]);else this.readWigDataById(a,b,c,d)};
BigWigView.prototype.readWigDataById=function(a,b,c,d){var e=this;if(this.cirHeader){var f=[],i=0;Date.now();var h=function(p,m){i+=p.length;for(var r=4+e.cirBlockSize*32,s,o=0;o<p.length;++o){var q=new Range(p[o],Math.min(p[o]+r,e.cirTreeOffset+e.cirTreeLength));s=s?union(s,q):q}r=s.ranges();for(s=0;s<r.length;++s)j(p,r[s],m)},j=function(p,m,r){m.max();m.min();e.bwg.data.slice(m.min(),m.max()-m.min()).fetch(function(s){for(var o=0;o<p.length;++o)if(m.contains(p[o])){var q=s,t=p[o]-m.min(),v=r,u=
new Int8Array(q),x=new Int16Array(q);q=new Int32Array(q);u=u[t];x=x[t/2+1];t+=4;if(u!=0)for(u=0;u<x;++u){var y=t/4,A=q[y],F=q[y+1],D=q[y+2],z=q[y+3],E=q[y+4]<<32|q[y+5];v=q[y+6]<<32|q[y+7];if((A<a||A==a&&F<=c)&&(D>a||D==a&&z>=b))f.push({offset:E,size:v});t+=32}else{var C=[];for(u=0;u<x;++u){y=t/4;A=q[y];F=q[y+1];D=q[y+2];z=q[y+3];E=q[y+4]<<32|q[y+5];if((A<a||A==a&&F<=c)&&(D>a||D==a&&z>=b))C.push(E);t+=24}C.length>0&&h(C,v+1)}--i;i==0&&l()}})},l=function(){f.sort(function(o,q){return(o.offset|0)-(q.offset|
0)});if(f.length==0)d([]);else{var p=[],m=function(o,q,t){t||(t={});var v=new DASFeature;v.segment=e.bwg.idsToChroms[a];v.min=o;v.max=q;v.type="bigwig";for(k in t)v[k]=t[k];p.push(v)},r=function(o,q,t){o<=c&&q>=b&&m(o,q,t)},s=function(){if(f.length==0){Date.now();d(p)}else{var o=f[0];if(o.data){var q=new Uint8Array(o.data);if(e.isSummary){var t=new Int16Array(o.data),v=new Int32Array(o.data),u=new Float32Array(o.data);q=o.data.byteLength/32;for(t=0;t<q;++t){var x=v[t*8];o=v[t*8+1];var y=v[t*8+2],
A=v[t*8+3],F=u[t*8+6];if(x==a){x={type:"bigwig",score:F/A};if(e.bwg.type=="bigbed")x.type="density";r(o+1,y,x)}}}else if(e.bwg.type=="bigwig"){t=new Int16Array(o.data);v=new Int32Array(o.data);u=new Float32Array(o.data);x=v[0];o=v[1];x=v[3];y=v[4];A=q[20];q=t[11];if(A==BIG_WIG_TYPE_FSTEP)for(t=0;t<q;++t){A=u[t+6];r(o+t*x+1,o+t*x+y,{score:A})}else if(A==BIG_WIG_TYPE_VSTEP)for(t=0;t<q;++t){o=v[t*2+6];A=u[t*2+7];r(o+1,o+y,{score:A})}else if(A==BIG_WIG_TYPE_GRAPH)for(t=0;t<q;++t){o=v[t*3+6]+1;y=v[t*3+
7];A=u[t*3+8];if(o>y)o=y;r(o+1,y,{score:A})}else dlog("Currently not handling bwgType="+A)}else if(e.bwg.type=="bigbed")for(v=0;v<q.length;){x=q[v+3]<<24|q[v+2]<<16|q[v+1]<<8|q[v+0];o=q[v+7]<<24|q[v+6]<<16|q[v+5]<<8|q[v+4];y=q[v+11]<<24|q[v+10]<<16|q[v+9]<<8|q[v+8];v+=12;for(t="";;){u=q[v++];if(u!=0)t+=String.fromCharCode(u);else break}u={};var D=t.split("\t");if(D.length>0)u.label=D[0];if(D.length>1)u.score=stringToInt(D[1]);if(D.length>2)u.orientation=D[2];if(D.length>5){t=D[5];if(BED_COLOR_REGEXP.test(t))u.override_color=
"rgb("+t+")"}if(D.length<9)x==a&&r(o+1,y,u);else if(x==a&&o<=c&&y>=b){y=D[3]|0;x=D[4]|0;t=D[6]|0;A=D[7].split(",");F=D[8].split(",");u.type="bb-transcript";var z=new DASGroup;z.id=D[0];z.type="bb-transcript";z.notes=[];u.groups=[z];if(D.length>10){z=D[9];D=D[10];var E=new DASGroup;E.id=z;E.label=D;E.type="gene";u.groups.push(E)}D=null;for(z=0;z<t;++z){E=(F[z]|0)+o;E=new Range(E,E+(A[z]|0));D=D?union(D,E):E}A=D.ranges();for(o=0;o<A.length;++o){t=A[o];m(t.min()+1,t.max(),u)}if(x>y)if(o=intersection(D,
new Range(y,x))){u.type="bb-translation";y=o.ranges();for(o=0;o<y.length;++o){t=y[o];m(t.min()+1,t.max(),u)}}}}else dlog("Don't know what to do with "+e.bwg.type);f.splice(0,1);s()}else{q=o.offset;var C=o.size;for(o=1;o<f.length&&f[o].offset==q+C;){C+=f[o].size;++o}e.bwg.data.slice(q,C).fetch(function(G){for(var B=0,P=0;B<C;){var Q=f[P],M;if(e.bwg.uncompressBufSize>0)M=jszlib_inflate_buffer(G,B+2,Q.size-2);else{M=new Uint8Array(Q.size);arrayCopy(new Uint8Array(G,B,Q.size),0,M,0,Q.size);M=M.buffer}Q.data=
M;B+=Q.size;++P}s()})}}};s()}};h([e.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(p){e.cirHeader=p;p=new Int32Array(e.cirHeader);e.cirBlockSize=p[1];e.readWigDataById(a,b,c,d)})};BigWigView.prototype.getFirstAdjacent=function(a,b,c,d){a=this.bwg.chromsToIDs[a];if(a===undefined)return d([]);else this.getFirstAdjacentById(a,b,c,d)};
BigWigView.prototype.getFirstAdjacentById=function(a,b,c,d){var e=this;if(this.cirHeader){var f=null,i=-1,h=-1,j=0;Date.now();var l=function(r,s){j+=r.length;for(var o=4+e.cirBlockSize*32,q,t=0;t<r.length;++t){var v=new Range(r[t],Math.min(r[t]+o,e.cirTreeOffset+e.cirTreeLength));q=q?union(q,v):v}o=q.ranges();for(q=0;q<o.length;++q)p(r,o[q],s)},p=function(r,s,o){s.max();s.min();e.bwg.data.slice(s.min(),s.max()-s.min()).fetch(function(q){for(var t=0;t<r.length;++t)if(s.contains(r[t])){var v=q,u=r[t]-
s.min(),x=o,y=new Int8Array(v),A=new Int16Array(v);v=new Int32Array(v);y=y[u];A=A[u/2+1];u+=4;if(y!=0)for(y=0;y<A;++y){var F=u/4,D=v[F],z=v[F+1],E=v[F+2],C=v[F+3],G=v[F+4]<<32|v[F+5];x=v[F+6]<<32|v[F+7];if(c<0&&(D<a||D==a&&z<=b)||c>0&&(E>a||E==a&&C>=b))if(!/_random/.exec(e.bwg.idsToChroms[D]))if(f==null||c<0&&(E>i||E==i&&C>h)||c>0&&(D<i||D==i&&z<h)){f={offset:G,size:x};h=c<0?C:z;i=c<0?E:D}u+=32}else{var B=-1,P=-1;for(y=0;y<A;++y){F=u/4;D=v[F];z=v[F+1];E=v[F+2];C=v[F+3];G=v[F+4]<<32|v[F+5];if(c<0&&
(D<a||D==a&&z<=b)&&E>=a||c>0&&(E>a||E==a&&C>=b)&&D<=a)if(B<0||C>P){B=G;P=c<0?C:z}u+=24}B>=0&&l([B],x+1)}--j;j==0&&m()}})},m=function(){if(f==null)return dlog("got nothing");var r=[f];r.sort(function(u,x){return(u.offset|0)-(x.offset|0)});if(r.length==0)d([]);else{var s=null,o=-1,q=-1,t=function(u,x,y,A){if(c<0&&(u<a||y<b)||c>0&&(u>a||x>b)){(A=A)||(A={});var F=new DASFeature;F.segment=e.bwg.idsToChroms[u];F.min=x;F.max=y;F.type="bigwig";for(k in A)F[k]=A[k];if(s==null||c<0&&(u>o||y>q)||c>0&&(u<o||
x<q)){s=F;q=c<0?y:x;o=u}}},v=function(){if(r.length==0){Date.now();d([s])}else{var u=r[0];if(u.data){var x=new Uint8Array(u.data);if(e.isSummary){var y=new Int16Array(u.data),A=new Int32Array(u.data),F=new Float32Array(u.data);x=u.data.byteLength/32;for(y=0;y<x;++y){u=A[y*8];var D=A[y*8+1],z=A[y*8+2],E={type:"bigwig",score:F[y*8+6]/A[y*8+3]};if(e.bwg.type=="bigbed")E.type="density";t(u,D+1,z,E)}}else if(e.bwg.type=="bigwig"){y=new Int16Array(u.data);A=new Int32Array(u.data);F=new Float32Array(u.data);
u=A[0];D=A[1];E=A[3];z=A[4];var C=x[20];x=y[11];if(C==BIG_WIG_TYPE_FSTEP)for(y=0;y<x;++y){C=F[y+6];t(u,D+y*E+1,D+y*E+z,{score:C})}else if(C==BIG_WIG_TYPE_VSTEP)for(y=0;y<x;++y){D=A[y*2+6];C=F[y*2+7];t(D+1,D+z,{score:C})}else if(C==BIG_WIG_TYPE_GRAPH)for(y=0;y<x;++y){D=A[y*3+6]+1;z=A[y*3+7];C=F[y*3+8];if(D>z)D=z;t(D+1,z,{score:C})}else dlog("Currently not handling bwgType="+C)}else if(e.bwg.type=="bigbed")for(A=0;A<x.length;){u=x[A+3]<<24|x[A+2]<<16|x[A+1]<<8|x[A+0];D=x[A+7]<<24|x[A+6]<<16|x[A+5]<<
8|x[A+4];z=x[A+11]<<24|x[A+10]<<16|x[A+9]<<8|x[A+8];A+=12;for(F="";;){y=x[A++];if(y!=0)F+=String.fromCharCode(y);else break}y={};F=F.split("\t");if(F.length>0)y.label=F[0];if(F.length>1)y.score=100;if(F.length>2)y.orientation=F[2];t(u,D+1,z,y)}else dlog("Don't know what to do with "+e.bwg.type);r.splice(0,1);v()}else{x=u.offset;var G=u.size;for(u=1;u<r.length&&r[u].offset==x+G;){G+=r[u].size;++u}e.bwg.data.slice(x,G).fetch(function(B){for(var P=0,Q=0;P<G;){var M=r[Q],J;if(e.bwg.uncompressBufSize>
0)J=jszlib_inflate_buffer(B,P+2,M.size-2);else{J=new Uint8Array(M.size);arrayCopy(new Uint8Array(B,P,M.size),0,J,0,M.size);J=J.buffer}M.data=J;P+=M.size;++Q}v()})}}};v()}};l([e.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(r){e.cirHeader=r;r=new Int32Array(e.cirHeader);e.cirBlockSize=r[1];e.readWigDataById(a,min,max,d)})};BigWig.prototype.readWigData=function(a,b,c,d){this.getUnzoomedView().readWigData(a,b,c,d)};
BigWig.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var a=4E3;if(this.zoomLevels[0])a=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset;this.unzoomedView=new BigWigView(this,this.unzoomedIndexOffset,a,false)}return this.unzoomedView};BigWig.prototype.getZoomedView=function(a){var b=this.zoomLevels[a];if(!b.view)b.view=new BigWigView(this,b.indexOffset,this.zoomLevels[a+1].dataOffset-b.indexOffset,true);return b.view};
function makeBwgFromURL(a,b,c){makeBwg(new URLFetchable(a,{credentials:c}),b,a)}function makeBwgFromFile(a,b){makeBwg(new BlobFetchable(a),b,"file")}
function makeBwg(a,b,c){var d=new BigWig;d.data=a;d.name=c;d.data.slice(0,512).fetch(function(e){if(!e)return b(null,"Couldn't fetch file");var f=new Int16Array(e);e=new Int32Array(e);if(e[0]==BIG_WIG_MAGIC)d.type="bigwig";else if(e[0]==BIG_BED_MAGIC)d.type="bigbed";else b(null,"Not a supported format");d.version=f[2];d.numZoomLevels=f[3];d.chromTreeOffset=e[2]<<32|e[3];d.unzoomedDataOffset=e[4]<<32|e[5];d.unzoomedIndexOffset=e[6]<<32|e[7];d.fieldCount=f[16];d.definedFieldCount=f[17];d.asOffset=e[9]<<
32|e[10];d.totalSummaryOffset=e[11]<<32|e[12];d.uncompressBufSize=e[13];d.zoomLevels=[];for(f=0;f<d.numZoomLevels;++f)d.zoomLevels.push({reduction:e[f*6+16],dataOffset:e[f*6+18]<<32|e[f*6+19],indexOffset:e[f*6+20]<<32|e[f*6+21]});d.readChromTree(function(){return b(d)})})}function BlobFetchable(a){this.blob=a}BlobFetchable.prototype.slice=function(a,b){var c;c=b?this.blob.slice(a,a+b):this.blob.slice(a);return new BlobFetchable(c)};
BlobFetchable.prototype.fetch=function(a){var b=new FileReader;b.onloadend=function(){a(bstringToBuffer(b.result))};b.readAsBinaryString(this.blob)};function URLFetchable(a,b,c,d){if(!d)if(typeof b==="object"){d=b;b=undefined}else d={};this.url=a;this.start=b||0;if(c)this.end=c;this.opts=d}URLFetchable.prototype.slice=function(a,b){var c=this.start,d=this.end;c=c&&a?c+a:a||c;d=b&&c?c+b-1:d||b-1;return new URLFetchable(this.url,c,d,this.opts)};
var seed=0,isIOS=navigator.userAgent.indexOf("Mobile")>=0;
URLFetchable.prototype.fetch=function(a,b,c){var d=this;b=b||1;if(b>3)return a(null);var e=new XMLHttpRequest,f,i=this.url;if(isIOS)i=i+"?salt="+ ++seed;e.open("GET",i,true);e.overrideMimeType("text/plain; charset=x-user-defined");if(this.end){e.setRequestHeader("Range","bytes="+this.start+"-"+this.end);f=this.end-this.start+1}e.responseType="arraybuffer";e.onreadystatechange=function(){if(e.readyState==4)if(e.status==200||e.status==206)if(e.response){var h=e.response.byteLength;return f&&f!=h&&(!c||
h!=c)?d.fetch(a,b+1,h):a(e.response)}else if(e.mozResponseArrayBuffer)return a(e.mozResponseArrayBuffer);else{h=e.responseText;return f&&f!=h.length&&(!c||h.length!=c)?d.fetch(a,b+1,h.length):a(bstringToBuffer(e.responseText))}else return d.fetch(a,b+1)};if(this.opts.credentials)e.withCredentials=true;e.send("")};function bstringToBuffer(a){if(!a)return null;for(var b=new Uint8Array(a.length),c=0;c<b.length;++c)b[c]=a.charCodeAt(c);return b.buffer}
var NS_SVG="http://www.w3.org/2000/svg",NS_HTML="http://www.w3.org/1999/xhtml",NS_XLINK="http://www.w3.org/1999/xlink";function Region(a,b,c){this.min=b;this.max=c;this.chr=a}
function Browser(a){a||(a={});this.uiPrefix="http://www.biodalliance.org/canvas/";this.sources=[];this.tiers=[];this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=[];this.tierListeners=[];this.tierSelectionWrapListeners=[];this.cookieKey="browser";this.karyoEndpoint=new DASSource("http://www.derkholm.net:8080/das/hsa_54_36p/");this.registry="http://www.dasregistry.org/das/sources";this.coordSystem={speciesName:"Human",taxon:9606,auth:"NCBI",version:"36"};
this.chains={};this.pageName="svgHolder";this.maxExtra=2.5;this.minExtra=0.5;this.zoomFactor=1;this.zoomMin=10;this.zoomMax=220;this.origin=0;this.targetQuantRes=5;this.featurePanelWidth=750;this.zoomBase=100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=null;this.currentSeqMax=-1;this.highlights=[];this.autoSizeTiers=false;this.guidelineStyle="foreground";this.guidelineSpacing=75;this.fgGuide=null;this.positionFeedback=false;this.selectedTier=1;this.placards=[];this.reverseScrolling=
false;this.tierBackgroundColors=["white"];this.minTierHeight=25;this.browserLinks={Ensembl:"http://ncbi36.ensembl.org/Homo_sapiens/Location/View?r=${chr}:${start}-${end}",UCSC:"http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg18&position=chr${chr}:${start}-${end}"};this.availableSources=new Observed;this.defaultSources=[];this.mappableSources={};for(var b in a)this[b]=a[b];var c=this;window.addEventListener("load",function(){c.realInit()},false)}
Browser.prototype.realInit=function(){this.supportsBinary=true;this.defaultChr=this.chr;this.defaultStart=this.viewStart;this.defaultEnd=this.viewEnd;this.defaultSources=[];for(var a=0;a<this.sources.length;++a)this.defaultSources.push(this.sources[a]);this.restoreStatus&&this.restoreStatus();var b=this;this.browserHolder=document.getElementById(this.pageName);removeChildren(this.browserHolder);this.svgHolder=makeElement("div",null,{tabIndex:100},{overflow:"hidden",display:"inline-block",width:"100%",
fontSize:"10pt",outline:"none"});this.initUI(this.browserHolder,this.svgHolder);this.tierHolder=makeElement("div",null,{},{width:"100%",padding:"0px",margin:"0px",border:"0px",position:"relative",outline:"none"});this.svgHolder.appendChild(this.tierHolder);this.bhtmlRoot=makeElement("div");this.disablePoweredBy||this.bhtmlRoot.appendChild(makeElement("span",["Powered by ",makeElement("a","Dalliance",{href:"http://www.biodalliance.org/"})," "+VERSION]));this.svgHolder.appendChild(this.bhtmlRoot);this.featurePanelWidth=
this.tierHolder.getBoundingClientRect().width|0;window.addEventListener("resize",function(){b.resizeViewer()},false);this.ruler=makeElement("div",null,null,{width:"1px",height:"2000px",backgroundColor:"blue",position:"absolute",zIndex:"900",left:""+(this.featurePanelWidth/2|0)+"px",top:"0px"});this.tierHolder.appendChild(this.ruler);this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomExpt=250/Math.log(5E5/this.zoomBase);this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-
this.viewStart+1)/this.zoomBase);this.tierHolder.addEventListener("mousewheel",function(f){if(f.wheelDeltaX){f.stopPropagation();f.preventDefault();f=f.wheelDeltaX/5;b.reverseScrolling||(f=-f);b.move(f)}},false);this.tierHolder.addEventListener("MozMousePixelScroll",function(f){console.log("mps");if(f.axis==1){f.stopPropagation();f.preventDefault();if(f.detail!=0){f=f.detail/4;if(b.reverseScrolling)f=-f;b.move(f)}}},false);var c=function(f){if(f.keyCode==13){var i=false;for(f=0;f<b.tiers.length;++f){var h=
b.tiers[f];if(h.wantedLayoutHeight&&h.wantedLayoutHeight!=h.layoutHeight){h.layoutHeight=h.wantedLayoutHeight;h.placard=null;h.clipTier();i=true}}i&&b.arrangeTiers()}else if(f.keyCode==32||f.charCode==32){if(b.isSnapZooming){b.isSnapZooming=false;h=b.savedZoom||10}else{b.isSnapZooming=true;h=b.savedZoom||1}b.savedZoom=b.zoomSliderValue;b.zoomSliderValue=h;b.zoom(Math.exp(1*h/b.zoomExpt));b.snapZoomLockout=true;f.stopPropagation();f.preventDefault()}else if(f.keyCode==39){f.stopPropagation();f.preventDefault();
if(f.ctrlKey){var j=0;if(f.shiftKey)j=1;var l=(b.viewStart+b.viewEnd+1)/2|0;b.tiers[b.selectedTier].findNextFeature(b.chr,l,-1,j,function(p){if(p){var m=p.min,r=p.max;if(j)if(r<l-1){r++;m=r}else r=m;var s=b.viewEnd-b.viewStart+1;parseFloat(s/2)==parseInt(s/2)&&s--;m=(m+r-s)/2+1;b.setLocation(p.segment,m,m+s-1)}else alert("no next feature")})}else b.move(f.shiftKey?100:25)}else if(f.keyCode==37){f.stopPropagation();f.preventDefault();if(f.ctrlKey){j=0;if(f.shiftKey)j=1;l=(b.viewStart+b.viewEnd+1)/
2|0;b.tiers[b.selectedTier].findNextFeature(b.chr,l,1,j,function(p){if(p){var m=p.min,r=p.max;if(j)if(m>l+1)r=m;else{r++;m=r}var s=b.viewEnd-b.viewStart+1;parseFloat(s/2)==parseInt(s/2)&&s--;m=(m+r-s)/2+1;b.setLocation(p.segment,m,m+s-1)}else alert("no next feature")})}else b.move(f.shiftKey?-100:-25)}else if(f.keyCode==38||f.keyCode==87){f.stopPropagation();f.preventDefault();if(f.shiftKey){f=b.tiers[b.selectedTier];h=f.forceHeight||f.subtiers[0].height;if(h>=20){f.forceHeight=h-20;f.draw()}}else b.selectedTier>
0?b.setSelectedTier(b.selectedTier-1):b.notifyTierSelectionWrap(-1)}else if(f.keyCode==40||f.keyCode==83){f.stopPropagation();f.preventDefault();if(f.shiftKey){f=b.tiers[b.selectedTier];h=f.forceHeight||f.subtiers[0].height;f.forceHeight=h+10;f.draw()}else b.selectedTier<b.tiers.length-1&&b.setSelectedTier(b.selectedTier+1)}else if(f.keyCode==187||f.keyCode==61){f.stopPropagation();f.preventDefault();b.zoomStep(-10)}else if(f.keyCode==189||f.keyCode==173){f.stopPropagation();f.preventDefault();b.zoomStep(10)}else if(f.keyCode==
84||f.keyCode==116){f.stopPropagation();f.preventDefault();if(f.shiftKey)for(f=0;f<b.tiers.length;++f){h=b.tiers[f];if(h.dasSource.collapseSuperGroups){if(i===undefined)i=!h.bumped;h.bumped=i;h.layoutWasDone=false;h.draw();h.updateLabel()}}else{h=b.tiers[b.selectedTier];if(h.dasSource.collapseSuperGroups){if(i===undefined)i=!h.bumped;h.bumped=i;h.layoutWasDone=false;h.draw();h.updateLabel()}}}else console.log("key: "+f.keyCode+"; char: "+f.charCode)};this.svgHolder.addEventListener("focus",function(){b.svgHolder.addEventListener("keydown",
c,false)},false);this.svgHolder.addEventListener("blur",function(){b.svgHolder.removeEventListener("keydown",c,false)},false);this.hPopupHolder=makeElement("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]="12pt";this.hPopupHolder.classList.add("dalliance");document.body.appendChild(this.hPopupHolder);for(a=0;a<this.sources.length;++a){var d=this.sources[a];if(d.bwgURI&&!this.supportsBinary){if(!this.binaryWarningGiven){this.popit({clientX:300,clientY:100},
"Warning",makeElement("p","your browser does not support binary data formats, some track(s) not loaded.  We currently recommend Google Chrome 9 or later, or Firefox 4 or later."));this.binaryWarningGiven=true}}else this.makeTier(d)}b.arrangeTiers();b.refresh();b.setSelectedTier(1);for(d=0;d<this.tiers.length;++d){a=this.tiers[d];if(a.sequenceSource){a.sequenceSource.getSeqInfo(this.chr,function(f){if(f)b.currentSeqMax=f.length});break}}this.queryRegistry();for(var e in this.chains)this.queryRegistry(e,
true)};Browser.prototype.touchStartHandler=function(a){a.stopPropagation();a.preventDefault();this.touchOriginX=a.touches[0].pageX;if(a.touches.length==2){a=Math.abs(a.touches[0].pageX-a.touches[1].pageX);this.zooming=true;this.zoomLastSep=this.zoomInitialSep=a;this.zoomInitialScale=this.scale}};
Browser.prototype.touchMoveHandler=function(a){a.stopPropagation();a.preventDefault();if(a.touches.length==1){var b=a.touches[0].pageX;this.touchOriginX&&b!=this.touchOriginX&&this.move(b-this.touchOriginX);this.touchOriginX=b}else if(this.zooming&&a.touches.length==2){b=Math.abs(a.touches[0].pageX-a.touches[1].pageX);if(b!=this.zoomLastSep){a=(a.touches[0].pageX+a.touches[1].pageX)/2;var c=this.viewStart+a/this.scale|0;this.scale=this.zoomInitialScale*(b/this.zoomInitialSep);this.viewStart=c-a/this.scale|
0;for(a=0;a<this.tiers.length;++a)this.tiers[a].draw()}this.zoomLastSep=b}};Browser.prototype.touchEndHandler=function(a){a.stopPropagation();a.preventDefault()};Browser.prototype.touchCancelHandler=function(){};Browser.prototype.makeTier=function(a){try{this.realMakeTier(a)}catch(b){console.log(b)}};
Browser.prototype.realMakeTier=function(a){var b=this,c=this.tierBackgroundColors[this.tiers.length%this.tierBackgroundColors.length],d=makeElement("canvas",null,{width:""+((this.featurePanelWidth|0)+2E3),height:"50"},{position:"absolute",padding:"0px",margin:"0px",border:"0px",left:"-1000px",borderBottomStyle:"solid",borderBottomColor:"rgb(180,180,180)",borderRightStyle:"solid",borderRightColor:"rgb(180,180,180)"}),e=makeElement("canvas",null,{width:+((this.featurePanelWidth|0)+2E3),height:"50"},
{position:"relative",padding:"0px",margin:"0px",border:"0px",left:"-1000px",zIndex:"1000",pointerEvents:"none"}),f=makeElement("span","blah"),i=makeElement("div",[makeElement("i",null,{className:"icon-warning-sign"})," ",f],{},{display:"none",position:"relative",borderCollapse:"collapse",marginTop:"-1px",height:"50px",textAlign:"center",lineHeight:"50px",borderStyle:"solid",borderColor:"red",borderWidth:"1px"}),h=makeElement("div",[d,e],{},{display:"inline-block",position:"relative",width:"100%",
overflowX:"hidden",overflowY:"hidden",border:"0px",borderBottom:"0px",borderStyle:"solid"});h.className="tier-viewport-background";h.addEventListener("touchstart",function(z){return b.touchStartHandler(z)},false);h.addEventListener("touchmove",function(z){return b.touchMoveHandler(z)},false);h.addEventListener("touchend",function(z){return b.touchEndHandler(z)},false);h.addEventListener("touchcancel",function(z){return b.touchCancelHandler(z)},false);var j=new DasTier(this,a,d,h,e,i,f);j.oorigin=
this.viewStart;j.background=c;j.quantOverlay=makeElement("canvas",null,{width:"50",height:"56"},{position:"absolute",padding:"0px",margin:"0px",border:"0px",left:""+(this.featurePanelWidth/2|0)+"px",top:"0px",display:"none"});j.holder.appendChild(j.quantOverlay);var l=false,p,m,r,s=function(z,E){var C=j.subtiers;if(C){var G=0;for(E-=MIN_PADDING;G<C.length&&E>C[G].height&&G<C.length-1;){E=E-C[G].height-MIN_PADDING;++G}if(!(G>=C.length)){C=C[G].glyphs;z-=(j.glyphCacheOrigin-b.viewStart)*b.scale;return glyphLookup(C,
z)}}},o=function(z){z.preventDefault();z.stopPropagation();z=z.clientX;if(j.dasSource.tier_type!=="sequence"&&z!=m){b.move(z-m);m=z}b.isDragging=true},q=function(){window.removeEventListener("mousemove",o,true);window.removeEventListener("mouseup",q,true)};h.addEventListener("mousedown",function(z){b.svgHolder.focus();z.preventDefault();h.getBoundingClientRect();z=z.clientX;window.addEventListener("mousemove",o,true);window.addEventListener("mouseup",q,true);p=m=z;b.isDragging=false},false);h.addEventListener("mousemove",
function(z){var E=h.getBoundingClientRect(),C=z.clientX-E.left,G=z.clientY-E.top;r&&clearTimeout(r);l||(r=setTimeout(function(){var B=s(C,G);B&&b.notifyFeatureHover(z,B)},1E3))});var t=null;h.addEventListener("mouseup",function(z){var E=h.getBoundingClientRect(),C=z.clientX-E.left;E=z.clientY-E.top;var G=s(C,E);if(G&&!b.isDragging)if(t){clearTimeout(t);t=null;b.featureDoubleClick(G,C,E)}else t=setTimeout(function(){t=null;b.notifyFeature(z,G)},500);if(b.isDragging&&C!=p&&j.dasSource.tier_type==="sequence"){E=
b.viewStart+C/b.scale;var B=b.viewStart+p/b.scale;if(E<B){C=E|0;E=B|0}else{C=B|0;E=E|0}b.notifyRegionSelect(b.chr,C,E)}b.isDragging=false},false);h.addEventListener("mouseout",function(){l=false});j.init();j.removeButton=makeElement("i",null,{className:"icon-remove"});j.bumpButton=makeElement("i",null,{className:"icon-plus-sign"});j.infoElement=makeElement("div",j.dasSource.desc,{},{display:"none",maxWidth:"200px",whiteSpace:"normal",color:"rgb(100,100,100)"});j.nameButton=makeElement("a",[j.removeButton,
makeElement("span",[a.name,j.infoElement],{},{display:"inline-block",marginLeft:"5px",marginRight:"5px"}),j.bumpButton],{className:"tier-tab"});j.label=makeElement("span",[j.nameButton],{className:"btn-group"},{zIndex:1001,position:"absolute",left:"2px",top:"2px",opacity:0.8,display:"inline-block"});var v=makeElement("div",[h,i,j.label],{},{position:"relative",display:"block"});j.row=v;j.removeButton.addEventListener("click",function(z){z.stopPropagation();z.preventDefault();b.removeTier(a)},false);
j.nameButton.addEventListener("click",function(z){z.stopPropagation();z.preventDefault();for(z=0;z<b.tiers.length;++z)if(b.tiers[z]===j)if(z!=b.selectedTier){b.setSelectedTier(z);return}if(j.infoVisible){j.infoElement.style.display="none";v.style.height="auto";j.infoVisible=false}else{j.infoElement.style.display="block";if(j.label.clientHeight>v.clientHeight)v.style.height=""+(j.label.clientHeight+4)+"px";j.infoVisible=true}},false);j.bumpButton.addEventListener("click",function(z){z.stopPropagation();
z.preventDefault();var E;if(j.dasSource.collapseSuperGroups){if(E===undefined)E=!j.bumped;j.bumped=E;j.layoutWasDone=false;j.draw();j.updateLabel()}},false);var u,x,y,A=false,F=function(z){var E=j.label;z.stopPropagation();z.preventDefault();if(!u){u=E.cloneNode(true);u.style.cursor="pointer";b.svgHolder.appendChild(u);E.style.visibility="hidden";for(var C=0;C<b.tiers.length;++C)if(b.tiers[C]===j){x=C;break}y=z.clientY}u.style.left=E.getBoundingClientRect().left+"px";u.style.top=z.clientY-10+"px";
E=z.clientY-b.tierHolder.getBoundingClientRect().top;for(C=0;C<b.tiers.length;++C){var G=b.tiers[C].row.getBoundingClientRect();E-=G.bottom-G.top;if(E<0){if(C<x&&z.clientY<y||C>x&&z.clientY>y){E=b.tiers[b.selectedTier];b.tiers.splice(x,1);b.tiers.splice(C,0,j);G=b.sources[x];b.sources.splice(x,1);b.sources.splice(C,0,G);for(G=0;G<b.tiers.length;++G)if(b.tiers[G]===E){b.selectedTier=G;break}x=C;y=z.clientY;removeChildren(b.tierHolder);for(z=0;z<b.tiers.length;++z)b.tierHolder.appendChild(b.tiers[z].row);
b.tierHolder.appendChild(b.ruler);A=true}break}}},D=function(z){var E=j.label;z.stopPropagation();z.preventDefault();if(u){u.style.cursor="auto";b.svgHolder.removeChild(u);u=null;E.style.visibility=null}document.removeEventListener("mousemove",F,false);document.removeEventListener("mouseup",D,false);A&&b.notifyTier()};j.label.addEventListener("mousedown",function(z){z.stopPropagation();z.preventDefault();A=false;document.addEventListener("mousemove",F,false);document.addEventListener("mouseup",D,
false)},false);this.tierHolder.appendChild(v);this.tiers.push(j);this.refreshTier(j);this.arrangeTiers();j.updateLabel()};Browser.prototype.refreshTier=function(a){this.knownSpace&&this.knownSpace.invalidate(a)};Browser.prototype.arrangeTiers=function(){};
Browser.prototype.refresh=function(){this.notifyLocation();var a=100/this.scale|0,b=1E3/this.scale|0,c=(this.viewStart+this.viewEnd)/2,d=c-this.origin;this.origin=c;this.scaleAtLastRedraw=this.scale;for(c=0;c<this.tiers.length;++c){var e=d;if(this.tiers[c].originHaxx)e+=this.tiers[c].originHaxx;this.tiers[c].originHaxx=e}d=this.targetQuantRes/this.scale;c=Math.max(1,(this.viewStart|0)-a);a=Math.min((this.viewEnd|0)+a,(this.currentSeqMax|0)>0?this.currentSeqMax|0:1E9);e=Math.max(1,(this.viewStart|
0)-b);b=Math.min((this.viewEnd|0)+b,(this.currentSeqMax|0)>0?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){for(var f=null,i=0;i<this.tiers.length;++i)if(this.tiers[i].sequenceSource){f=this.tiers[i].sequenceSource;break}this.knownSpace=new KnownSpace(this.tiers,this.chr,e,b,d,f)}if((f=this.knownSpace.bestCacheOverlapping(this.chr,c,a))&&f.min<=c&&f.max>=a){this.drawnStart=Math.max(f.min,e);this.drawnEnd=Math.min(f.max,b)}else{this.drawnStart=e;this.drawnEnd=b}this.knownSpace.viewFeatures(this.chr,
this.drawnStart,this.drawnEnd,d);this.drawOverlays()};function setSources(a,b,c){if(c)for(var d=0;d<b.length;++d)b[d].mapping=c;a.set(b)}
Browser.prototype.queryRegistry=function(a,b){var c,d;if(a){c=this.chains[a].coords;this.mappableSources[a]||(this.mappableSources[a]=new Observed);d=this.mappableSources[a]}else{c=this.coordSystem;d=this.availableSources}var e=hex_sha1(miniJSONify(c));if(b){var f=localStorage["dalliance.registry."+e+".last_queried"];if(f)try{setSources(d,JSON.parse(localStorage["dalliance.registry."+e+".sources"]),a);if((Date.now()|0)-(f|0)<432E5)return}catch(i){console.log("Bad registry cache: "+i)}}(new DASRegistry(this.registry)).sources(function(h){for(var j=
[],l=0;l<h.length;++l){var p=h[l];if(!(!p.coords||p.coords.length==0)){var m=p.coords[0];m.taxon!=c.taxon||m.auth!=c.auth||m.version!=c.version||j.push(p)}}localStorage["dalliance.registry."+e+".sources"]=JSON.stringify(j);localStorage["dalliance.registry."+e+".last_queried"]=""+Date.now();setSources(d,j,a)},function(){},c)};
Browser.prototype.move=function(a){var b=this.viewEnd-this.viewStart;this.viewStart-=a/this.scale;this.viewEnd=this.viewStart+b;if(this.currentSeqMax>0&&this.viewEnd>this.currentSeqMax){this.viewEnd=this.currentSeqMax;this.viewStart=this.viewEnd-b}if(this.viewStart<1){this.viewStart=1;this.viewEnd=this.viewStart+b}this.notifyLocation();for(a=0;a<this.tiers.length;++a){this.tiers[a].viewport.style.left=""+((-((this.viewStart-this.tiers[a].norigin)*this.scale)|0)-1E3)+"px";this.tiers[a].overlay.style.left=
""+((-((this.viewStart-this.tiers[a].oorigin)*this.scale)|0)-1E3)+"px"}this.spaceCheck()};Browser.prototype.zoomStep=function(a){var b=1*this.zoomSliderValue;a=b+a;if(a<this.zoomMin)a=this.zoomMin;if(a>this.zoomMax)a=this.zoomMax;if(a!=b){this.zoomSliderValue=a;this.zoom(Math.exp(1*a/this.zoomExpt))}};
Browser.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/2)|0;this.viewStart=a-this.zoomBase*this.zoomFactor/2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;if(this.currentSeqMax>0&&this.viewEnd>this.currentSeqMax+5){a=this.viewEnd-this.viewStart+1;this.viewEnd=this.currentSeqMax;this.viewStart=this.viewEnd-a+1}if(this.viewStart<1){a=this.viewEnd-this.viewStart+1;this.viewStart=1;this.viewEnd=this.viewStart+a-1}this.scale=this.featurePanelWidth/(this.viewEnd-
this.viewStart);this.refresh()};Browser.prototype.spaceCheck=function(){if(!this.knownSpace||this.knownSpace.chr!==this.chr)this.refresh();else{var a=100/this.scale|0;if((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,(this.currentSeqMax|0)>0?this.currentSeqMax|0:1E9))this.refresh()}};
Browser.prototype.resizeViewer=function(a){var b=this.featurePanelWidth;this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|0|0;if(b!=this.featurePanelWidth){this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/b;b=this.viewEnd-this.viewStart+1;if(this.currentSeqMax>0&&this.viewEnd>this.currentSeqMax){this.viewEnd=this.currentSeqMax;this.viewStart=this.viewEnd-b+1}if(this.viewStart<1){this.viewStart=1;this.viewEnd=this.viewStart+b-1}this.ruler.style.left=
""+(this.featurePanelWidth/2|0)+"px";for(b=0;b<this.tiers.length;++b){var c=this.tiers[b].quantOverlay;if(c)c.style.left=""+(this.featurePanelWidth/2|0)+"px"}a||this.spaceCheck();this.notifyLocation()}};Browser.prototype.addTier=function(a){this.sources.push(a);this.makeTier(a)};
Browser.prototype.removeTier=function(a){var b=-1;if(typeof a.index!=="undefined"&&a.index>=0&&a.index<this.tiers.length)b=a.index;else for(var c=0;c<this.tiers.length;++c){var d=this.tiers[c].dasSource;if(a.uri&&d.uri===a.uri||a.bwgURI&&d.bwgURI===a.bwgURI||a.bamURI&&d.bamURI===a.bamURI||a.twoBitURI&&d.twoBitURI===a.twoBitURI){b=c;break}}if(b<0)throw"Couldn't find requested tier";this.tierHolder.removeChild(this.tiers[b].row);this.tiers.splice(b,1);this.sources.splice(b,1);for(c=b;c<this.tiers.length;++c)this.tiers[c].background=
this.tierBackgroundColors[c%this.tierBackgroundColors.length];this.refresh()};Browser.prototype.setLocation=function(a,b,c,d){d||(d=function(h){if(h)throw h;});var e=this;if(!a||a==this.chr)return this._setLocation(null,b,c,null,d);else{for(var f,i=0;i<this.tiers.length;++i)if(this.tiers[i].sequenceSource){f=this.tiers[i].sequenceSource;break}if(!f)return d("Need a sequence source");f.getSeqInfo(a,function(h){h||d("Couldn't find sequence '"+a+"'");return e._setLocation(a,b,c,h,d)})}};
Browser.prototype._setLocation=function(a,b,c,d,e){if(a){this.chr=a;this.currentSeqMax=d.length}b|=0;c|=0;a=Math.max(10,c-b+1);if(b<1){b=1;c=b+a-1}if(c>this.currentSeqMax){c=this.currentSeqMax;b=Math.max(1,c-a+1)}this.viewStart=b;this.viewEnd=c;b=this.featurePanelWidth/(this.viewEnd-this.viewStart);c=Math.abs(b-this.scale)>1.0E-4;this.scale=b;this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);this.isSnapZooming=false;this.savedZoom=null;this.notifyLocation();
if(c)this.refresh();else for(b=0;b<this.tiers.length;++b){this.tiers[b].viewport.style.left=""+((-((this.viewStart-this.tiers[b].norigin)*this.scale)|0)-1E3)+"px";this.tiers[b].overlay.style.left=""+((-((this.viewStart-this.tiers[b].oorigin)*this.scale)|0)-1E3)+"px"}this.spaceCheck();return e()};Browser.prototype.addFeatureListener=function(a){this.featureListeners.push(a)};
Browser.prototype.notifyFeature=function(a,b,c){for(var d=0;d<this.featureListeners.length;++d)try{this.featureListeners[d](a,b,c)}catch(e){console.log(e)}};Browser.prototype.addFeatureHoverListener=function(a){this.featureHoverListeners.push(a)};Browser.prototype.notifyFeatureHover=function(a,b,c){for(var d=0;d<this.featureHoverListeners.length;++d)try{this.featureHoverListeners[d](a,b,c)}catch(e){console.log(e)}};Browser.prototype.addViewListener=function(a){this.viewListeners.push(a)};
Browser.prototype.notifyLocation=function(){for(var a=0;a<this.viewListeners.length;++a)try{this.viewListeners[a](this.chr,this.viewStart|0,this.viewEnd|0,this.zoomSliderValue)}catch(b){console.log(b)}};Browser.prototype.addTierListener=function(a){this.tierListeners.push(a)};Browser.prototype.notifyTier=function(){for(var a=0;a<this.tierListeners.length;++a)try{this.tierListeners[a]()}catch(b){console.log(b)}};Browser.prototype.addRegionSelectListener=function(a){this.regionSelectListeners.push(a)};
Browser.prototype.notifyRegionSelect=function(a,b,c){for(var d=0;d<this.regionSelectListeners.length;++d)try{this.regionSelectListeners[d](a,b,c)}catch(e){console.log(e)}};Browser.prototype.highlightRegion=function(a,b,c){this.highlights.push(new Region(a,b,c));var d=this.viewStart-1E3/this.scale,e=this.viewEnd+1E3/this.scale;a==this.chr&&b<e&&c>d&&this.drawOverlays()};
Browser.prototype.drawOverlays=function(){for(var a=0;a<this.tiers.length;++a){var b=this.tiers[a],c=b.overlay.getContext("2d");b.overlay.height=b.viewport.height;for(var d=this.viewStart-1E3/this.scale,e=this.viewStart-1E3/this.scale,f=this.viewEnd+1E3/this.scale,i=0;i<this.highlights.length;++i){var h=this.highlights[i];if(h.chr==this.chr&&h.min<f&&h.max>e){c.globalAlpha=0.3;c.fillStyle="red";c.fillRect((h.min-d)*this.scale,0,(h.max-h.min)*this.scale,b.overlay.height)}}b.oorigin=this.viewStart;
b.overlay.style.left="-1000px"}};Browser.prototype.featuresInRegion=function(a,b,c){var d=[];if(a!==this.chr)return[];for(a=0;a<this.tiers.length;++a)for(var e=this.tiers[a].currentFeatures||[],f=0;f<e.length;++f){var i=e[f];i.min<=c&&i.max>=b&&d.push(i)}return d};Browser.prototype.setSelectedTier=function(a){this.selectedTier=a;for(var b=0;b<this.tiers.length;++b){var c=this.tiers[b].nameButton;b==this.selectedTier?c.classList.add("active"):c.classList.remove("active")}a!=null&&this.svgHolder.focus()};
Browser.prototype.addTierSelectionWrapListener=function(a){this.tierSelectionWrapListeners.push(a)};Browser.prototype.notifyTierSelectionWrap=function(a){for(var b=0;b<this.tierSelectionWrapListeners.length;++b)try{this.tierSelectionWrapListeners[b](a)}catch(c){console.log(c)}};
Browser.prototype.featureDoubleClick=function(a,b){if(a.min&&a.max){var c=((a.min|0)-(this.viewStart|0))*this.scale,d=(a.max-a.min+1)*this.scale,e=((a.min|0)+(a.max|0))/2;if(d>10){c=1*(b-c)/d;if(c<0.3)e=a.min|0;else if(c>0.7)e=(a.max|0)+1}c=this.viewEnd-this.viewStart;this.setLocation(null,e-c/2,e+c/2)}};
function glyphLookup(a,b){for(var c=0;c<a.length;++c){var d=a[c];if(d.min()<=b&&d.max()>=b)return d.feature?d.feature:d.glyphs?glyphLookup(d.glyphs,b)||d.group:d.glyph?glyphLookup([d.glyph],b)||d.group:d.group}return null}var TAGVAL_NOTE_RE=/^([A-Za-z]+)=(.+)/;
Browser.prototype.featurePopup=function(a,b,c){b||(b={});c||(c={});this.removeAllPopups();var d=makeElement("table",null,{className:"table table-striped table-condensed"});d.style.width="100%";d.style.margin="0px";var e=pick(c.type,b.type),f=pick(c.label,b.label,c.id,b.id);if(f&&f.indexOf("__dazzle")!=0)e=e+": "+f;f=0;if(b.method){var i=makeElement("tr",[makeElement("th","Method"),makeElement("td",b.method)]);i.style.backgroundColor=this.tierBackgroundColors[f%this.tierBackgroundColors.length];d.appendChild(i);
++f}i=c.segment?c:b;i=makeElement("tr",[makeElement("th","Location"),makeElement("td",i.segment+":"+i.min+"-"+i.max)]);i.style.backgroundColor=this.tierBackgroundColors[f%this.tierBackgroundColors.length];d.appendChild(i);++f;if(b.score!==undefined&&b.score!==null&&b.score!="-"){i=makeElement("tr",[makeElement("th","Score"),makeElement("td",""+b.score)]);i.style.backgroundColor=this.tierBackgroundColors[f%this.tierBackgroundColors.length];d.appendChild(i);++f}if((i=maybeConcat(c.links,b.links))&&
i.length>0){i=makeElement("tr",[makeElement("th","Links"),makeElement("td",i.map(function(l){return makeElement("div",makeElement("a",l.desc,{href:l.uri,target:"_new"}))}))]);i.style.backgroundColor=this.tierBackgroundColors[f%this.tierBackgroundColors.length];d.appendChild(i);++f}b=maybeConcat(c.notes,b.notes);for(c=0;c<b.length;++c){i="Note";var h=b[c],j=h.match(TAGVAL_NOTE_RE);if(j){i=j[1];h=j[2]}i=makeElement("tr",[makeElement("th",i),makeElement("td",h)]);i.style.backgroundColor=this.tierBackgroundColors[f%
this.tierBackgroundColors.length];d.appendChild(i);++f}this.popit(a,e,d,{width:400})};function Chainset(a,b,c,d){this.uri=a;this.srcTag=b;this.destTag=c;this.coords=d;this.chainsBySrc={};this.chainsByDest={};this.postFetchQueues={}}function parseCigar(a){for(var b=[],c=RegExp("([0-9]*)([MID])","g"),d;(d=c.exec(a))!=null;){var e=d[1];if(e.length==0)e=1;b.push({cnt:e|0,op:d[2]})}return b}
Chainset.prototype.fetchChainsTo=function(a){var b=this;(new DASSource(this.uri)).alignments(a,{},function(c){b.chainsByDest[a]||(b.chainsByDest[a]=[]);for(var d=0;d<c.length;++d)for(var e=c[d],f=0;f<e.blocks.length;++f){for(var i=e.blocks[f],h,j,l=0;l<i.segments.length;++l){var p=i.segments[l],m=e.objects[p.object];if(m.dbSource===b.srcTag)h=p;else if(m.dbSource===b.destTag)j=p}if(h&&j){i={srcChr:e.objects[h.object].accession,srcMin:h.min|0,srcMax:h.max|0,srcOri:h.strand,destChr:e.objects[j.object].accession,
destMin:j.min|0,destMax:j.max|0,destOri:j.strand,blocks:[]};l=parseCigar(h.cigar);p=parseCigar(j.cigar);for(var r=m=0,s=0,o=0;s<l.length&&o<p.length;)if(l[s].op=="M"&&p[o].op=="M"){var q=Math.min(l[s].cnt,p[o].cnt);i.blocks.push([m,r,q]);if(l[s].cnt==q)++s;else l[s].cnt-=q;if(p[o].cnt==q)++o;else p[o]-=q;m+=q;r+=q}else if(l[s].op=="I")r+=l[s++].cnt;else if(p[o].op=="I")m+=p[o++].cnt;pusho(b.chainsBySrc,i.srcChr,i);pusho(b.chainsByDest,i.destChr,i)}}if(b.postFetchQueues[a]){c=b.postFetchQueues[a];
for(d=0;d<c.length;++d)c[d]();b.postFetchQueues[a]=null}})};Chainset.prototype.mapPoint=function(a,b){for(var c=this.chainsBySrc[a]||[],d=0;d<c.length;++d){var e=c[d];if(b>=e.srcMin&&b<=e.srcMax){var f;f=e.srcOri=="-"?e.srcMax-b:b-e.srcMin;for(var i=e.blocks,h=0;h<i.length;++h){var j=i[h],l=j[0],p=j[1];j=j[2];if(f>=l&&f<=l+j){c=f-l;return{seq:e.destChr,pos:e.destOri=="-"?e.destMax-p-c:c+p+e.destMin,flipped:e.srcOri!=e.destOri}}}}}return null};
Chainset.prototype.unmapPoint=function(a,b){for(var c=this.chainsByDest[a]||[],d=0;d<c.length;++d){var e=c[d];if(b>=e.destMin&&b<=e.destMax){d=e.srcOri=="-"?e.destMax-b:b-e.destMin;for(var f=e.blocks,i=0;i<f.length;++i){var h=f[i];c=h[0];var j=h[1];h=h[2];if(d>=j&&d<=j+h){d=d-j;f=d+c+e.srcMin;f=e.destOri=="-"?e.srcMax-c-d:d+c+e.srcMin;return{seq:e.srcChr,pos:f,flipped:e.srcOri!=e.destOri}}}return null}}return null};
Chainset.prototype.sourceBlocksForRange=function(a,b,c,d){if(this.chainsByDest[a]){var e=this.unmapPoint(a,b),f=this.unmapPoint(a,c);!e||!f||e.seq!=f.seq?d([]):d([new DASSegment(e.seq,e.pos,f.pos)])}else{e=!this.postFetchQueues[a];var i=this;pusho(this.postFetchQueues,a,function(){i.sourceBlocksForRange(a,b,c,d)});e&&this.fetchChainsTo(a)}};function DColour(a,b,c,d){this.red=a|0;this.green=b|0;this.blue=c|0;if(d)this.name=d}
DColour.prototype.toSvgString=function(){if(!this.name)this.name="rgb("+this.red+","+this.green+","+this.blue+")";return this.name};var palette={red:new DColour(255,0,0,"red"),green:new DColour(0,255,0,"green"),blue:new DColour(0,0,255,"blue"),yellow:new DColour(255,255,0,"yellow"),white:new DColour(255,255,255,"white"),black:new DColour(0,0,0,"black")},COLOR_RE=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/;
function dasColourForName(a){var b=palette[a];if(!b){if(b=COLOR_RE.exec(a))b=new DColour("0x"+b[1]|0,"0x"+b[2]|0,"0x"+b[3]|0,a);else{dlog("couldn't handle color: "+a);b=palette.black}palette[a]=b}return b}
function makeGradient(a,b,c,d){var e=[];b=dasColourForName(b);c=dasColourForName(c);if(d){d=dasColourForName(d);for(var f=0;f<a;++f){var i=1*f/(a-1),h,j;if(i<0.5){h=b;j=c;i=i*2}else{h=c;j=d;i=i*2-1}h=(new DColour(h.red*(1-i)+j.red*i|0,h.green*(1-i)+j.green*i|0,h.blue*(1-i)+j.blue*i|0)).toSvgString();e.push(h)}}else for(f=0;f<a;++f){i=1*f/(a-1);h=(new DColour(b.red*(1-i)+c.red*i|0,b.green*(1-i)+c.green*i|0,b.blue*(1-i)+c.blue*i|0)).toSvgString();e.push(h)}return e}
var dasLibErrorHandler=function(a){alert(a)},dasLibRequestQueue=[];function DASSegment(a,b,c,d){this.name=a;this.start=b;this.end=c;this.description=d}DASSegment.prototype.toString=function(){return this.name+":"+this.start+".."+this.end};DASSegment.prototype.isBounded=function(){return this.start&&this.end};DASSegment.prototype.toDASQuery=function(){var a="segment="+this.name;if(this.start&&this.end)a+=":"+this.start+","+this.end;return a};
function DASSource(a,b){var c;if(typeof a=="string"){this.uri=a;c=b||{}}else c=a||{};for(var d in c)if(typeof c[d]!="function")this[d]=c[d];if(!this.coords)this.coords=[];if(!this.props)this.props={};if(this.uri&&this.uri.substr(this.uri.length-1)!="/")this.uri+="/"}function DASCoords(){}function coordsMatch(a,b){return a.taxon==b.taxon&&a.auth==b.auth&&a.version==b.version}
DASSource.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.uri+"entry_points",function(b){if(!b)return a([]);var c=[];b=b.getElementsByTagName("SEGMENT");for(var d=0;d<b.length;++d){var e=b[d],f=e.getAttribute("id"),i=e.getAttribute("size"),h;if(i){h=1;i=i|0}else{if(h=e.getAttribute("start"))h|=0;if(i=e.getAttribute("stop"))i|=0}var j=null;if(e.firstChild)j=e.firstChild.nodeValue;c.push(new DASSegment(f,h,i,j))}a(c)})};
function DASSequence(a,b,c,d,e){this.name=a;this.start=b;this.end=c;this.alphabet=d;this.seq=e}
DASSource.prototype.sequence=function(a,b){this.doCrossDomainRequest(this.uri+"sequence?"+a.toDASQuery(),function(c){if(c){var d=[];c=c.getElementsByTagName("SEQUENCE");for(var e=0;e<c.length;++e){var f=c[e],i=f.getAttribute("id"),h=f.getAttribute("start"),j=f.getAttribute("stop"),l=null;if(f.firstChild){f=f.firstChild.nodeValue;l="";for(var p=0;;){var m=f.indexOf("\n",p);if(m>=0){l+=f.substring(p,m);p=m+1}else{l+=f.substring(p);break}}}d.push(new DASSequence(i,h,j,"DNA",l))}b(d)}else b([])})};
function DASFeature(){}function DASGroup(){}function DASLink(a,b){this.desc=a;this.uri=b}
DASSource.prototype.features=function(a,b,c){b=b||{};var d;if(this.features_uri)d=this.features_uri;else{var e=[];if(a)e.push(a.toDASQuery());else if(b.group){a=b.group;if(typeof a=="string")e.push("group_id="+a);else for(var f=0;f<a.length;++f)e.push("group_id="+a[f])}if(b.adjacent){a=b.adjacent;if(typeof a=="string")a=[a];for(f=0;f<a.length;++f)e.push("adjacent="+a[f])}if(b.type)if(typeof b.type=="string")e.push("type="+b.type);else for(a=0;a<b.type.length;++a)e.push("type="+b.type[a]);b.maxbins&&
e.push("maxbins="+b.maxbins);if(e.length>0)d=this.uri+"features?"+e.join(";");else c([],"No filters specified")}this.doCrossDomainRequest(d,function(i,h){if(i){for(var j=[],l={},p=i.getElementsByTagName("SEGMENT"),m=0;m<p.length;++m){var r=p[m],s=r.getAttribute("id");l[s]={min:r.getAttribute("start"),max:r.getAttribute("stop")};r=r.getElementsByTagName("FEATURE");for(var o=0;o<r.length;++o){var q=r[o],t=new DASFeature;t.segment=s;t.id=q.getAttribute("id");t.label=q.getAttribute("label");var v=elementValue(q,
"START"),u=elementValue(q,"END");if((v|0)>(u|0)){t.min=u|0;t.max=v|0}else{t.min=v|0;t.max=u|0}v=q.getElementsByTagName("TYPE");if(v.length>0){v=v[0];if(v.firstChild)t.type=v.firstChild.nodeValue;t.typeId=v.getAttribute("id");t.typeCv=v.getAttribute("cvId")}t.type=elementValue(q,"TYPE");if(!t.type&&t.typeId)t.type=t.typeId;t.method=elementValue(q,"METHOD");(v=elementValue(q,"ORIENTATION"))||(v="0");t.orientation=v;t.score=elementValue(q,"SCORE");t.links=dasLinksOf(q);t.notes=dasNotesOf(q);v=q.getElementsByTagName("GROUP");
for(u=0;u<v.length;++u){var x=v[u],y=new DASGroup;y.type=x.getAttribute("type");y.id=x.getAttribute("id");y.links=dasLinksOf(x);y.notes=dasNotesOf(x);if(t.groups)t.groups.push(y);else t.groups=Array(y)}if(t.notes)for(v=0;v<t.notes.length;++v){u=t.notes[v];if(u.indexOf("Genename=")==0){x=new DASGroup;x.type="gene";x.id=u.substring(9);if(t.groups)t.groups.push(x);else t.groups=Array(x)}}v=q.getElementsByTagName("PART");if(v.length>0){x=[];for(u=0;u<v.length;++u)x.push(v[u].getAttribute("id"));t.parts=
x}v=q.getElementsByTagName("PARENT");if(v.length>0){q=[];for(u=0;u<v.length;++u)q.push(v[u].getAttribute("id"));t.parents=q}j.push(t)}}c(j,undefined,l)}else c([],"Failed request: "+(h.status==0?"server may not support CORS":"status="+h.status))})};function DASAlignment(a){this.type=a;this.objects={};this.blocks=[]}
DASSource.prototype.alignments=function(a,b,c){var d=this.uri+"alignment?query="+a;this.doCrossDomainRequest(d,function(e){if(e){var f=[];e=e.getElementsByTagName("alignment");for(var i=0;i<e.length;++i){for(var h=e[i],j=new DASAlignment(h.getAttribute("alignType")),l=h.getElementsByTagName("alignObject"),p=0;p<l.length;++p){var m=l[p];m={id:m.getAttribute("intObjectId"),accession:m.getAttribute("dbAccessionId"),version:m.getAttribute("objectVersion"),dbSource:m.getAttribute("dbSource"),dbVersion:m.getAttribute("dbVersion")};
j.objects[m.id]=m}h=h.getElementsByTagName("block");for(l=0;l<h.length;++l){m=h[l];p={order:m.getAttribute("blockOrder"),segments:[]};m=m.getElementsByTagName("segment");for(var r=0;r<m.length;++r){var s=m[r];s={object:s.getAttribute("intObjectId"),min:s.getAttribute("start"),max:s.getAttribute("end"),strand:s.getAttribute("strand"),cigar:elementValue(s,"cigar")};p.segments.push(s)}j.blocks.push(p)}f.push(j)}c(f)}else c([],"Failed request "+d)})};function DASStylesheet(){this.styles=[]}
DASStylesheet.prototype.pushStyle=function(a,b,c){a||(a={type:"default"});a=shallowCopy(a);if(b)a.zoom=b;a.style=c;this.styles.push(a)};function DASStyle(){}
DASSource.prototype.stylesheet=function(a,b){var c,d=this.credentials;if(this.stylesheet_uri){c=this.stylesheet_uri;d=false}else c=this.uri+"stylesheet";doCrossDomainRequest(c,function(e){if(e){var f=new DASStylesheet;e=e.getElementsByTagName("TYPE");for(var i=0;i<e.length;++i){var h=e[i],j={};j.type=h.getAttribute("id");j.label=h.getAttribute("label");j.method=h.getAttribute("method");h=h.getElementsByTagName("GLYPH");for(var l=0;l<h.length;++l){var p=h[l],m=p.getAttribute("zoom"),r=childElementOf(p);
p=new DASStyle;p.glyph=r.localName;for(r=r.firstChild;r;){if(r.nodeType==Node.ELEMENT_NODE)p[r.localName]=r.firstChild.nodeValue;r=r.nextSibling}f.pushStyle(j,m,p)}}a(f)}else b&&b()},d)};function DASRegistry(a,b){b=b||{};this.uri=a;this.opts=b}
DASRegistry.prototype.sources=function(a,b,c){c||(c={});var d=[];c.taxon&&d.push("organism="+c.taxon);c.auth&&d.push("authority="+c.auth);c.version&&d.push("version="+c.version);c=this.uri;if(d.length>0)c=c+"?"+d.join("&");doCrossDomainRequest(c,function(e){if(!e&&b)b();else{var f=[];e=e.getElementsByTagName("SOURCE");for(var i=0;i<e.length;++i){var h=e[i],j=h.getElementsByTagName("VERSION");if(!(j.length<1)){var l=j[0],p=l.getElementsByTagName("COORDINATES");j=[];for(var m=0;m<p.length;++m){var r=
p[m],s=new DASCoords;s.auth=r.getAttribute("authority");s.taxon=r.getAttribute("taxid");s.version=r.getAttribute("version");j.push(s)}p=[];r=l.getElementsByTagName("CAPABILITY");var o;for(m=0;m<r.length;++m){s=r[m];p.push(s.getAttribute("type"));if(s.getAttribute("type")=="das1:features"){o=s.getAttribute("query_uri");o=o.substring(0,o.length-8)}}m={};l=l.getElementsByTagName("PROP");for(r=0;r<l.length;++r)pusho(m,l[r].getAttribute("name"),l[r].getAttribute("value"));if(o){h=new DASSource(o,{source_uri:h.getAttribute("uri"),
name:h.getAttribute("title"),desc:h.getAttribute("description"),coords:j,props:m,capabilities:p});f.push(h)}}}a(f)}})};function elementValue(a,b){var c=a.getElementsByTagName(b);return c.length>0&&c[0].firstChild?c[0].firstChild.nodeValue:null}function childElementOf(a){if(a.hasChildNodes()){a=a.firstChild;do{if(a.nodeType==Node.ELEMENT_NODE)return a;a=a.nextSibling}while(a!=null)}return null}
function dasLinksOf(a){for(var b=[],c=a.getElementsByTagName("LINK"),d=0;d<c.length;++d){var e=c[d];if(e.parentNode==a)b.push(new DASLink(e.firstChild?e.firstChild.nodeValue:"Unknown",e.getAttribute("href")))}return b}function dasNotesOf(a){var b=[];a=a.getElementsByTagName("NOTE");for(var c=0;c<a.length;++c)a[c].firstChild&&b.push(a[c].firstChild.nodeValue);return b}
function doCrossDomainRequest(a,b,c,d){if(window.XDomainRequest){var e=new XDomainRequest;e.onload=function(){var f=new ActiveXObject("Microsoft.XMLDOM");f.async=false;f.loadXML(e.responseText);b(f)};e.open("get",a)}else{Date.now();e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState==4)if(e.status>=200||e.status==0)b(e.responseXML,e)};e.open("get",a,true);if(c)e.withCredentials=true;d&&e.setRequestHeader("X-DAS-Authorisation",d);e.setRequestHeader("Accept","application/xml,*/*")}e.send("")}
DASSource.prototype.doCrossDomainRequest=function(a,b){var c;if(this.xUser)c="Basic "+btoa(this.xUser+":"+this.xPass);return doCrossDomainRequest(a,b,this.credentials,c)};Browser.prototype.removeAllPopups=function(){removeChildren(this.hPopupHolder);removeChildren(this.popupHolder)};
Browser.prototype.makeTooltip=function(a,b){var c=false,d=this,e=null,f;f=function(){c=false;if(e){clearTimeout(e);e=null}a.removeEventListener("mouseout",f,false)};var i;i=function(h){var j=h.clientX+window.scrollX,l=h.clientY+window.scrollY;e||(e=setTimeout(function(){var p=makeElement("div",[makeElement("div",null,{className:"tooltip-arrow"}),makeElement("div",b,{className:"tooltip-inner"})],{className:"tooltip bottom in"},{display:"block",top:""+(l+20)+"px",left:""+Math.max(j-30,20)+"px"});d.hPopupHolder.appendChild(p);
var m;m=function(r){try{d.hPopupHolder.removeChild(p)}catch(s){}window.removeEventListener("mousemove",m,false);c&&a.offsetParent!=null&&i(r)};window.addEventListener("mousemove",m,false);e=null},1E3))};a.addEventListener("mouseover",function(h){c=true;a.addEventListener("mouseout",f,false);i(h)},false);a.addEventListener("DOMNodeRemovedFromDocument",function(){c=false;if(e){clearTimeout(e);e=null}},false)};
Browser.prototype.popit=function(a,b,c,d){var e=this;d||(d={});var f=d.width||200;d=a.clientX;a=a.clientY;d+=document.documentElement.scrollLeft||document.body.scrollLeft;a+=document.documentElement.scrollTop||document.body.scrollTop;var i=window.innerWidth,h=a+20,j=Math.min(d-f/2,i-f-10),l=makeElement("div");l.className="popover fade bottom in";l.style.display="block";l.style.position="absolute";l.style.top=""+h+"px";l.style.left=""+j+"px";l.style.width=f+"px";if(f>276)l.style.maxWidth=f+"px";l.appendChild(makeElement("div",
null,{className:"arrow"}));if(b){var p=makeElement("button","",{className:"close"});p.innerHTML="&times;";p.addEventListener("mouseover",function(){p.style.color="red"},false);p.addEventListener("mouseout",function(){p.style.color="black"},false);p.addEventListener("mousedown",function(){e.removeAllPopups()},false);b=makeElement("h3",[makeElement("span",b,null,{maxWidth:"200px"}),p],{className:"popover-title"},{});var m,r,s,o;s=function(t){t.stopPropagation();t.preventDefault();j+=t.clientX-m;if(j<
8)j=8;if(j>i-f-32)j=i-f-26;h+=t.clientY-r;h=Math.max(10,h);l.style.top=""+h+"px";l.style.left=""+Math.min(j,i-f-10)+"px";m=t.clientX;r=t.clientY};o=function(t){t.stopPropagation();t.preventDefault();window.removeEventListener("mousemove",s,false);window.removeEventListener("mouseup",o,false)};b.addEventListener("mousedown",function(t){t.preventDefault();t.stopPropagation();m=t.clientX;r=t.clientY;window.addEventListener("mousemove",s,false);window.addEventListener("mouseup",o,false)},false);l.appendChild(b)}l.appendChild(makeElement("div",
c,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(l);var q={node:l,displayed:true};l.addEventListener("DOMNodeRemoved",function(){q.displayed=false},false);return q};function dlog(a){console.log(a)}var MIN_PADDING=3,DEFAULT_SUBTIER_MAX=25;function isDasBooleanTrue(a){a=(""+a).toLowerCase();return a==="yes"||a==="true"}function SubTier(){this.glyphs=[];this.height=0}SubTier.prototype.add=function(a){this.glyphs.push(a);this.height=Math.max(this.height,a.height())};
SubTier.prototype.hasSpaceFor=function(a){for(var b=0;b<this.glyphs.length;++b){var c=this.glyphs[b];if(c.min()<=a.max()&&c.max()>=a.min())return false}return true};var GLOBAL_GC;
function drawFeatureTier(a){GLOBAL_GC=a.viewport.getContext("2d");sortFeatures(a);var b=[],c=false;for(var d in a.ungroupedFeatures){var e=a.ungroupedFeatures[d];if(c=a.styleForFeature(e[0]))if(c.glyph=="LINEPLOT"){b.push(makeLineGlyph(e,c,a));c=true}else for(var f=0;f<e.length;++f){c=e[f];if(!c.parts){var i=glyphForFeature(c,0,a.styleForFeature(c),a);b.push(i)}}}if(a.dasSource.collapseSuperGroups&&!a.bumped)for(var h in a.superGroups){d=a.superGroups[h];a.groups[h].type=a.groups[d[0]].type;e={};
for(i=0;i<d.length;++i){var j=a.groupedFeatures[d[i]];for(f=0;f<j.length;++f){c=j[f];pusho(e,c.type,c)}if(a.groups[h]&&!a.groups[h].links||a.groups[h].links.length==0)a.groups[h].links=a.groups[d[0]].links;delete a.groupedFeatures[d[i]]}for(var l in e){j=e[l];var p=j[0],m=null;for(f=0;f<j.length;++f){c=j[f];c=new Range(c.min,c.max);m=m?union(m,c):c}m=m.ranges();for(var r=0;r<m.length;++r){var s=m[r],o=((s.max()|0)-(s.min()|0)+1)*d.length,q=0;for(f=0;f<j.length;++f){c=j[f];if((c.min|0)<=s.max()&&(c.max|
0)>=s.min()){var t=Math.max(c.min|0,s.min());c=Math.min(c.max|0,s.max());q+=c-t+1}}c=new DASFeature;for(k in p)c[k]=p[k];c.min=s.min();c.max=s.max();if(c.label&&d.length>1)c.label+=" ("+d.length+" vars)";c.visualWeight=1*q/o;pusho(a.groupedFeatures,h,c)}}delete a.superGroups[h]}d=[];for(var v in a.groupedFeatures)d.push(v);d.sort(function(u,x){var y=a.groupedFeatures[u][0].score-a.groupedFeatures[x][0].score;return y>0?-1:y==0?0:1});l={};for(c=0;c<d.length;++c){v=d[c];if(i=glyphsForGroup(a.groupedFeatures[v],
0,a.groups[v],a,a.dasSource.collapseSuperGroups&&!a.bumped?"collapsed_gene":"tent")){i.group=a.groups[v];l[v]=i}}for(h in a.superGroups){d=a.superGroups[h];v=[];c=1E10;e=-10000000000;for(f=0;f<d.length;++f){j=l[d[f]];l[d[f]]=null;if(j){v.push(j);c=Math.min(c,j.min());e=Math.max(e,j.max())}}for(f=0;f<v.length;++f){j=v[f];b.push(new PaddedGlyph(j,c,e))}}for(i in l)(j=l[i])&&b.push(j);h=new SubTier;v=[];c=false;d=a.dasSource.subtierMax||DEFAULT_SUBTIER_MAX;l=0;a:for(;l<b.length;++l){i=b[l];if(i.bump)c=
true;if(i.bump&&(a.bumped||a.dasSource.collapseSuperGroups)){for(c=0;c<v.length;++c){e=v[c];if(e.hasSpaceFor(i)){e.add(i);continue a}}if(v.length>=d)a.status="Too many overlapping features, truncating at "+d;else{e=new SubTier;e.add(i);v.push(e)}}else h.add(i)}if(h.glyphs.length>0)v=[h].concat(v);a.subtiers=v;a.glyphCacheOrigin=a.browser.viewStart}
function formatQuantLabel(a){a=""+a;var b=a.indexOf(".");if(b<0)return a;else{var c=2;a.substring(0,1)=="-"&&++c;return b>=c?a.substring(0,b):a.substring(0,b+2)}}
DasTier.prototype.paint=function(){var a=this.subtiers;if(a){for(var b=this.viewport.width|0,c=MIN_PADDING,d=0;d<a.length;++d)c=c+a[d].height+MIN_PADDING;this.viewport.setAttribute("height",Math.max(c,50));this.viewport.style.left="-1000px";this.holder.style.height=""+Math.max(c,35)+"px";this.norigin=this.browser.viewStart;var e=this.viewport.getContext("2d");e.fillStyle=this.background;e.fillRect(0,0,b,Math.max(c,200));e.restore();e.save();c=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale+
1E3;e.translate(c,MIN_PADDING);for(d=0;d<a.length;++d){for(var f=null,i=a[d].glyphs,h=0;h<i.length;++h){var j=i[h];if(j.min()<b-c&&j.max()>-c){j=i[h];j.draw(e);if(j.quant)f=j.quant}}e.translate(0,a[d].height+MIN_PADDING)}e.restore();if(f&&this.quantOverlay){this.quantOverlay.style.display="block";a=this.viewport.height;this.quantOverlay.height=this.viewport.height;b=this.quantOverlay.getContext("2d");b.fillStyle="white";b.globalAlpha=0.6;b.fillRect(0,0,30,20);b.fillRect(0,a-20,30,20);b.globalAlpha=
1;b.strokeStyle="black";b.lineWidth=1;b.beginPath();b.moveTo(8,3);b.lineTo(0,3);b.lineTo(0,a-3);b.lineTo(8,a-3);b.stroke();b.fillStyle="black";b.fillText(formatQuantLabel(f.max),8,8);b.fillText(formatQuantLabel(f.min),8,a-5)}}};
function glyphsForGroup(a,b,c,d){var e=d.styleForFeature(c),f,i=[];b=null;for(var h=0;h<a.length;++h){var j=a[h];if(j.orientation&&b==null)b=j.orientation;if(!f&&j.label)f=j.label;var l=d.styleForFeature(j);if(l)if(!j.parts)(j=glyphForFeature(j,0,l,d,null,true))&&i.push(j)}a="flat";if(d.dasSource.collapseSuperGroups&&!d.bumped)if(b==="+")a="collapsed+";else{if(b==="-")a="collapsed-"}else if(b==="+")a="hat+";else if(b==="-")a="hat-";d=null;if(f||e&&(e.LABEL||e.LABELS))d=c.label||f;c=new GroupGlyph(i,
a);if(d){if(b==="+")d=">"+d;else if(b==="-")d="<"+d;c=new LabelledGlyph(c,d)}c.bump=true;return c}
function glyphForFeature(a,b,c,d,e,f){var i=d.browser.scale,h=d.browser.viewStart,j=c.glyph||"BOX",l=a.min,p=a.max,m=a.orientation,r=a.score,s=a.label,o=(l-h)*i,q=Math.max((p-h+1)*i,o+1);h=c.HEIGHT||e||12;var t=h=1*h;i=c.BUMP&&isDasBooleanTrue(c.BUMP);var v;if(j==="CROSS"||j==="EX"||j==="TRIANGLE"||j==="DOT"){d=c.FGCOLOR||"black";p=c.BGCOLOR||"none";h=c.HEIGHT||e||12;h=1*h;o=(o+q)/2;o=j==="EX"?new ExGlyph(o,h,d):j==="TRIANGLE"?new TriangleGlyph(o,h,c.DIRECTION||"N",c.LINEWIDTH||h,d):j==="DOT"?new DotGlyph(o,
h,d):new CrossGlyph(o,h,d)}else if(j==="HISTOGRAM"||j==="GRADIENT"&&r!=="undefined"){p=d.dasSource.forceMin||c.MIN||d.currentFeaturesMinScore;(d=d.dasSource.forceMax||c.MAX||d.currentFeaturesMaxScore)||(d=p<0?0:10);p||(p=0);if(1*r<1*p)r=p;if(1*r>1*d)r=d;l=(1*r-p)/(d-p);e=-1*p/(d-p);if(j==="HISTOGRAM"){if(l>=e){h=Math.max(1,(l-e)*t);b=b+(1-e)*t-h}else{h=Math.max(1,(e-l)*t);b+=(1-e)*t}v={min:p,max:d}}d=c.FGCOLOR||null;p=a.override_color||c.BGCOLOR||c.COLOR1||"green";if(c.COLOR2){j=c._gradient;if(!j){j=
makeGradient(50,c.COLOR1,c.COLOR2,c.COLOR3);c._gradient=j}l=l*j.length|0;if(l<0)l=0;if(l>=j.length)l=j.length-1;p=j[l]}o=new BoxGlyph(o,b,q-o,h,p,d)}else if(j==="HIDDEN"){o=new PaddedGlyph(null,o,q);f=true}else if(j==="ARROW"){b=c.FGCOLOR||"purple";j=isDasBooleanTrue(c.PARALLEL);d=isDasBooleanTrue(c.SOUTHWEST);l=isDasBooleanTrue(c.NORTHEAST);o=new ArrowGlyph(o,q,h,b,j,d,l)}else if(j==="ANCHORED_ARROW"){d=c.FGCOLOR||"none";p=c.BGCOLOR||"green";o=new AArrowGlyph(o,q,h,p,d,m);o.bump=true}else if(j===
"SPAN"){d=c.FGCOLOR||"black";o=new SpanGlyph(o,q,h,d)}else if(j==="LINE"){d=c.FGCOLOR||"black";o=new LineGlyph(o,q,h,c.STYLE||"solid",m,d)}else if(j==="PRIMERS"){d=c.FGCOLOR||"black";p=c.BGCOLOR||"red";o=new PrimersGlyph(o,q,h,p,d)}else if(j==="TEXT"){b=c.STRING||"text";p=c.FGCOLOR||"black";o=new TextGlyph(o,q,h,p,b)}else if(j==="TOOMANY"){d=c.FGCOLOR||"gray";p=c.BGCOLOR||"orange";o=new TooManyGlyph(o,q,h,p,d)}else if(j==="POINT"){h=d.forceHeight||c.HEIGHT||30;p=d.dasSource.forceMin||c.MIN||d.currentFeaturesMinScore||
0;d=d.dasSource.forceMax||c.MAX||d.currentFeaturesMaxScore||10;o=new PointGlyph((o+q)/2,h-((r-1*p)*(1*h/(d-p))|0),h)}else if(j==="__SEQUENCE"){b=null;if(d.currentSequence){j=d.currentSequence.start|0;e=d.currentSequence.end|0;if(j<l&&e>p)b=d.currentSequence.seq.substr(l-j,p-l+1)}o=new SequenceGlyph(o,q,h,a.seq,b)}else{d=c.FGCOLOR||null;p=a.override_color||c.BGCOLOR||c.COLOR1||"green";o=new BoxGlyph(o,0,q-o,h,p,d);o.bump=true}if(isDasBooleanTrue(c.LABEL)&&s&&!f)o=new LabelledGlyph(o,s);if(i)o.bump=
true;o.feature=a;if(v)o.quant=v;return o}
DasTier.prototype.styleForFeature=function(a){var b=a._cachedStyle;if(b)return b;b=zoomForScale(this.browser.scale);if(!this.stylesheet)return null;for(var c=null,d=this.stylesheet.styles,e=0;e<d.length;++e){var f=d[e];if(!(f.zoom&&f.zoom!=b)){var i=f._labelRE;if(!i){i=RegExp("^"+f.label+"$");f._labelRE=i}if(!(f.label&&!i.test(a.label))){i=f._methodRE;if(!i){i=RegExp("^"+f.method+"$");f._methodRE=i}if(!(f.method&&!i.test(a.method))){if(f.type)if(f.type=="default"){if(!c)c=f.style;continue}else if(f.type!=
a.type)continue;return a._cachedStyle=f.style}}}}return a._cachedStyle=c};
function makeLineGlyph(a,b,c){var d=c.browser.viewStart,e=c.browser.scale,f=c.forceHeight||b.HEIGHT||30,i=c.dasSource.forceMin||b.MIN||c.currentFeaturesMinScore||0;c=c.dasSource.forceMax||b.MAX||c.currentFeaturesMaxScore||10;var h=1*f/(c-i);b=b.FGCOLOR||b.COLOR1||"black";for(var j=[],l=0;l<a.length;++l){var p=a[l],m=f-((p.score-1*i)*h|0);j.push((((p.min|0)+(p.max|0))/2-d)*e);j.push(m)}a=new LineGraphGlyph(j,b,f);a.quant={min:i,max:c};return a}
var MIN_TILE=75,rulerTileColors=["black","white"],baseColors={A:"green",C:"blue",G:"black",T:"red"},steps=[1,2,5];function tileSizeForScale(a,b){b||(b=MIN_TILE);for(var c=steps.length;a*steps[c%steps.length]*Math.pow(10,c/steps.length|0)<b;)++c;return steps[c%steps.length]*Math.pow(10,c/steps.length|0)}
function drawSeqTier(a,b){var c=a.browser.scale,d=a.browser.viewStart-1E3/c|0,e=a.browser.viewEnd+2E3/c,f=a.browser.currentSeqMax,i=a.viewport.width|0;a.viewport.height=80;a.holder.style.height="80px";var h=a.viewport.getContext("2d");h.fillStyle=a.background;h.fillRect(0,0,i,a.viewport.height);h.translate(1E3,0);i=e;if(f>0&&f<e)i=f;var j=tileSizeForScale(c),l=Math.max(0,(d/j|0)*j);f=a.browser.viewStart;if(b&&b.seq)for(d=d;d<=e;++d){if(d>=b.start&&d<=b.end){i=b.seq.substr(d-b.start,1).toUpperCase();
(j=baseColors[i])||(j="gray");h.fillStyle=j;c>=8?h.fillText(i,(d-f)*c,12):h.fillRect((d-f)*c,5,c,10)}}else for(;l<=i;){h.fillStyle=l/j%2==0?"white":"black";h.strokeStyle="black";h.fillRect((l-f)*c,8,j*c,3);h.strokeRect((l-f)*c,8,j*c,3);h.fillStyle="black";h.fillText(""+l,(l-f)*c,22);l+=j}a.norigin=a.browser.viewStart;a.viewport.style.left="-1000px"}
function svgSeqTier(a,b){var c=a.browser.scale,d=a.browser.viewStart-1E3/c|0,e=a.browser.viewEnd+2E3/c,f=a.browser.currentSeqMax,i=e;if(f>0&&f<e)i=f;var h=tileSizeForScale(c),j=Math.max(0,(d/h|0)*h);f=a.browser.viewStart;var l=makeElementNS(NS_SVG,"g");if(b&&b.seq)for(d=d;d<=e;++d){if(d>=b.start&&d<=b.end){i=b.seq.substr(d-b.start,1).toUpperCase();(h=baseColors[i])||(h="gray");c>=8?l.appendChild(makeElementNS(NS_SVG,"text",i,{x:(d-f)*c,y:15,fill:h})):l.appendChild(makeElementNS(NS_SVG,"rect",null,
{x:(d-f)*c,y:5,width:c,height:10,fill:h}))}}else for(;j<=i;){l.appendChild(makeElementNS(NS_SVG,"rect",null,{x:(j-f)*c,y:8,width:h*c,height:3,fill:j/h%2==0?"white":"black",stroke:"black"}));l.appendChild(makeElementNS(NS_SVG,"text",""+j,{x:(j-f)*c,y:28,fill:"black",stroke:"none"}));j+=h}return l}
function sortFeatures(a){for(var b={},c={},d={},e={},f={},i=[],h,j,l,p=function(){l={};for(var x=0;x<a.currentFeatures.length;++x){var y=a.currentFeatures[x];if(y.id)l[y.id]=y}},m=function(x){var y=[];if(x.parents)for(var A=0;A<x.parents.length;++A){var F=x.parents[A],D=l[F];D&&D.typeCv=="SO:0000704"&&pushnew(y,F)}return y},r=0;r<a.currentFeatures.length;++r){var s=a.currentFeatures[r];if(!s.parts)if(!s.min||!s.max)i.push(s);else{if(s.score&&s.score!="."&&s.score!="-"){sc=1*s.score;if(!h||sc<h)h=
sc;if(!j||sc>j)j=sc}var o=[],q=null;if(s.groups)for(var t=0;t<s.groups.length;++t){var v=s.groups[t],u=v.id;if(v.type=="gene"){q=u;d[u]=shallowCopy(v)}else if(v.type!="translation"){pusho(c,u,s);d[u]=shallowCopy(v);o.push(u)}}if(s.parents){l||p();for(t=0;t<s.parents.length;++t){v=s.parents[t];if(u=l[v]){if(!u.parts)u.parts=[s];pushnewo(c,v,u);pusho(c,v,s);d[v]||(d[v]={type:u.type,id:u.id,label:u.label||u.id});o.push(v);v=m(u);if(v.length>0){q=v[0];u=l[v[0]];d[v[0]]={type:u.type,id:u.id,label:u.label||
u.id};if(!a.dasSource.collapseSuperGroups)a.dasSource.collapseSuperGroups=true}}}}if(o.length==0)pusho(b,s.type,s);else if(q)for(v=0;v<o.length;++v){u=o[v];pushnewo(e,q,u);f[u]=q}}}a.ungroupedFeatures=b;a.groupedFeatures=c;a.groups=d;a.superGroups=e;a.groupsToSupers=f;if(h){if(h>0)h=0;else if(j<0)j=0;a.currentFeaturesMinScore=h;a.currentFeaturesMaxScore=j}}TAGVAL_NOTE_RE=/^([A-Za-z]+)=(.+)/;
Browser.prototype.featurePopup=function(a,b,c){b||(b={});c||(c={});this.removeAllPopups();var d=makeElement("table",null,{className:"table table-striped table-condensed"});d.style.width="100%";d.style.margin="0px";var e=pick(c.type,b.type),f=pick(c.label,b.label,c.id,b.id);if(f&&f.indexOf("__dazzle")!=0)e=e+": "+f;f=0;if(b.method){var i=makeElement("tr",[makeElement("th","Method"),makeElement("td",b.method)]);i.style.backgroundColor=this.tierBackgroundColors[f%this.tierBackgroundColors.length];d.appendChild(i);
++f}i=c.segment?c:b;i=makeElement("tr",[makeElement("th","Location"),makeElement("td",i.segment+":"+i.min+"-"+i.max)]);i.style.backgroundColor=this.tierBackgroundColors[f%this.tierBackgroundColors.length];d.appendChild(i);++f;if(b.score!==undefined&&b.score!==null&&b.score!="-"){i=makeElement("tr",[makeElement("th","Score"),makeElement("td",""+b.score)]);i.style.backgroundColor=this.tierBackgroundColors[f%this.tierBackgroundColors.length];d.appendChild(i);++f}if((i=maybeConcat(c.links,b.links))&&
i.length>0){i=makeElement("tr",[makeElement("th","Links"),makeElement("td",i.map(function(l){return makeElement("div",makeElement("a",l.desc,{href:l.uri,target:"_new"}))}))]);i.style.backgroundColor=this.tierBackgroundColors[f%this.tierBackgroundColors.length];d.appendChild(i);++f}b=maybeConcat(c.notes,b.notes);for(c=0;c<b.length;++c){i="Note";var h=b[c],j=h.match(TAGVAL_NOTE_RE);if(j){i=j[1];h=j[2]}i=makeElement("tr",[makeElement("th",i),makeElement("td",h)]);i.style.backgroundColor=this.tierBackgroundColors[f%
this.tierBackgroundColors.length];d.appendChild(i);++f}this.popit(a,e,d,{width:400})};function Karyoscape(a,b){this.browser=a;this.dsn=b;this.svg=makeElementNS(NS_SVG,"g");this.width=250}Karyoscape.prototype.update=function(a,b,c){this.start=b;this.end=c;if(!this.chr||a!=this.chr){this.chr=a;removeChildren(this.svg);var d=this;this.dsn.features(new DASSegment(a),{type:"karyotype"},function(e,f,i){d.chrLen=i&&i[a]&&i[a].max?i[a].max:null;d.karyos=e||[];d.redraw()})}else this.setThumb()};
var karyo_palette={gneg:"white",gpos25:"rgb(200,200,200)",gpos33:"rgb(180,180,180)",gpos50:"rgb(128,128,128)",gpos66:"rgb(100,100,100)",gpos75:"rgb(64,64,64)",gpos100:"rgb(0,0,0)",gpos:"rgb(0,0,0)",gvar:"rgb(100,100,100)",acen:"rgb(100,100,100)",stalk:"rgb(100,100,100)"};
Karyoscape.prototype.redraw=function(){removeChildren(this.svg);this.karyos=this.karyos.sort(function(m,r){return(m.min|0)-(r.min|0)});if(this.karyos.length>0){if(!this.chrLen)this.chrLen=this.karyos[this.karyos.length-1].max}else{if(!this.chrLen){alert("Warning: insufficient data to set up spatial navigator");this.chrLen=2E8}this.karyos.push({min:1,max:this.chrLen,label:"gneg"})}for(var a=null,b=0;b<this.karyos.length;++b){var c=this.karyos[b],d=1*c.min/this.chrLen*this.width,e=1*c.max/this.chrLen*
this.width,f=karyo_palette[c.label];if(f)if(e>d){d=makeElementNS(NS_SVG,"rect",null,{x:d,y:c.label=="stalk"||c.label=="acen"?5:0,width:e-d,height:c.label=="stalk"||c.label=="acen"?5:15,stroke:"none",fill:f});if(c.label.substring(0,1)=="g"){e=new Range(c.min,c.max);a=a==null?e:union(a,e)}this.browser.makeTooltip(d,c.id);this.svg.appendChild(d)}}if(a){a=a.ranges();b="M 0 10 L 0 0";c="M 0 5 L 0 15";for(var i=f=0;i<a.length;++i){e=a[i];d=1*e.min()/this.chrLen*this.width;e=1*e.max()/this.chrLen*this.width;
if(d-f>0.75){b+=" M "+d+" 0";c+=" M "+d+" 15"}b+=" L "+e+" 0";c+=" L "+e+" 15";f=e}if(this.width-f>0.75){b+=" M "+this.width+" 0";c+=" M "+this.width+" 15"}else{b+=" L "+this.width+" 0";c+=" L "+this.width+" 15"}b+=" L "+this.width+" 10";c+=" L "+this.width+" 5";this.svg.appendChild(makeElementNS(NS_SVG,"path",null,{d:b+" "+c,stroke:"black",strokeWidth:2,fill:"none"}))}this.thumb=makeElementNS(NS_SVG,"rect",null,{x:50,y:-5,width:8,height:25,fill:"blue",fillOpacity:0.5,stroke:"none"});this.svg.appendChild(this.thumb);
this.setThumb();var h=this,j,l=function(m){m.stopPropagation();m.preventDefault();h.thumb.setAttribute("x",Math.max(-4,Math.min(m.clientX+j,h.width-4)))},p=function(m){m.stopPropagation();m.preventDefault();h.onchange&&h.onchange(1*((h.thumb.getAttribute("x")|0)+4)/h.width,true);document.removeEventListener("mousemove",l,true);document.removeEventListener("mouseup",p,true)};this.thumb.addEventListener("mousedown",function(m){m.stopPropagation();m.preventDefault();j=h.thumb.getAttribute("x")-m.clientX;
document.addEventListener("mousemove",l,true);document.addEventListener("mouseup",p,true)},false)};Karyoscape.prototype.setThumb=function(){var a=1*(((this.start|0)+(this.end|0))/2)/this.chrLen*this.width;this.thumb&&this.thumb.setAttribute("x",a-4)};function FetchPool(){this.reqs=[]}FetchPool.prototype.addRequest=function(a){this.reqs.push(a)};FetchPool.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};
function KSCacheBaton(a,b,c,d,e,f){this.chr=a;this.min=b;this.max=c;this.scale=d;this.features=e||[];this.status=f}KSCacheBaton.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};function KnownSpace(a,b,c,d,e,f){this.tierMap=a;this.chr=b;this.min=c;this.max=d;this.scale=e;this.seqSource=f||new DummySequenceSource;this.featureCache={}}KnownSpace.prototype.bestCacheOverlapping=function(){var a=this.featureCache[this.tierMap[0]];return a?a:null};
KnownSpace.prototype.viewFeatures=function(a,b,c,d){if(d!=d)throw"viewFeatures called with silly scale";if(a!=this.chr)throw"Can't extend Known Space to a new chromosome";if(b<1)b=1;this.min=b;this.max=c;this.scale=d;this.pool&&this.pool.abortAll();this.pool=new FetchPool;this.awaitedSeq=new Awaited;this.seqWasFetched=false;this.startFetchesForTiers(this.tierMap)};
function filterFeatures(a,b,c){var d=[];featuresByGroup={};for(var e=0;e<a.length;++e){var f=a[e];if(!f.min||!f.max)d.push(f);else if(f.groups&&f.groups.length>0)pusho(featuresByGroup,f.groups[0].id,f);else f.min<=c&&f.max>=b&&d.push(f)}for(var i in featuresByGroup){a=featuresByGroup[i];var h=1E11,j=-100000000000;for(e=0;e<a.length;++e){f=a[e];h=Math.min(h,f.min);j=Math.max(j,f.max)}if(h<=c||j>=b)for(e=0;e<a.length;++e)d.push(a[e])}return d}
KnownSpace.prototype.invalidate=function(a){this.featureCache[a]=null;this.startFetchesForTiers([a])};
KnownSpace.prototype.startFetchesForTiers=function(a){for(var b=this,c=this.awaitedSeq,d=false,e=0;e<a.length;++e)if(this.startFetchesFor(a[e],c))d=true;if(d&&!this.seqWasFetched){this.seqWasFetched=true;var f=this.min,i=this.max;if(this.cs)if(this.cs.start<=f&&this.cs.end>=i){a=this.cs.start==f&&this.cs.end==i?this.cs:new DASSequence(this.cs.name,f,i,this.cs.alphabet,this.cs.seq.substring(f-this.cs.start,i+1-this.cs.start));return c.provide(a)}this.seqSource.fetch(this.chr,f,i,this.pool,function(h,
j){if(j){if(!b.cs||f<=b.cs.start&&i>=b.cs.end||f>=b.cs.end||i<=b.cs.start||i-f>b.cs.end-b.cs.start)b.cs=j;c.provide(j)}else dlog("Noseq: "+miniJSONify(h))})}};
KnownSpace.prototype.startFetchesFor=function(a,b){var c=this,d=a.getSource()||new DummyFeatureSource,e=a.needsSequence(this.scale),f=c.featureCache[a],i=a.getDesiredTypes(this.scale);if(i===undefined)return false;if(f&&f.chr===this.chr&&f.min<=this.min&&f.max>=this.max){var h=f.features;if(f.min<this.min||f.max>this.max)h=filterFeatures(h,this.min,this.max);c.provision(a,f.chr,Math.max(f.min,this.min),Math.min(f.max,this.max),f.scale,i,h,f.status,e?b:null);h=d.getScales();if(f.scale<=this.scale||
!h)return e}d.fetch(this.chr,this.min,this.max,this.scale,i,this.pool,function(j,l,p){if(!f||c.min<f.min||c.max>f.max)c.featureCache[a]=new KSCacheBaton(c.chr,c.min,c.max,p,l,j);c.provision(a,c.chr,c.min,c.max,p,i,l,j,e?b:null)});return e};
KnownSpace.prototype.provision=function(a,b,c,d,e,f,i,h,j){if(h)a.updateStatus(h);else{h=false;for(var l=a.getSource();MappedFeatureSource.prototype.isPrototypeOf(l);)l=l.source;if(BWGFeatureSource.prototype.isPrototypeOf(l)||BAMFeatureSource.prototype.isPrototypeOf(l))h=true;if(e<this.scale/2&&i.length>200||h&&f&&f.length==1&&f.indexOf("density")>=0)i=downsample(i,this.scale);j?j.await(function(p){a.viewFeatures(b,c,d,e,i,p)}):a.viewFeatures(b,c,d,e,i)}};
function DASFeatureSource(a){this.dasSource=a}DASFeatureSource.prototype.fetch=function(a,b,c,d,e,f,i){if(e&&e.length==0)i(null,[],d);else if(this.dasSource.uri){var h=this.dasSource.maxbins!==false;e={type:e};if(h)e.maxbins=1+((c-b)/d|0);this.dasSource.features(new DASSegment(a,b,c),e,function(j,l){var p=d;h||(p=0.1);i(l,j,p)})}};function DASSequenceSource(a){this.dasSource=a;this.awaitedEntryPoints=new Awaited;var b=this;this.dasSource.entryPoints(function(c){b.awaitedEntryPoints.provide(c)})}
DASSequenceSource.prototype.fetch=function(a,b,c,d,e){this.dasSource.sequence(new DASSegment(a,b,c),function(f){return f.length==1?e(null,f[0]):e("Didn't get sequence")})};DASSequenceSource.prototype.getSeqInfo=function(a,b){this.awaitedEntryPoints.await(function(c){for(var d=0;d<c.length;++d)if(c[d].name==a)return b({length:c[d].end});return b()})};
function TwoBitSequenceSource(a){var b=this;this.source=a;this.twoBit=new Awaited;makeTwoBit(new URLFetchable(a.twoBitURI),function(c,d){d?dlog(d):b.twoBit.provide(c)})}TwoBitSequenceSource.prototype.fetch=function(a,b,c,d,e){this.twoBit.await(function(f){f.fetch(a,b,c,function(i,h){if(h)return e(h,null);else{var j=new DASSequence(a,b,c,"DNA",i);return e(null,j)}})})};
TwoBitSequenceSource.prototype.getSeqInfo=function(a,b){this.twoBit.await(function(c){c.getSeq(a)?c.getSeq(a).length(function(d){b({length:d})}):b()})};DASFeatureSource.prototype.getScales=function(){return[]};var bwg_preflights={};
function BWGFeatureSource(a,b){var c=this;this.bwgSource=a;this.opts=b||{};c.bwgHolder=new Awaited;if(this.opts.preflight){var d=bwg_preflights[this.opts.preflight];if(!d){d=new Awaited;bwg_preflights[this.opts.preflight]=d;var e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState==4)e.status==200?d.provide("success"):d.provide("failure")};e.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),true);if(this.opts.credentials)e.withCredentials=true;e.send("")}d.await(function(f){f===
"success"&&c.init()})}else c.init()}BWGFeatureSource.prototype.init=function(){var a=this,b,c;if(this.bwgSource.bwgURI){b=makeBwgFromURL;c=this.bwgSource.bwgURI}else{b=makeBwgFromFile;c=this.bwgSource.bwgBlob}b(c,function(d){a.bwgHolder.provide(d)},this.opts.credentials)};
BWGFeatureSource.prototype.fetch=function(a,b,c,d,e,f,i){var h=this;this.bwgHolder.await(function(j){if(j==null)return i("Can't access binary file",null,null);var l;l=!e||e.length==0||arrayIndexOf(e,"density")>=0;if(h.opts.clientBin)l=false;if(j.type=="bigwig"||l||typeof h.opts.forceReduction!=="undefined"){l=-1;for(var p=0;p<j.zoomLevels.length;++p)if(j.zoomLevels[p].reduction<=d)l=p;else break;if(typeof h.opts.forceReduction!=="undefined")l=h.opts.forceReduction;l=l<0?j.getUnzoomedView():j.getZoomedView(l)}else l=
j.getUnzoomedView();l.readWigData(a,b,c,function(m){var r=1E9;if(j.type==="bigwig"){var s=(c-b)/m.length/2;if(s<r)r=s}if(h.opts.link)for(s=0;s<m.length;++s){var o=m[s];if(o.label)o.links=[new DASLink("Link",h.opts.link.replace(/\$\$/,o.label))]}i(null,m,r)})})};BWGFeatureSource.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var b=[1],c=0;c<a.zoomLevels.length;++c)b.push(a.zoomLevels[c].reduction);return b}else return null};function BamblrFeatureSource(a){this.bamblr=a}
BamblrFeatureSource.prototype.getScales=function(){return[]};BamblrFeatureSource.prototype.fetch=function(a,b,c,d,e,f,i){var h=d|0;if(h<1)h=1;(new URLFetchable(this.bamblr+"?seq="+a+"&min="+b+"&max="+c+"&rez="+h)).fetch(function(j){if(j==null)dlog("failing bamblr");else{j=new Int32Array(j);for(var l=[],p=0;p<j.length;++p){var m=new DASFeature;m.min=b+p*h;m.max=m.min+h-1;m.segment=a;m.type="bamblr";m.score=j[p];l.push(m)}i(null,l,h)}})};
function BAMFeatureSource(a,b){var c=this;this.bamSource=a;this.opts=b||{};this.bamHolder=new Awaited;if(this.opts.preflight){var d=bwg_preflights[this.opts.preflight];if(!d){d=new Awaited;bwg_preflights[this.opts.preflight]=d;var e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState==4)e.status==200?d.provide("success"):d.provide("failure")};e.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),true);if(this.opts.credentials)e.withCredentials="true";e.send("")}d.await(function(f){f===
"success"&&c.init()})}else c.init()}BAMFeatureSource.prototype.init=function(){var a=this,b,c;if(this.bamSource.bamBlob){b=new BlobFetchable(this.bamSource.bamBlob);c=new BlobFetchable(this.bamSource.baiBlob)}else{b=new URLFetchable(this.bamSource.bamURI,{credentials:this.opts.credentials});c=new URLFetchable(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials})}makeBam(b,c,function(d){a.bamHolder.provide(d)})};
BAMFeatureSource.prototype.fetch=function(a,b,c,d,e,f,i){this.bamHolder.await(function(h){h.fetch(a,b,c,function(j,l){if(l)i(l,null,null);else{for(var p=[],m=0;m<j.length;++m){var r=j[m],s=new DASFeature;s.min=r.pos+1;s.max=r.pos+r.seq.length;s.segment=r.segment;s.type="bam";s.id=r.readName;s.notes=["Sequence="+r.seq,"CIGAR="+r.cigar,"MQ="+r.mq];s.seq=r.seq;p.push(s)}i(null,p,1E9)}})})};BAMFeatureSource.prototype.getScales=function(){return 1E9};
function MappedFeatureSource(a,b){this.source=a;this.mapping=b}MappedFeatureSource.prototype.getScales=function(){return this.source.getScales()};
MappedFeatureSource.prototype.fetch=function(a,b,c,d,e,f,i){var h=this;this.mapping.sourceBlocksForRange(a,b,c,function(j){if(j.length==0)i("No mapping available for this regions",[],d);else{j=j[0];h.source.fetch(j.name,j.start,j.end,d,e,f,function(l,p,m){var r=[];if(p)for(var s=0;s<p.length;++s){var o=p[s],q=o.segment;if(q.indexOf("chr")==0)q=q.substr(3);var t=h.mapping.mapPoint(q,o.min);q=h.mapping.mapPoint(q,o.max);if(!t||!q||t.seq!=q.seq||t.seq!=a)o.parts&&o.parts.length>0&&r.push(o);else{o.segment=
t.seq;o.min=t.pos;o.max=q.pos;if(o.min>o.max){q=o.max;o.max=o.min;o.min=q}if(t.flipped)if(o.orientation=="-")o.orientation="+";else if(o.orientation=="+")o.orientation="-";r.push(o)}}i(l,r,m)})}})};function DummyFeatureSource(){}DummyFeatureSource.prototype.getScales=function(){return null};DummyFeatureSource.prototype.fetch=function(a,b,c,d,e,f,i){return i(null,[],1E9)};function DummySequenceSource(){}DummySequenceSource.prototype.fetch=function(a,b,c,d,e){return e(null,null)};
var VALID_BOUND_RE=/^-?[0-9]+(\.[0-9]+)?$/;
Browser.prototype.makeQuantConfigButton=function(a,b){var c=this;a.addEventListener("mousedown",function(d){d.stopPropagation();d.preventDefault();c.removeAllPopups();var e=makeElement("table"),f=makeElement("input","",{value:b.min});e.appendChild(makeElement("tr",[makeElement("td","Min:"),makeElement("td",f)]));var i=makeElement("input","",{value:b.max});e.appendChild(makeElement("tr",[makeElement("td","Max:"),makeElement("td",i)]));var h=makeElement("div","Update");h.style.backgroundColor="rgb(230,230,250)";
h.style.borderStyle="solid";h.style.borderColor="blue";h.style.borderWidth="3px";h.style.padding="2px";h.style.margin="10px";h.style.width="150px";h.addEventListener("mousedown",function(j){j.stopPropagation();j.preventDefault();if(VALID_BOUND_RE.test(f.value))if(VALID_BOUND_RE.test(i.value)){b.dasSource.forceMin=f.value;b.dasSource.forceMax=i.value;c.removeAllPopups();b.draw();c.storeStatus()}else alert("Don't understand "+i.value);else alert("Don't understand "+f.value)},false);c.popit(d,"Configure: "+
b.dasSource.name,[e,h])},false)};var __DS_SCALES=[1,2,5];function ds_scale(a){return __DS_SCALES[a%__DS_SCALES.length]*Math.pow(10,a/__DS_SCALES.length|0)}function DSBin(a,b,c){this.scale=a;this.cnt=this.tot=0;this.hasScore=false;this.min=b;this.max=c;this.lap=0;this.covered=null}DSBin.prototype.score=function(){return this.cnt==0?0:this.hasScore?this.tot/this.cnt:this.lap/coverage(this.covered)};
DSBin.prototype.feature=function(a){if(a.score){this.tot+=a.score;this.hasScore=true}var b=a.max|0;a=Math.max(this.min,a.min|0);b=Math.min(this.max,b);this.lap+=1*(b-a+1);++this.cnt;b=new Range(a,b);this.covered=this.covered?union(this.covered,b):b};
function downsample(a,b){Date.now();for(var c=0;ds_scale(c+1)<b;)++c;c=ds_scale(c);for(var d=[],e=-10000000000,f=1E10,i=0;i<a.length;++i){var h=a[i];if(h.groups&&h.groups.length>0)return a;var j=h.min/c|0,l=h.max/c|0;e=Math.max(e,l);f=Math.min(f,j);for(j=j;j<=l;++j){var p=d[j];if(!p){p=new DSBin(c,j*c,(j+1)*c-1);d[j]=p}p.feature(h)}}i=[];for(j=f;j<=e;++j)if(p=d[j]){h=new DASFeature;h.segment=a[0].segment;h.min=j*c+1;h.max=(j+1)*c;h.score=p.score();h.type="density";i.push(h)}Date.now();return i}
var hexcase=0,b64pad="";function hex_sha1(a){return rstr2hex(rstr_sha1(str2rstr_utf8(a)))}function b64_sha1(a){return rstr2b64(rstr_sha1(str2rstr_utf8(a)))}function any_sha1(a,b){return rstr2any(rstr_sha1(str2rstr_utf8(a)),b)}function hex_hmac_sha1(a,b){return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)))}function b64_hmac_sha1(a,b){return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)))}
function any_hmac_sha1(a,b,c){return rstr2any(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)),c)}function sha1_vm_test(){return hex_sha1("abc").toLowerCase()=="a9993e364706816aba3e25717850c26c9cd0d89d"}function rstr_sha1(a){return binb2rstr(binb_sha1(rstr2binb(a),a.length*8))}
function rstr_hmac_sha1(a,b){var c=rstr2binb(a);if(c.length>16)c=binb_sha1(c,a.length*8);for(var d=Array(16),e=Array(16),f=0;f<16;f++){d[f]=c[f]^909522486;e[f]=c[f]^1549556828}c=binb_sha1(d.concat(rstr2binb(b)),512+b.length*8);return binb2rstr(binb_sha1(e.concat(c),672))}function rstr2hex(a){for(var b=hexcase?"0123456789ABCDEF":"0123456789abcdef",c="",d,e=0;e<a.length;e++){d=a.charCodeAt(e);c+=b.charAt(d>>>4&15)+b.charAt(d&15)}return c}
function rstr2b64(a){for(var b="",c=a.length,d=0;d<c;d+=3)for(var e=a.charCodeAt(d)<<16|(d+1<c?a.charCodeAt(d+1)<<8:0)|(d+2<c?a.charCodeAt(d+2):0),f=0;f<4;f++)b+=d*8+f*6>a.length*8?b64pad:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>6*(3-f)&63);return b}
function rstr2any(a,b){var c=b.length,d=[],e,f,i,h,j=Array(Math.ceil(a.length/2));for(e=0;e<j.length;e++)j[e]=a.charCodeAt(e*2)<<8|a.charCodeAt(e*2+1);for(;j.length>0;){h=[];for(e=i=0;e<j.length;e++){i=(i<<16)+j[e];f=Math.floor(i/c);i-=f*c;if(h.length>0||f>0)h[h.length]=f}d[d.length]=i;j=h}c="";for(e=d.length-1;e>=0;e--)c+=b.charAt(d[e]);d=Math.ceil(a.length*8/(Math.log(b.length)/Math.log(2)));for(e=c.length;e<d;e++)c=b[0]+c;return c}
function str2rstr_utf8(a){for(var b="",c=-1,d,e;++c<a.length;){d=a.charCodeAt(c);e=c+1<a.length?a.charCodeAt(c+1):0;if(55296<=d&&d<=56319&&56320<=e&&e<=57343){d=65536+((d&1023)<<10)+(e&1023);c++}if(d<=127)b+=String.fromCharCode(d);else if(d<=2047)b+=String.fromCharCode(192|d>>>6&31,128|d&63);else if(d<=65535)b+=String.fromCharCode(224|d>>>12&15,128|d>>>6&63,128|d&63);else if(d<=2097151)b+=String.fromCharCode(240|d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|d&63)}return b}
function str2rstr_utf16le(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a.charCodeAt(c)&255,a.charCodeAt(c)>>>8&255);return b}function str2rstr_utf16be(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a.charCodeAt(c)>>>8&255,a.charCodeAt(c)&255);return b}function rstr2binb(a){for(var b=Array(a.length>>2),c=0;c<b.length;c++)b[c]=0;for(c=0;c<a.length*8;c+=8)b[c>>5]|=(a.charCodeAt(c/8)&255)<<24-c%32;return b}
function binb2rstr(a){for(var b="",c=0;c<a.length*32;c+=8)b+=String.fromCharCode(a[c>>5]>>>24-c%32&255);return b}
function binb_sha1(a,b){a[b>>5]|=128<<24-b%32;a[(b+64>>9<<4)+15]=b;for(var c=Array(80),d=1732584193,e=-271733879,f=-1732584194,i=271733878,h=-1009589776,j=0;j<a.length;j+=16){for(var l=d,p=e,m=f,r=i,s=h,o=0;o<80;o++){c[o]=o<16?a[j+o]:bit_rol(c[o-3]^c[o-8]^c[o-14]^c[o-16],1);var q=safe_add(safe_add(bit_rol(d,5),sha1_ft(o,e,f,i)),safe_add(safe_add(h,c[o]),sha1_kt(o)));h=i;i=f;f=bit_rol(e,30);e=d;d=q}d=safe_add(d,l);e=safe_add(e,p);f=safe_add(f,m);i=safe_add(i,r);h=safe_add(h,s)}return Array(d,e,f,i,
h)}function sha1_ft(a,b,c,d){if(a<20)return b&c|~b&d;if(a<40)return b^c^d;if(a<60)return b&c|b&d|c&d;return b^c^d}function sha1_kt(a){return a<20?1518500249:a<40?1859775393:a<60?-1894007588:-899497514}function safe_add(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535}function bit_rol(a,b){return a<<b|a>>>32-b}
function saveSVG(a){var b=document.implementation.createDocument(NS_SVG,"svg",null),c=makeElementNS(NS_SVG,"g",null,{fontFamily:"helvetica",fontSize:"10pt"});b.documentElement.appendChild(c);var d=makeElementNS(NS_SVG,"text","Graphics from Dalliance "+VERSION,{x:(a.featurePanelWidth+200+20)/2,y:30,strokeWidth:0,fill:"black",fontSize:"12pt",textAnchor:"middle"});c.appendChild(d);d=makeElementNS(NS_SVG,"rect",null,{x:200,y:50,width:a.featurePanelWidth,height:1E5});d=makeElementNS(NS_SVG,"clipPath",
d,{id:"featureClip"});c.appendChild(d);d=70;for(var e=makeElementNS(NS_SVG,"g",null,{clipPath:"url(#featureClip)",clipRule:"nonzero"}),f=0;f<a.tiers.length;++f){var i=a.tiers[f];c.appendChild(makeElementNS(NS_SVG,"text",i.dasSource.name,{x:20,y:d+10}));if(i.dasSource.tier_type==="sequence"){i=svgSeqTier(i,i.currentSequence);e.appendChild(makeElementNS(NS_SVG,"g",i,{transform:"translate(200, "+d+")"}));d+=80}else if(i.subtiers){for(var h=(i.glyphCacheOrigin-a.viewStart)*a.scale,j=0;j<i.subtiers.length;++j){for(var l=
i.subtiers[j],p=[],m=0;m<l.glyphs.length;++m)p.push(l.glyphs[m].toSVG());e.appendChild(makeElementNS(NS_SVG,"g",p,{transform:"translate("+(200+h)+", "+d+")"}));d+=l.height+3}d+=10}}c.appendChild(e);b.documentElement.setAttribute("width",a.featurePanelWidth+20+200);b.documentElement.setAttribute("height",d+50);b=new Blob([(new XMLSerializer).serializeToString(b)]);c=new FileReader;c.onload=function(r){window.open("data:image/svg+xml;"+r.target.result.substring(6),"Dalliance graphics","width="+(a.featurePanelWidth+
20+200+"px"))};c.readAsDataURL(b)}function Range(a,b){this._min=a|0;this._max=b|0}Range.prototype.min=function(){return this._min};Range.prototype.max=function(){return this._max};Range.prototype.contains=function(a){return a>=this._min&&a<=this._max};Range.prototype.isContiguous=function(){return true};Range.prototype.ranges=function(){return[this]};Range.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};function _Compound(a){this._ranges=a}_Compound.prototype.min=function(){return this._ranges[0].min()};
_Compound.prototype.max=function(){return this._ranges[this._ranges.length-1].max()};_Compound.prototype.contains=function(a){for(var b=0;b<this._ranges.length;++b)if(this._ranges[b].contains(a))return true;return false};_Compound.prototype.isContiguous=function(){return this._ranges.length>1};_Compound.prototype.ranges=function(){return this._ranges};_Compound.prototype.toString=function(){for(var a="",b=0;b<this._ranges.length;++b){if(b>0)a+=",";a+=this._ranges[b].toString()}return a};
function union(a,b){for(var c=a.ranges().concat(b.ranges()).sort(rangeOrder),d=[],e=c[0],f=1;f<c.length;++f){var i=c[f];if(i.min()>e.max()+1){d.push(e);e=i}else if(i.max()>e.max())e=new Range(e.min(),i.max())}d.push(e);return d.length==1?d[0]:new _Compound(d)}
function intersection(a,b){for(var c=a.ranges(),d=b.ranges(),e=c.length,f=d.length,i=0,h=0,j=[];i<e&&h<f;){a=c[i];b=d[h];var l=Math.max(a.min(),b.min()),p=Math.min(a.max(),b.max());p>=l&&j.push(new Range(l,p));if(a.max()>b.max())++h;else++i}return j.length==0?null:j.length==1?j[0]:new _Compound(j)}function coverage(a){var b=0;a=a.ranges();for(var c=0;c<a.length;++c){var d=a[c];b+=d.max()-d.min()+1}return b}
function rangeOrder(a,b){return a.min()<b.min()?-1:a.min()>b.min()?1:a.max()<b.max()?-1:b.max()>a.max()?1:0}var __tier_idSeed=0;
function DasTier(a,b,c,d,e,f,i){var h=this;this.id="tier"+ ++__tier_idSeed;this.browser=a;this.dasSource=new DASSource(b);this.viewport=c;this.holder=d;this.overlay=e;this.placard=f;this.placardContent=i;this.req=null;this.layoutHeight=25;this.bumped=true;if(this.dasSource.collapseSuperGroups)this.bumped=false;this.y=0;this.layoutWasDone=false;var j,l;if(this.dasSource.bwgURI||this.dasSource.bwgBlob){j=new BWGFeatureSource(this.dasSource,{credentials:this.dasSource.credentials,preflight:this.dasSource.preflight,
clientBin:this.dasSource.clientBin,forceReduction:this.dasSource.forceReduction,link:this.dasSource.link});this.sourceFindNextFeature=function(m,r,s,o){j.bwgHolder.res.getUnzoomedView().getFirstAdjacent(m,r,s,function(q){q.length>0&&q[0]!=null&&o(q[0])})};!this.dasSource.uri&&!this.dasSource.stylesheet_uri&&j.bwgHolder.await(function(m){if(!m){h.stylesheet=new DASStylesheet;return h.browser.refreshTier(h)}if(h.dasSource.collapseSuperGroups===undefined)if(m.definedFieldCount==12&&m.fieldCount>=14){h.dasSource.collapseSuperGroups=
true;h.bumped=false}if(m.type=="bigbed"){h.stylesheet=new DASStylesheet;m=new DASStyle;m.glyph="BOX";m.FGCOLOR="black";m.BGCOLOR="blue";m.HEIGHT=8;m.BUMP=true;m.LABEL=true;m.ZINDEX=20;h.stylesheet.pushStyle({type:"bigwig"},null,m);m.glyph="BOX";m.FGCOLOR="black";m.BGCOLOR="red";m.HEIGHT=10;m.BUMP=true;m.ZINDEX=20;h.stylesheet.pushStyle({type:"bb-translation"},null,m);m=new DASStyle;m.glyph="BOX";m.FGCOLOR="black";m.BGCOLOR="white";m.HEIGHT=10;m.ZINDEX=10;m.BUMP=true;m.LABEL=true;h.stylesheet.pushStyle({type:"bb-transcript"},
null,m);m=new DASStyle;m.glyph="HISTOGRAM";m.COLOR1="white";m.COLOR2="black";m.HEIGHT=30;h.stylesheet.pushStyle({type:"density"},null,m)}else{h.stylesheet=new DASStylesheet;m=new DASStyle;m.glyph="HISTOGRAM";m.COLOR1="white";m.COLOR2="black";m.HEIGHT=30;h.stylesheet.pushStyle({type:"default"},null,m)}h.browser.refreshTier(h)})}else if(this.dasSource.bamURI||this.dasSource.bamBlob){j=new BAMFeatureSource(this.dasSource,{credentials:this.dasSource.credentials,preflight:this.dasSource.preflight});!this.dasSource.uri&&
!this.dasSource.stylesheet_uri&&j.bamHolder.await(function(){h.stylesheet=new DASStylesheet;var m=new DASStyle;m.glyph="HISTOGRAM";m.COLOR1="black";m.COLOR2="red";m.HEIGHT=30;h.stylesheet.pushStyle({type:"density"},"low",m);h.stylesheet.pushStyle({type:"density"},"medium",m);m=new DASStyle;m.glyph="__SEQUENCE";m.FGCOLOR="black";m.BGCOLOR="blue";m.HEIGHT=8;m.BUMP=true;m.LABEL=false;m.ZINDEX=20;h.stylesheet.pushStyle({type:"bam"},"high",m);h.browser.refreshTier(h)})}else if(this.dasSource.bamblrURI){j=
new BamblrFeatureSource(this.dasSource.bamblrURI);if(!this.dasSource.uri&&!this.dasSource.stylesheet_uri){h.stylesheet=new DASStylesheet;a=new DASStyle;a.glyph="HISTOGRAM";a.COLOR1="black";a.COLOR2="red";a.HEIGHT=30;h.stylesheet.pushStyle({type:"default"},null,a);h.browser.refreshTier(h)}}else if(this.dasSource.tier_type=="sequence")l=this.dasSource.twoBitURI?new TwoBitSequenceSource(this.dasSource):new DASSequenceSource(this.dasSource);else{j=new DASFeatureSource(this.dasSource);var p=false;if(this.dasSource.capabilities&&
arrayIndexOf(this.dasSource.capabilities,"das1:adjacent-feature")>=0)this.sourceFindNextFeature=function(m,r,s,o){if(p)return dlog("Already looking for a next feature, be patient!");p=true;m={adjacent:m+":"+(r|0)+":"+(s>0?"F":"B")};if(r=h.getDesiredTypes(h.browser.scale))m.types=r;h.dasSource.features(null,m,function(q){p=false;if(q.length>0&&q[0]!=null){dlog("DAS adjacent seems to be working...");o(q[0])}})}}if(this.dasSource.mapping)j=new MappedFeatureSource(j,this.browser.chains[this.dasSource.mapping]);
this.featureSource=j;this.sequenceSource=l;this.setBackground()}DasTier.prototype.toString=function(){return this.id};
DasTier.prototype.init=function(){var a=this;if(a.dasSource.style){this.stylesheet={styles:a.dasSource.style};this.browser.refreshTier(this)}else if(a.dasSource.uri||a.dasSource.stylesheet_uri){a.status="Fetching stylesheet";this.dasSource.stylesheet(function(c){a.stylesheet=c;a.browser.refreshTier(a)},function(){a.stylesheet=new DASStylesheet;var c=new DASStyle;c.glyph="BOX";c.BGCOLOR="blue";c.FGCOLOR="black";a.stylesheet.pushStyle({type:"default"},null,c);a.browser.refreshTier(a)})}else if(a.dasSource.twoBitURI){a.stylesheet=
new DASStylesheet;var b=new DASStyle;b.glyph="BOX";b.BGCOLOR="blue";b.FGCOLOR="black";a.stylesheet.pushStyle({type:"default"},null,b);a.browser.refreshTier(a)}};DasTier.prototype.styles=function(){return this.stylesheet==null?null:this.browser.scale>0.2?this.stylesheet.highZoomStyles:this.browser.scale>0.01?this.stylesheet.mediumZoomStyles:this.stylesheet.lowZoomStyles};DasTier.prototype.getSource=function(){return this.featureSource};
DasTier.prototype.getDesiredTypes=function(){var a=[],b=false,c=zoomForScale(this.browser.scale);if(this.stylesheet){for(var d=this.stylesheet.styles,e=0;e<d.length;++e){var f=d[e];if(!f.zoom||f.zoom==c)if(!f.type||f.type=="default"){b=true;break}else pushnew(a,f.type)}return b?null:a}};DasTier.prototype.needsSequence=function(a){if(this.dasSource.tier_type==="sequence"&&a<5)return true;else if((this.dasSource.bamURI||this.dasSource.bamBlob)&&a<20){dlog("reqSeq");return true}return false};
DasTier.prototype.setStatus=function(a){dlog(a)};DasTier.prototype.viewFeatures=function(a,b,c,d,e,f){this.currentFeatures=e;this.currentSequence=f;this.knownChr=a;this.knownStart=b;this.knownEnd=c;this.error=this.status=null;this.setBackground();this.draw()};
DasTier.prototype.updateStatus=function(a){if(a){this.currentFeatures=[];this.currentSequence=null;this.error=a;this.placardContent.innerText=a;this.placard.style.display="block";this.holder.style.display="none"}else{this.placard.style.display="none";this.holder.style.display="block"}};DasTier.prototype.draw=function(){var a=this.currentSequence;this.dasSource.tier_type==="sequence"?drawSeqTier(this,a):drawFeatureTier(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};
function zoomForScale(a){return a>0.2?"high":a>0.01?"medium":"low"}DasTier.prototype.setBackground=function(){};DasTier.prototype.sourceFindNextFeature=function(a,b,c,d){d(null)};
DasTier.prototype.findNextFeature=function(a,b,c,d,e){if(this.knownStart&&b>=this.knownStart&&b<=this.knownEnd)if(this.currentFeatures){for(var f=null,i=0;i<this.currentFeatures.length;++i){var h=this.currentFeatures[i];if(h.min&&h.max)if(!(h.parents&&h.parents.length>0))if(c<0)if(d==1&&h.max>=b&&h.min<b){if(!f||h.min>f.min||h.min==f.min&&h.max<f.max)f=h}else{if(h.max<b)if(!f||h.max>f.max||h.max==f.max&&h.min<f.min||h.min==f.mmin&&f.max>=b)f=h}else if(d==1&&h.min<=b&&h.max>b){if(!f||h.max<f.max||
h.max==f.max&&h.min>f.min)f=h}else if(h.min>b)if(!f||h.min<f.min||h.min==f.min&&h.max>f.max||h.max==f.max&&f.min<=b)f=h}if(f)return e(f);b=c<0?this.knownStart:this.knownEnd}this.sourceFindNextFeature(a,b,c,e)};DasTier.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"icon-minus-sign":"icon-plus-sign";this.bumpButton.style.display=this.dasSource.collapseSuperGroups?"inline-block":"none"};
Browser.prototype.currentlyActive=function(a){for(var b=0;b<this.tiers.length;++b){var c=this.tiers[b].dasSource;if(c.uri==a.uri||c.uri==a.uri+"/"){if(c.tier_type)if(!a.tier_type||a.tier_type!=c.tier_type)continue;if(c.stylesheet_uri)if(!a.stylesheet_uri||a.stylesheet_uri!=c.stylesheet_uri)continue;return true}}return false};Browser.prototype.makeButton=function(a,b){var c=makeElement("a",a,{href:"#"});b&&this.makeTooltip(c,b);return makeElement("li",c)};
function activateButton(a,b){for(var c=0;c<a.length;++c){var d=a[c];d===b?d.classList.add("active"):d.classList.remove("active")}}
Browser.prototype.showTrackAdder=function(a){function b(){C="bin";T.style.visibility="hidden";removeChildren(B);if(h.supportsBinary){B.appendChild(makeElement("h2","Add custom URL-based data"));B.appendChild(makeElement("p",["You can add indexed binary data hosted on an web server that supports CORS (",makeElement("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));B.appendChild(makeElement("br"));B.appendChild(document.createTextNode("URL: "));
x=makeElement("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"});B.appendChild(x);x.focus();B.appendChild(makeElement("br"));B.appendChild(makeElement("b","- or -"));B.appendChild(makeElement("br"));B.appendChild(document.createTextNode("File: "));D=makeElement("input",null,{type:"file"});B.appendChild(D);B.appendChild(makeElement("p",'Clicking the "Add" button below will initiate a series of test queries.'))}else{B.appendChild(makeElement("h2","Your browser does not support binary data"));
B.appendChild(makeElement("p","Browsers currently known to support this feature include Google Chrome 9 or later and Mozilla Firefox 4 or later."))}}function c(){if(C)if(C==="das"){var w=x.value.trim();/^.+:\/\//.exec(w)||(w="http://"+w);w=new DASSource({name:"temporary",uri:w});J(w)}else if(C==="bin"){var H={name:"temporary"};if((w=D.files)&&w.length>0&&w[0]){H.bwgBlob=w[0];H.noPersist=true}else{w=x.value.trim();/^.+:\/\//.exec(w)||(w="http://"+w);H.bwgURI=w}w=new DASSource(H);V(w)}else if(C==="reset")M();
else if(C==="reset-bin")b();else if(C==="prompt-bai")if((w=D.files)&&w.length>0&&w[0]){G.baiBlob=w[0];f(G)}else e(G);else{if(C==="finalize"){G.name=y.value;H=A.value;G.mapping=H!="__default__"?H:undefined;if(F)G.maxbins=F.checked;if(z.value.length>1&&E.value.length>1){dlog("password");G.xUser=z.value;G.xPass=E.value}h.sources.push(G);h.makeTier(G);h.removeAllPopups()}}else{for(H=0;H<u.length;++H){w=u[H];if(w.checked){w=w.dalliance_source;h.sources.push(w);h.makeTier(w)}}h.removeAllPopups()}}function d(w,
H){var L=w.uri;if(H){var R=/(.+)\/[^\/]+\/?/.exec(L);if(R)L=R[1]+"/sources"}(new DASRegistry(L,{credentials:w.credentials})).sources(function(K){if(!K||K.length==0)return H?I(w):d(w,true);var N=null;if(K.length==1)N=K[0];else for(var O=0;O<K.length;++O)if(K[O].uri===w.uri){N=K[O];break}O=K=false;if(N){w.name=N.name;w.desc=N.desc;w.maxbins=N.maxbins?true:false;if(N.capabilities)w.capabilities=N.capabilities;O=true;if(N.coords&&N.coords.length==1){N=N.coords[0];if(coordsMatch(N,h.coordSystem))K=true;
else if(h.chains)for(var U in h.chains)if(coordsMatch(N,h.chains[U].coords)){w.mapping=U;K=true}}}return I(w,K,O)},function(){return H?I(w):d(w,true)})}function e(w){removeChildren(B);C="prompt-bai";B.appendChild(makeElement("h2","Select an index file"));B.appendChild(makeElement("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file"));
B.appendChild(document.createTextNode("Index file: "));D=makeElement("input",null,{type:"file"});B.appendChild(D);G=w}function f(w){(w.baiBlob?new BlobFetchable(w.baiBlob):new URLFetchable(w.bwgURI+".bai")).slice(0,256).fetch(function(H){var L=false;if(H){H=new Uint8Array(H);L=readInt(H,0)==BAI_MAGIC}if(L){if(H=/\/?([^\/]+?)(.bam)?$/.exec(w.bwgURI||w.bwgBlob.name))w.name=H[1];w.bamURI=w.bwgURI;w.bamBlob=w.bwgBlob;w.bwgURI=undefined;w.bwgBlob=undefined;return I(w,false,false,true)}else return i("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}
function i(w){removeChildren(B);w=w||"Custom data format not recognized";B.appendChild(makeElement("h2","Error adding custom data"));B.appendChild(makeElement("p",w));B.appendChild(makeElement("p","Currently supported formats are bigBed, bigWig, and BAM."));C="reset-bin"}var h=this,j=a.clientX,l=a.clientY;j+=document.documentElement.scrollLeft||document.body.scrollLeft;l+=document.documentElement.scrollTop||document.body.scrollTop;j=makeElement("div");j.appendChild(makeElement("div",null));var p=
[],m,r,s=this.makeButton("Registry","Browse compatible datasources from the DAS registry");p.push(s);for(var o in this.mappableSources)(function(w){var H=h.makeButton(h.chains[w].srcTag,"Browse datasources mapped from "+h.chains[w].srcTag);p.push(H);H.addEventListener("click",function(L){L.preventDefault();L.stopPropagation();activateButton(p,H);m(h.mappableSources[w],w)},false)})(o);var q=this.makeButton("Defaults","Browse the default set of data for this browser");p.push(q);var t=this.makeButton("Custom",
"Add arbitrary DAS data");p.push(t);var v=this.makeButton("Binary","Add data in bigwig or bigbed format");p.push(v);activateButton(p,s);j.appendChild(makeElement("ul",p,{className:"nav nav-tabs"}));j.appendChild(makeElement("div",null,{},{clear:"both",height:"10px"}));var u=[],x,y,A,F,D,z,E,C=false,G=null;o=makeElement("form",null,{},{clear:"both"});o.addEventListener("submit",function(w){w.stopPropagation();w.preventDefault();c();return false},true);var B=document.createElement("div");B.style.position=
"relative";B.style.overflow="auto";B.style.height="400px";o.appendChild(B);var P,Q;m=function(w,H){T.style.visibility="visible";Q&&Q.removeListener(r);P=H;Q=w;Q.addListenerAndFire(r)};r=function(w){C=false;u=[];removeChildren(B);if(w){var H=document.createElement("table");H.className="table table-striped table-condensed";H.style.width="100%";for(var L=0,R=[],K=0;K<w.length;++K)R.push(w[K]);R.sort(function(W,X){return W.name.toLowerCase().trim().localeCompare(X.name.toLowerCase().trim())});for(K=0;K<
R.length;++K){w=R[K];var N=document.createElement("tr");N.style.backgroundColor=h.tierBackgroundColors[L%h.tierBackgroundColors.length];var O=document.createElement("td");O.style.textAlign="center";if(h.currentlyActive(w)){O.appendChild(document.createTextNode("X"));h.makeTooltip(O,"This data source is already active.")}else if(!w.props||w.props.cors){var U=document.createElement("input");U.type="checkbox";U.dalliance_source=w;if(P)U.dalliance_mapping=P;O.appendChild(U);u.push(U);h.makeTooltip(O,
"Check here then click 'Add' to activate.")}else{O.appendChild(document.createTextNode("!"));h.makeTooltip(O,makeElement("span",["This data source isn't accessible because it doesn't support ",makeElement("a","CORS",{href:"http://www.w3.org/TR/cors/"}),"."]))}N.appendChild(O);O=document.createElement("td");O.appendChild(document.createTextNode(w.name));w.desc&&w.desc.length>0&&h.makeTooltip(O,w.desc);N.appendChild(O);H.appendChild(N);++L}B.appendChild(H)}else B.appendChild(makeElement("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};
s.addEventListener("click",function(w){w.preventDefault();w.stopPropagation();activateButton(p,s);m(h.availableSources)},false);q.addEventListener("click",function(w){w.preventDefault();w.stopPropagation();activateButton(p,q);m(new Observed(h.defaultSources))},false);v.addEventListener("click",function(w){w.preventDefault();w.stopPropagation();activateButton(p,v);b()},false);t.addEventListener("click",function(w){w.preventDefault();w.stopPropagation();activateButton(p,t);M()},false);var M=function(){C=
"das";T.style.visibility="hidden";removeChildren(B);var w=makeElement("div");w.appendChild(makeElement("h2","Add custom DAS data"));w.appendChild(makeElement("p","This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));w.appendChild(document.createTextNode("URL: "));w.appendChild(makeElement("br"));x=makeElement("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"});w.appendChild(x);w.appendChild(makeElement("p",
'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));B.appendChild(w);x.focus()};l=makeElement("button","Add",{className:"btn btn-primary"});l.addEventListener("click",function(w){w.stopPropagation();w.preventDefault();c()},false);var J=function(w,H){var L=h.knownSpace;if(L){var R=Math.max(L.min,(L.min+L.max-100)/2)|0;L=new DASSegment(L.chr,R,Math.min(R+99,L.max));w.features(L,{},function(K,N){if(N)if(H){removeChildren(B);
B.appendChild(makeElement("h2","Custom data not found"));B.appendChild(makeElement("p","DAS uri: "+w.uri+" is not answering features requests"));C="reset"}else{dlog("retrying with credentials");w.credentials=true;J(w,true)}else{var O=/\/([^\/]+)\/?$/.exec(w.uri);if(O)w.name=O[1];d(w)}})}else alert("Can't confirm track-addition to an uninit browser.")},V=function(w){(w.bwgURI?new URLFetchable(w.bwgURI):new BlobFetchable(w.bwgBlob)).slice(0,65536).fetch(function(H,L){if(H){var R=new Uint8Array(H),K=
readInt(R,0);if(K==BIG_WIG_MAGIC||K==BIG_BED_MAGIC){if(R=/\/?([^\/]+?)(.bw|.bb|.bigWig|.bigBed)?$/.exec(w.bwgURI||w.bwgBlob.name))w.name=R[1];return I(w,false,false,true)}else{if(R[0]!=31||R[1]!=139)return i();R=unbgzf(H);R=new Uint8Array(R);K=readInt(R,0);return K==BAM_MAGIC?w.bwgBlob?e(w):f(w):i()}}else{removeChildren(B);B.appendChild(makeElement("h2","Custom data not found"));w.bwgURI?B.appendChild(makeElement("p","Data URI: "+w.bwgURI+" is not accessible.")):B.appendChild(makeElement("p","File access failed, are you using an up-to-date browser?"));
L&&B.appendChild(makeElement("p",""+L));B.appendChild(makeElement("p","If in doubt, please check that the server where the file is hosted supports CORS."));C="reset-bin"}})},I=function(w,H,L,R){removeChildren(B);B.appendChild(makeElement("h2","Add custom data: step 2"));B.appendChild(document.createTextNode("Label: "));y=makeElement("input","",{value:w.name});B.appendChild(y);z=makeElement("input","");E=makeElement("input","");B.appendChild(makeElement("br"));B.appendChild(makeElement("br"));B.appendChild(makeElement("h4",
"Coordinate system: "));A=makeElement("select",null);A.appendChild(makeElement("option",h.coordSystem.auth+h.coordSystem.version,{value:"__default__"}));if(h.chains)for(var K in h.chains){var N=h.chains[K].coords;A.appendChild(makeElement("option",N.auth+N.version,{value:K}))}A.value=w.mapping||"__default__";B.appendChild(A);if(H)B.appendChild(makeElement("p","(Based on server response, probably doesn't need changing.)"));else{B.appendChild(makeElement("p",[makeElement("b","Warning: "),"unable to determine the correct value from server responses.  Please check carefully."]));
B.appendChild(makeElement("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org"))}if(!R){B.appendChild(document.createTextNode("Quantitative: "));F=makeElement("input",null,{type:"checkbox",checked:true});if(typeof w.maxbins!=="undefined")F.checked=w.maxbins;B.appendChild(F);L?B.appendChild(makeElement("p","(Based on server response, probably doesn't need changing.)")):B.appendChild(makeElement("p",[makeElement("b","Warning: "),"unable to determine correct value.  If in doubt, leave checked."]))}w.bwgBlob&&
B.appendChild(makeElement("p",[makeElement("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));y.focus();C="finalize";G=w},S=makeElement("button","Cancel",{className:"btn"});S.addEventListener("click",function(w){w.stopPropagation();w.preventDefault();h.removeAllPopups()},false);var T=makeElement("button","Refresh",{className:"btn"});T.addEventListener("click",function(w){w.stopPropagation();w.preventDefault();h.queryRegistry(P)},
false);this.makeTooltip(T,"Click to re-fetch data from the DAS registry");l=makeElement("div",[l," ",S," ",T]);l.style.margin="10px";o.appendChild(l);j.appendChild(o);m(h.availableSources);this.popit(a,"Add DAS data",j,{width:500});this.trackAdderVisible=true;j.addEventListener("DOMNodeRemovedFromDocument",function(){h.trackAdderVisible=false},false)};var TWOBIT_MAGIC=440477507;function TwoBitFile(){}
function makeTwoBit(a,b){var c=new TwoBitFile;c.data=a;c.data.slice(0,1024).fetch(function(d){if(!d)return b(null,"Couldn't access data");d=new Uint8Array(d);if(readInt(d,0)!=TWOBIT_MAGIC)return b(null,"Not a .2bit fie");var e=readInt(d,4);if(e!=0)return b(null,"Unsupported version "+e);c.seqCount=readInt(d,8);c.seqDict={};e=16;for(var f=0;f<c.seqCount;++f){for(var i=d[e++],h="",j=1;j<=i;++j)h+=String.fromCharCode(d[e++]);i=readInt(d,e);e+=4;c.seqDict[h]=new TwoBitSeq(c,i)}return b(c)})}
TwoBitFile.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};TwoBitFile.prototype.fetch=function(a,b,c,d){var e=this.getSeq(a);if(e)e.fetch(b,c,d);else return d(null,"Couldn't find "+a)};function TwoBitSeq(a,b){this.tbf=a;this.offset=b}
TwoBitSeq.prototype.init=function(a){if(this.seqOffset)return a();var b=this;b.tbf.data.slice(b.offset,8).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);b.length=readInt(c,0);b.nBlockCnt=readInt(c,4);b.tbf.data.slice(b.offset+8,b.nBlockCnt*8+4).fetch(function(d){if(!d)return a("Fetch failed");d=new Uint8Array(d);for(var e=null,f=0;f<b.nBlockCnt;++f){var i=readInt(d,f*4),h=readInt(d,(f+b.nBlockCnt)*4);i=new Range(i,i+h-1);e=e?union(e,i):i}b.nBlocks=e;b.mBlockCnt=readInt(d,b.nBlockCnt*
8);b.seqLength=(b.length+3)/4|0;b.seqOffset=b.offset+16+(b.nBlockCnt+b.mBlockCnt)*8;return a()})})};var TWOBIT_TABLE=["T","C","A","G"];
TwoBitSeq.prototype.fetch=function(a,b,c){--a;--b;var d=this;this.init(function(e){if(e)return c(null,e);var f=a>>2;e=b+3>>2;if(f<0||e>d.seqLength)return c("Coordinates out of bounds: "+a+":"+b);d.tbf.data.slice(d.seqOffset+f,e-f).fetch(function(i){function h(s){for(;m<=s;){var o=m&3,q=j[(m>>2)-f];p+=TWOBIT_TABLE[o==0?q>>6&3:o==1?q>>4&3:o==2?q>>2&3:q&3];++m}}if(i==null)return c("SeqFetch failed");var j=new Uint8Array(i);i=[];if(d.nBlocks){var l=intersection(new Range(a,b),d.nBlocks);if(l)i=l.ranges()}var p=
"",m=a;for(l=0;l<i.length;++l){var r=i[l];if(m>r.min())throw"N mismatch...";for(m<r.min()&&h(r.min()-1);m<r.max();){p+="N";++m}}m<b&&h(b);return c(p)})})};TwoBitSeq.prototype.length=function(a){var b=this;this.init(function(c){return c?a(null,c):a(b.length)})};var NUM_REGEXP=/[0-9]+/;function stringToNumbersArray(a){for(var b=[],c;c=NUM_REGEXP.exec(a);){b.push(c[0]);a=a.substring(c.index+c[0].length)}return b}var STRICT_NUM_REGEXP=/^[0-9]+$/;
function stringToInt(a){a=a.replace(RegExp(",","g"),"");if(!STRICT_NUM_REGEXP.test(a))return null;return a|0}function pushnew(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function pusho(a,b,c){if(a[b])a[b].push(c);else a[b]=[c]}function pushnewo(a,b,c){var d=a[b];if(d){for(a=0;a<d.length;++a)if(d[a]==c)return;d.push(c)}else a[b]=[c]}function pick(a,b,c,d){if(a)return a;else if(b)return b;else if(c)return c;else if(d)return d}
function pushnew(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function maybeConcat(a,b){var c=[];if(a)for(var d=0;d<a.length;++d)pushnew(c,a[d]);if(b)for(d=0;d<b.length;++d)pushnew(c,b[d]);return c}function arrayIndexOf(a,b){if(!a)return-1;for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function arrayRemove(a,b){var c=arrayIndexOf(a,b);if(c>=0){a.splice(c,1);return true}return false}
function makeElement(a,b,c,d){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var e=0;e<b.length;++e){var f=b[e];if(typeof f=="string")f=document.createTextNode(f);a.appendChild(f)}}if(c)for(var i in c)a[i]=c[i];if(d)for(i in d)a.style[i]=d[i];return a}function makeElementNS(a,b,c,d){a=document.createElementNS(a,b);if(c){c instanceof Array||(c=[c]);for(b=0;b<c.length;++b){var e=c[b];if(typeof e=="string")e=document.createTextNode(e);a.appendChild(e)}}setAttrs(a,d);return a}
var attr_name_cache={};function setAttr(a,b,c){var d=attr_name_cache[b];if(!d){d="";for(var e=0;e<b.length;++e){var f=b.substring(e,e+1),i=f.toLowerCase();d=i!=f?d+"-"+i:d+f}d=attr_name_cache[b]=d}a.setAttribute(d,c)}function setAttrs(a,b){if(b)for(var c in b)setAttr(a,c,b[c])}function removeChildren(a){if(a&&a.childNodes)for(;a.childNodes.length>0;)a.removeChild(a.firstChild)}
function miniJSONify(a){if(typeof a==="undefined")return"undefined";else if(a==null)return"null";else if(typeof a=="string")return"'"+a+"'";else if(typeof a=="number")return""+a;else if(typeof a=="boolean")return""+a;else if(typeof a=="object")if(a instanceof Array){for(var b=null,c=0;c<a.length;++c)b=(b==null?"":b+", ")+miniJSONify(a[c]);return"["+(b?b:"")+"]"}else{b=null;for(c in a)if(c!=undefined&&typeof a[c]!="function")b=(b==null?"":b+", ")+c+": "+miniJSONify(a[c]);return"{"+(b?b:"")+"}"}else return typeof a}
function shallowCopy(a){n={};for(k in a)n[k]=a[k];return n}function Observed(a){this.value=a;this.listeners=[]}Observed.prototype.addListener=function(a){this.listeners.push(a)};Observed.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};Observed.prototype.removeListener=function(a){arrayRemove(this.listeners,a)};Observed.prototype.get=function(){return this.value};Observed.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};
function Awaited(){this.queue=[]}Awaited.prototype.provide=function(a){if(this.res)throw"Resource has already been provided.";this.res=a;for(var b=0;b<this.queue.length;++b)this.queue[b](a)};Awaited.prototype.await=function(a){if(this.res){a(this.res);return this.res}else this.queue.push(a)};if(!("trim"in String.prototype))String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")};var VERSION={CONFIG:3,MAJOR:0,MINOR:8,MICRO:5,PATCH:"",BRANCH:""};
VERSION.toString=function(){var a=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;if(this.PATCH)a+=this.PATCH;if(this.BRANCH&&this.BRANCH!="")a=a+"-"+this.BRANCH;return a};function formatLongInt(a){return(a|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}
Browser.prototype.initUI=function(a,b){document.head.appendChild(makeElement("link","",{rel:"stylesheet",href:this.uiPrefix+"css/bootstrap-scoped.css"}));document.head.appendChild(makeElement("link","",{rel:"stylesheet",href:this.uiPrefix+"css/dalliance-scoped.css"}));var c=this,d=/([\d+,\w,\.,\_,\-]+):(\d+)([\-,\,.](\d+))?/;c.disableDefaultFeaturePopup||this.addFeatureListener(function(q,t){c.featurePopup(q,t,null)});a.classList.add("dalliance");var e=makeElement("div",null,{className:"btn-toolbar"}),
f=c.coordSystem.speciesName+" "+c.coordSystem.auth+c.coordSystem.version;if(this.setDocumentTitle)document.title=f+" :: dalliance";this.noTitle||e.appendChild(makeElement("div",makeElement("h4",f,{},{margin:"0px"}),{className:"btn-group"},{verticalAlign:"top"}));var i=makeElement("input","",{className:"loc-field"});c.makeTooltip(i,"Enter a genomic location or gene name");var h=makeElement("p","",{className:"loc-status"});e.appendChild(makeElement("div",[i,h],{className:"btn-group"},{verticalAlign:"top",
marginLeft:"10px",marginRight:"5px"}));f=makeElement("a",[makeElement("i",null,{className:"icon-zoom-in"})],{className:"btn"});var j=makeElement("input","",{type:"range",min:100,max:250},{width:"200px"}),l=makeElement("a",[makeElement("i",null,{className:"icon-zoom-out"})],{className:"btn"});e.appendChild(makeElement("div",[f,makeElement("span",j,{className:"btn"}),l],{className:"btn-group"},{verticalAlign:"top"}));var p=makeElement("a",[makeElement("i",null,{className:"icon-plus"})],{className:"btn"}),
m=makeElement("a",[makeElement("i",null,{className:"icon-bookmark"})],{className:"btn"}),r=makeElement("a",[makeElement("i",null,{className:"icon-print"})],{className:"btn"}),s=makeElement("a",[makeElement("i",null,{className:"icon-refresh"})],{className:"btn"}),o=makeElement("a",[makeElement("i",null,{className:"icon-cog"})],{className:"btn"});e.appendChild(makeElement("div",[p,r,s,o],{className:"btn-group"},{verticalAlign:"top"}));a.appendChild(e);a.appendChild(b);this.addViewListener(function(q,
t,v,u){i.value="";i.placeholder="chr"+q+":"+formatLongInt(t)+".."+formatLongInt(v);j.value=u;c.storeStatus&&c.storeStatus()});i.addEventListener("keydown",function(q){if(q.keyCode==40){q.preventDefault();q.stopPropagation();c.setSelectedTier(0)}if(q.keyCode==10||q.keyCode==13){q.preventDefault();var t=i.value,v=d.exec(t),u=function(A){h.innerText=A?""+A:""};if(v){console.log(v);q=v[1];var x;if(v[4]){x=v[2]|0;v=v[4]|0}else{var y=c.viewEnd-c.viewStart+1;x=(v[2]|0)-y/2|0;v=x+y-1}c.setLocation(q,x,v,
u)}else{if(!t||t.length==0)return false;c.searchEndpoint.features(null,{group:t,type:"transcript"},function(A){A||(A=[]);for(var F=5E8,D=-100000000,z=null,E=0;E<A.length;++E){var C=A[E];if(C.label.toLowerCase()==t.toLowerCase()){if(z==null)z=C.segment;F=Math.min(F,C.min);D=Math.max(D,C.max)}}if(z){c.highlightRegion(z,F,D);A=Math.max(2500,0.3*(D-F+1)|0);c.setLocation(z,F-A,D+A,u)}else h.innerText="no match for '"+t+"' (search should improve soon!)"},false)}}},false);this.addRegionSelectListener(function(){});
this.addTierListener(function(){c.storeStatus&&c.storeStatus()});p.addEventListener("click",function(q){c.trackAdderVisible?c.removeAllPopups():c.showTrackAdder(q)},false);c.makeTooltip(p,"Add a new track from the registry or an indexed file.");f.addEventListener("click",function(q){q.stopPropagation();q.preventDefault();c.zoomStep(-10)},false);c.makeTooltip(f,"Zoom in");l.addEventListener("click",function(q){q.stopPropagation();q.preventDefault();c.zoomStep(10)},false);c.makeTooltip(l,"Zoom out");
j.addEventListener("change",function(){c.zoomSliderValue=1*j.value;c.zoom(Math.exp(1*j.value/c.zoomExpt))},false);j.min=c.zoomMin;j.max=c.zoomMax;m.addEventListener("click",function(q){q.stopPropagation();q.preventDefault()},false);c.makeTooltip(m,"Favourite regions");r.addEventListener("click",function(q){q.stopPropagation();q.preventDefault();saveSVG(c)},false);c.makeTooltip(r,"Export publication-quality SVG.");s.addEventListener("click",function(q){q.stopPropagation();q.preventDefault();for(q=
c.tiers.length-1;q>=0;--q)c.removeTier({index:q});for(q=0;q<c.defaultSources.length;++q)c.addTier(c.defaultSources[q]);c.setLocation(c.defaultChr,c.defaultStart,c.defaultEnd)},false);c.makeTooltip(s,"Reset to default tracks and view.");o.addEventListener("click",function(q){q.stopPropagation();q.preventDefault();if(c.optionsVisible)c.removeAllPopups();else{var t=makeElement("form",null,{className:"popover-content"}),v=makeElement("input","",{type:"checkbox",checked:c.reverseScrolling});v.addEventListener("change",
function(){c.reverseScrolling=v.checked},false);t.appendChild(makeElement("label",[v,"Reverse trackpad scrolling"],{className:"checkbox"}));c.removeAllPopups();c.popit(q,"Options",t,{width:300});c.optionsVisible=true;t.addEventListener("DOMNodeRemovedFromDocument",function(){c.optionsVisible=false},false)}},false);c.addTierSelectionWrapListener(function(q){if(q<0){c.setSelectedTier(null);i.focus()}})};
function BoxGlyph(a,b,c,d,e,f,i){this.x=a;this.y=b;this._width=c;this._height=d;this.fill=e;this.stroke=f;this._radius=i||0}
BoxGlyph.prototype.draw=function(a){var b=this._radius;a.beginPath();if(b>0){a.moveTo(this.x+b,this.y);a.lineTo(this.x+this._width-b,this.y);a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+b,b);a.lineTo(this.x+this._width,this.y+this._height-b);a.arcTo(this.x+this._width,this.y+this._height,this.x+this._width-b,this.y+this._height,b);a.lineTo(this.x+b,this.y+this._height);a.arcTo(this.x,this.y+this._height,this.x,this.y+this._height-b,b);a.lineTo(this.x,this.y+b);a.arcTo(this.x,this.y,
this.x+b,this.y,b)}else{a.lineJoin="miter";a.lineCap="square";a.moveTo(this.x,this.y);a.lineTo(this.x+this._width,this.y);a.lineTo(this.x+this._width,this.y+this._height);a.lineTo(this.x,this.y+this._height);a.lineTo(this.x,this.y)}a.closePath();if(this.fill){a.fillStyle=this.fill;a.fill()}if(this.stroke){a.strokeStyle=this.stroke;a.lineWidth=0.5;a.stroke()}};
BoxGlyph.prototype.toSVG=function(){return makeElementNS(NS_SVG,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,stroke:this.stroke||"none",fill:this.fill||"none"})};BoxGlyph.prototype.min=function(){return this.x};BoxGlyph.prototype.max=function(){return this.x+this._width};BoxGlyph.prototype.height=function(){return this.y+this._height};
function GroupGlyph(a,b){this.glyphs=a;this.connector=b;this.h=a[0].height();var c=new Range(a[0].min(),a[0].max());for(g=1;g<a.length;++g){var d=a[g];c=union(c,new Range(d.min(),d.max()));this.h=Math.max(this.h,d.height())}this.coverage=c}
GroupGlyph.prototype.draw=function(a){for(var b=0;b<this.glyphs.length;++b){var c=this.glyphs[b];c.draw(a)}b=this.coverage.ranges();for(var d=1;d<b.length;++d){c=b[d];var e=b[d-1];if(e&&c.min()>e.max()){e=e.max();c=c.min();var f=(e+c)/2;a.beginPath();if(this.connector==="hat+"){a.moveTo(e,this.h/2);a.lineTo(f,0);a.lineTo(c,this.h/2)}else if(this.connector==="hat-"){a.moveTo(e,this.h/2);a.lineTo(f,this.h);a.lineTo(c,this.h/2)}else if(this.connector==="collapsed+"){a.moveTo(e,this.h/2);a.lineTo(c,this.h/
2);if(c-e>4){a.moveTo(f-2,this.h/2-5);a.lineTo(f+2,this.h/2);a.lineTo(f-2,this.h/2+5)}}else if(this.connector==="collapsed-"){a.moveTo(e,this.h/2);a.lineTo(c,this.h/2);if(c-e>4){a.moveTo(f+2,this.h/2-5);a.lineTo(f-2,this.h/2);a.lineTo(f+2,this.h/2+5)}}else{a.moveTo(e,this.h/2);a.lineTo(c,this.h/2)}a.stroke()}}};function SVGPath(){this.ops=[]}SVGPath.prototype.moveTo=function(a,b){this.ops.push("M "+a+" "+b)};SVGPath.prototype.lineTo=function(a,b){this.ops.push("L "+a+" "+b)};
SVGPath.prototype.closePath=function(){this.ops.push("Z")};SVGPath.prototype.toPathData=function(){return this.ops.join(" ")};
GroupGlyph.prototype.toSVG=function(){for(var a=makeElementNS(NS_SVG,"g"),b=0;b<this.glyphs.length;++b)a.appendChild(this.glyphs[b].toSVG());b=this.coverage.ranges();for(var c=1;c<b.length;++c){var d=b[c],e=b[c-1];if(e&&d.min()>e.max()){e=e.max();d=d.min();var f=(e+d)/2,i=new SVGPath;if(this.connector==="hat+"){i.moveTo(e,this.h/2);i.lineTo(f,0);i.lineTo(d,this.h/2)}else if(this.connector==="hat-"){i.moveTo(e,this.h/2);i.lineTo(f,this.h);i.lineTo(d,this.h/2)}else if(this.connector==="collapsed+"){i.moveTo(e,
this.h/2);i.lineTo(d,this.h/2);if(d-e>4){i.moveTo(f-2,this.h/2-5);i.lineTo(f+2,this.h/2);i.lineTo(f-2,this.h/2+5)}}else if(this.connector==="collapsed-"){i.moveTo(e,this.h/2);i.lineTo(d,this.h/2);if(d-e>4){i.moveTo(f+2,this.h/2-5);i.lineTo(f-2,this.h/2);i.lineTo(f+2,this.h/2+5)}}else{i.moveTo(e,this.h/2);i.lineTo(d,this.h/2)}e=makeElementNS(NS_SVG,"path",null,{d:i.toPathData(),fill:"none",stroke:"black",strokeWidth:"1px"});a.appendChild(e)}}return a};GroupGlyph.prototype.min=function(){return this.coverage.min()};
GroupGlyph.prototype.max=function(){return this.coverage.max()};GroupGlyph.prototype.height=function(){return this.h};function LineGraphGlyph(a,b,c){this.points=a;this.color=b;this._height=c||50}LineGraphGlyph.prototype.min=function(){return this.points[0]};LineGraphGlyph.prototype.max=function(){return this.points[this.points.length-2]};LineGraphGlyph.prototype.height=function(){return this._height};
LineGraphGlyph.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=0.1;a.beginPath();for(var b=0;b<=this._height;b+=10){a.moveTo(-5000,b);a.lineTo(5E3,b)}a.stroke();a.strokeStyle=this.color;a.lineWidth=2;a.beginPath();for(var c=0;c<this.points.length;c+=2){var d=this.points[c];b=this.points[c+1];c==0?a.moveTo(d,b):a.lineTo(d,b)}a.stroke();a.restore()};
LineGraphGlyph.prototype.toSVG=function(){for(var a=new SVGPath,b=0;b<this.points.length;b+=2){var c=this.points[b],d=this.points[b+1];b==0?a.moveTo(c,d):a.lineTo(c,d)}return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,strokeWidth:"2px"})};function LabelledGlyph(a,b){this.glyph=a;this.text=b;this.textLen=GLOBAL_GC.measureText(b).width+10;this.bump=a.bump}
LabelledGlyph.prototype.toSVG=function(){return makeElementNS(NS_SVG,"g",[this.glyph.toSVG(),makeElementNS(NS_SVG,"text",this.text,{x:this.glyph.min(),y:this.glyph.height()+15})])};LabelledGlyph.prototype.min=function(){return this.glyph.min()};LabelledGlyph.prototype.max=function(){return Math.max(this.glyph.max(),1*this.glyph.min()+this.textLen)};LabelledGlyph.prototype.height=function(){return this.glyph.height()+20};
LabelledGlyph.prototype.draw=function(a){this.glyph.draw(a);a.fillStyle="black";a.fillText(this.text,this.glyph.min(),this.glyph.height()+15)};function CrossGlyph(a,b,c){this._x=a;this._height=b;this._stroke=c}CrossGlyph.prototype.draw=function(a){var b=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-b,b);a.lineTo(this._x+b,b);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};
CrossGlyph.prototype.toSVG=function(){var a=this._height/2,b=new SVGPath;b.moveTo(this._x,0);b.lineTo(this._x,this._height);b.moveTo(this._x-a,a);b.lineTo(this._x+a,a);return makeElementNS(NS_SVG,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};CrossGlyph.prototype.min=function(){return this._x-this._height/2};CrossGlyph.prototype.max=function(){return this._x+this._height/2};CrossGlyph.prototype.height=function(){return this._height};
function ExGlyph(a,b,c){this._x=a;this._height=b;this._stroke=c}ExGlyph.prototype.draw=function(a){var b=this._height/2;a.beginPath();a.moveTo(this._x-b,0);a.lineTo(this._x+b,this._height);a.moveTo(this._x-b,this._height);a.lineTo(this._x+b,0);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};
ExGlyph.prototype.toSVG=function(){var a=this._height/2,b=new SVGPath;b.moveTo(this._x-a,0);b.lineTo(this._x+a,this._height);b.moveTo(this._x-a,this._height);b.lineTo(this._x+a,0);return makeElementNS(NS_SVG,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};ExGlyph.prototype.min=function(){return this._x-this._height/2};ExGlyph.prototype.max=function(){return this._x+this._height/2};ExGlyph.prototype.height=function(){return this._height};
function TriangleGlyph(a,b,c,d,e){this._x=a;this._height=b;this._dir=c;this._width=d;this._stroke=e}
TriangleGlyph.prototype.drawPath=function(a){var b=this._height/2,c=this._width/2;if(this._dir==="S"){a.moveTo(this._x,this._height);a.lineTo(this._x-c,0);a.lineTo(this._x+c,0)}else if(this._dir==="W"){a.moveTo(this._x+c,b);a.lineTo(this._x-c,0);a.lineTo(this._x-c,this._height)}else if(this._dir==="E"){a.moveTo(this._x-c,b);a.lineTo(this._x+c,0);a.lineTo(this._x+c,this._height)}else{a.moveTo(this._x,0);a.lineTo(this._x+c,this._height);a.lineTo(this._x-c,this._height)}a.closePath()};
TriangleGlyph.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.fillStyle=this._stroke;a.fill()};TriangleGlyph.prototype.toSVG=function(){var a=new SVGPath;this.drawPath(a);return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:this._stroke})};TriangleGlyph.prototype.min=function(){return this._x-this._height/2};TriangleGlyph.prototype.max=function(){return this._x+this._height/2};TriangleGlyph.prototype.height=function(){return this._height};
function DotGlyph(a,b,c){this._x=a;this._height=b;this._stroke=c}DotGlyph.prototype.draw=function(a){var b=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,b,b,0,6.29);a.fill()};DotGlyph.prototype.toSVG=function(){var a=this._height/2;return makeElementNS(NS_SVG,"circle",null,{cx:this._x,cy:a,r:a,fill:this._stroke,strokeWidth:"1px"})};DotGlyph.prototype.min=function(){return this._x-this._height/2};DotGlyph.prototype.max=function(){return this._x+this._height/2};
DotGlyph.prototype.height=function(){return this._height};function PaddedGlyph(a,b,c){this.glyph=a;this._min=b;this._max=c;if(a)this.bump=a.bump}PaddedGlyph.prototype.draw=function(a){this.glyph&&this.glyph.draw(a)};PaddedGlyph.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():makeElementNS(NS_SVG,"g")};PaddedGlyph.prototype.min=function(){return this._min};PaddedGlyph.prototype.max=function(){return this._max};
PaddedGlyph.prototype.height=function(){return this.glyph?this.glyph.height():1};function AArrowGlyph(a,b,c,d,e,f){this._min=a;this._max=b;this._height=c;this._fill=d;this._stroke=e;this._ori=f}AArrowGlyph.prototype.min=function(){return this._min};AArrowGlyph.prototype.max=function(){return this._max};AArrowGlyph.prototype.height=function(){return this._height};
AArrowGlyph.prototype.makePath=function(a){var b=this._max,c=this._min,d=this._height,e=0,f=0,i=this._height+2,h=0.333333*this._height;if(this._ori)if(this._ori==="+")f=0.5*this._height;else if(this._ori==="-")e=0.5*this._height;if(b-c<i){c=(b+c-i)/2;b=c+i}a.moveTo(c+e,0+h);a.lineTo(b-f,0+h);a.lineTo(b-f,0);a.lineTo(b,0+this._height/2);a.lineTo(b-f,0+d);a.lineTo(b-f,0+h+h);a.lineTo(c+e,0+h+h);a.lineTo(c+e,0+d);a.lineTo(c,0+d/2);a.lineTo(c+e,0);a.lineTo(c+e,0+h)};
AArrowGlyph.prototype.draw=function(a){a.beginPath();this.makePath(a);if(this._fill){a.fillStyle=this._fill;a.fill()}if(this._stroke){a.strokeStyle=this._stroke;a.stroke()}};AArrowGlyph.prototype.toSVG=function(){var a=new SVGPath;this.makePath(a);return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:this._fill||"none",stroke:this._stroke||"none"})};function SpanGlyph(a,b,c,d){this._min=a;this._max=b;this._height=c;this._stroke=d}SpanGlyph.prototype.min=function(){return this._min};
SpanGlyph.prototype.max=function(){return this._max};SpanGlyph.prototype.height=function(){return this._height};SpanGlyph.prototype.drawPath=function(a){var b=this._min,c=this._max,d=this._height,e=d/2;a.moveTo(b,e);a.lineTo(c,e);a.moveTo(b,0);a.lineTo(b,d);a.moveTo(c,0);a.lineTo(c,d)};SpanGlyph.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;a.stroke()};
SpanGlyph.prototype.toSVG=function(){var a=new SVGPath;this.drawPath(a);return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"})};function LineGlyph(a,b,c,d,e,f){this._min=a;this._max=b;this._height=c;this._style=d;this._strand=e;this._stroke=f}LineGlyph.prototype.min=function(){return this._min};LineGlyph.prototype.max=function(){return this._max};LineGlyph.prototype.height=function(){return this._height};
LineGlyph.prototype.drawPath=function(a){var b=this._min,c=this._max,d=this._height,e=d/2;if(this._style==="hat"){a.moveTo(b,e);a.lineTo((b+c)/2,this._strand==="-"?d:0)}else a.moveTo(b,e);a.lineTo(c,e)};LineGlyph.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;if(this._style==="dashed"&&a.setLineDash){a.save();a.setLineDash([3]);a.stroke();a.restore()}else a.stroke()};
LineGlyph.prototype.toSVG=function(){var a=new SVGPath;this.drawPath(a);a={d:a.toPathData(),stroke:this._stroke||"none"};if(this._style==="dashed")a.strokeDasharray="3";return makeElementNS(NS_SVG,"path",null,a)};function PrimersGlyph(a,b,c,d,e){this._min=a;this._max=b;this._height=c;this._fill=d;this._stroke=e}PrimersGlyph.prototype.min=function(){return this._min};PrimersGlyph.prototype.max=function(){return this._max};PrimersGlyph.prototype.height=function(){return this._height};
PrimersGlyph.prototype.drawStemPath=function(a){var b=this._max,c=this._height/2;a.moveTo(this._min,c);a.lineTo(b,c)};PrimersGlyph.prototype.drawTrigsPath=function(a){var b=this._min,c=this._max,d=this._height,e=d/2;a.moveTo(b,0);a.lineTo(b+d,e);a.lineTo(b,d);a.lineTo(b,0);a.moveTo(c,0);a.lineTo(c-d,e);a.lineTo(c,d);a.lineTo(c,0)};
PrimersGlyph.prototype.draw=function(a){a.beginPath();this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};PrimersGlyph.prototype.toSVG=function(){var a=new SVGPath;this.drawStemPath(a);var b=new SVGPath;this.drawTrigsPath(b);return makeElementNS(NS_SVG,"g",[makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"}),makeElementNS(NS_SVG,"path",null,{d:b.toPathData(),fill:this._fill||"none"})])};
function ArrowGlyph(a,b,c,d,e,f,i){this._min=a;this._max=b;this._height=c;this._color=d;this._parallel=e;this._sw=f;this._ne=i}ArrowGlyph.prototype.min=function(){return this._min};ArrowGlyph.prototype.max=function(){return this._max};ArrowGlyph.prototype.height=function(){return this._height};
ArrowGlyph.prototype.drawPath=function(a){var b=this._min,c=this._max,d=this._height;if(this._parallel){var e=d/2,f=0.4*d;if(this._sw){a.moveTo(b+e,d-f);a.lineTo(b+e,d);a.lineTo(b,e);a.lineTo(b+e,0);a.lineTo(b+e,f)}else{a.moveTo(b,d-f);a.lineTo(b,f)}if(this._ne){a.lineTo(c-e,f);a.lineTo(c-e,0);a.lineTo(c,e);a.lineTo(c-e,d);a.lineTo(c-e,d-f)}else{a.lineTo(c,f);a.lineTo(c,d-f)}}else{e=(b+c)/2;f=0.4*(c-b);var i=d/3;if(this._ne){a.moveTo(b+f,i);a.lineTo(b,i);a.lineTo(e,0);a.lineTo(c,i);a.lineTo(c-f,i)}else{a.moveTo(b+
f,0);a.lineTo(c-f,0)}if(this._sw){a.lineTo(c-f,d-i);a.lineTo(c,d-i);a.lineTo(e,d);a.lineTo(b,d-i);a.lineTo(b+f,d-i)}else{a.lineTo(c-f,d);a.lineTo(b+f,d)}}a.closePath()};ArrowGlyph.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.fillStyle=this._color;a.fill()};ArrowGlyph.prototype.toSVG=function(){var a=new SVGPath;this.drawPath(a);return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:this._color})};
function TooManyGlyph(a,b,c,d,e){this._min=a;this._max=b;this._height=c;this._fill=d;this._stroke=e}TooManyGlyph.prototype.min=function(){return this._min};TooManyGlyph.prototype.max=function(){return this._max};TooManyGlyph.prototype.height=function(){return this._height};TooManyGlyph.prototype.toSVG=function(){return makeElementNS(NS_SVG,"rect",null,{x:this._min,y:0,width:this._max-this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};
TooManyGlyph.prototype.draw=function(a){if(this._fill){a.fillStyle=this._fill;a.fillRect(this._min,0,this._max-this._min,this._height)}if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();for(var b=2;b<this._height;b+=3){a.moveTo(this._min,b);a.lineTo(this._max,b)}a.stroke()}};function TextGlyph(a,b,c,d,e){this._min=a;this._max=b;this._height=c;this._fill=d;this._string=e;this._textLen=GLOBAL_GC.measureText(e).width}
TextGlyph.prototype.min=function(){return this._min};TextGlyph.prototype.max=function(){return Math.max(this._max,this._min+this._textLen)};TextGlyph.prototype.height=function(){return this._height};TextGlyph.prototype.draw=function(a){a.fillStyle=this._fill;a.fillText(this._string,this._min,this._height-4)};TextGlyph.prototype.toSVG=function(){return makeElementNS(NS_SVG,"text",this._string,{x:this._min,y:this._height-4})};
function SequenceGlyph(a,b,c,d,e){this._min=a;this._max=b;this._height=c;this._seq=d;this._ref=e}SequenceGlyph.prototype.min=function(){return this._min};SequenceGlyph.prototype.max=function(){return this._max};SequenceGlyph.prototype.height=function(){return this._height};
SequenceGlyph.prototype.draw=function(a){for(var b=this._seq,c=(this._max-this._min+1)/this._seq.length,d=0;d<b.length;++d){var e=b.substr(d,1).toUpperCase(),f=baseColors[e];f||(f="gray");a.fillStyle=f;c>=8?a.fillText(e,this._min+d*c,8):a.fillRect(this._min+d*c,0,c,this._height)}};
SequenceGlyph.prototype.toSVG=function(){for(var a=this._seq,b=(this._max-this._min+1)/this._seq.length,c=makeElementNS(NS_SVG,"g"),d=0;d<a.length;++d){var e=a.substr(d,1).toUpperCase(),f=baseColors[e];f||(f="gray");b>=8?c.appendChild(makeElementNS(NS_SVG,"text",e,{x:this._min+d*b,y:8,fill:f})):c.appendChild(makeElementNS(NS_SVG,"rect",null,{x:this._min+d*b,y:0,width:b,height:this._height,fill:f}))}return c};function PointGlyph(a,b,c){this._x=a;this._y=b;this._height=c}
PointGlyph.prototype.min=function(){return this._x-2};PointGlyph.prototype.max=function(){return this._x+2};PointGlyph.prototype.height=function(){return this._height};PointGlyph.prototype.draw=function(a){a.fillStyle="black";a.beginPath();a.arc(this._x,this._y,2,0,6.29);a.fill()};PointGlyph.prototype.toSVG=function(){return makeElementNS(NS_SVG,"g")};
Browser.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+this.cookieKey+".view-start"];delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+this.cookieKey+".sources"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]};
Browser.prototype.storeStatus=function(){if(!(!this.cookieKey||this.noPersist)){localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr;localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0;localStorage["dalliance."+this.cookieKey+".view-end"]=this.viewEnd|0;if(this.currentSeqMax)localStorage["dalliance."+this.cookieKey+".current-seq-length"]=this.currentSeqMax;for(var a=[],b=0;b<this.tiers.length;++b)this.tiers[b].dasSource.noPersist||a.push(this.tiers[b].dasSource);localStorage["dalliance."+
this.cookieKey+".sources"]=JSON.stringify(a);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=this.reverseScrolling;localStorage["dalliance."+this.cookieKey+".version"]=VERSION.CONFIG}};
Browser.prototype.restoreStatus=function(){if(!this.noPersist){var a=localStorage["dalliance."+this.cookieKey+".version"];a=a?a|0:-100;if(VERSION.CONFIG==a){a=localStorage["dalliance."+this.cookieKey+".configHash"]||"";var b=hex_sha1(miniJSONify(this.sources));if(b!=a)localStorage["dalliance."+this.cookieKey+".configHash"]=b;else{a=localStorage["dalliance."+this.cookieKey+".view-chr"];b=localStorage["dalliance."+this.cookieKey+".view-start"]|0;var c=localStorage["dalliance."+this.cookieKey+".view-end"]|
0;if(a&&b&&c){this.chr=a;this.viewStart=b;this.viewEnd=c;if(a=localStorage["dalliance."+this.cookieKey+".current-seq-length"])this.currentSeqMax=a|0}this.reverseScrolling=(a=localStorage["dalliance."+this.cookieKey+".reverse-scrolling"])&&a=="true";if(a=localStorage["dalliance."+this.cookieKey+".sources"])this.sources=JSON.parse(a)}}}};
var MAX_WBITS=15,DEF_WBITS=MAX_WBITS,MAX_MEM_LEVEL=9,MANY=1440,BMAX=15,PRESET_DICT=32,Z_NO_FLUSH=0,Z_PARTIAL_FLUSH=1,Z_SYNC_FLUSH=2,Z_FULL_FLUSH=3,Z_FINISH=4,Z_DEFLATED=8,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_ERRNO=-1,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_VERSION_ERROR=-6,METHOD=0,FLAG=1,DICT4=2,DICT3=3,DICT2=4,DICT1=5,DICT0=6,BLOCKS=7,CHECK4=8,CHECK3=9,CHECK2=10,CHECK1=11,DONE=12,BAD=13,inflate_mask=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],
IB_TYPE=0,IB_LENS=1,IB_STORED=2,IB_TABLE=3,IB_BTREE=4,IB_DTREE=5,IB_CODES=6,IB_DRY=7,IB_DONE=8,IB_BAD=9,fixed_bl=9,fixed_bd=5,fixed_tl=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,
7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,
9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,
125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,
82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,
8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,
0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,
9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],fixed_td=[80,
5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,
129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function ZStream(){}ZStream.prototype.inflateInit=function(a,b){a||(a=DEF_WBITS);if(b)b=false;this.istate=new Inflate;return this.istate.inflateInit(this,b?-a:a)};ZStream.prototype.inflate=function(a){if(this.istate==null)return Z_STREAM_ERROR;return this.istate.inflate(this,a)};
ZStream.prototype.inflateEnd=function(){if(this.istate==null)return Z_STREAM_ERROR;var a=istate.inflateEnd(this);this.istate=null;return a};ZStream.prototype.inflateSync=function(){return istate.inflateSync(this)};ZStream.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};function Inflate(){this.was=[0]}
Inflate.prototype.inflateReset=function(a){if(a==null||a.istate==null)return Z_STREAM_ERROR;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=a.istate.nowrap!=0?BLOCKS:METHOD;a.istate.blocks.reset(a,null);return Z_OK};Inflate.prototype.inflateEnd=function(a){this.blocks!=null&&this.blocks.free(a);this.blocks=null;return Z_OK};
Inflate.prototype.inflateInit=function(a,b){this.blocks=a.msg=null;nowrap=0;if(b<0){b=-b;nowrap=1}if(b<8||b>15){this.inflateEnd(a);return Z_STREAM_ERROR}this.wbits=b;a.istate.blocks=new InfBlocks(a,a.istate.nowrap!=0?null:this,1<<b);this.inflateReset(a);return Z_OK};
Inflate.prototype.inflate=function(a,b){var c,d;if(a==null||a.istate==null||a.next_in==null)return Z_STREAM_ERROR;b=b==Z_FINISH?Z_BUF_ERROR:Z_OK;for(c=Z_BUF_ERROR;;)switch(a.istate.mode){case METHOD:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;if(((a.istate.method=a.next_in[a.next_in_index++])&15)!=Z_DEFLATED){a.istate.mode=BAD;a.msg="unknown compression method";a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=BAD;a.msg="invalid window size";a.istate.marker=
5;break}a.istate.mode=FLAG;case FLAG:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;d=a.next_in[a.next_in_index++]&255;if(((a.istate.method<<8)+d)%31!=0){a.istate.mode=BAD;a.msg="incorrect header check";a.istate.marker=5;break}if((d&PRESET_DICT)==0){a.istate.mode=BLOCKS;break}a.istate.mode=DICT4;case DICT4:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=DICT3;case DICT3:if(a.avail_in==0)return c;c=b;a.avail_in--;
a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=DICT2;case DICT2:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=DICT1;case DICT1:if(a.avail_in==0)return c;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;a.adler=a.istate.need;a.istate.mode=DICT0;return Z_NEED_DICT;case DICT0:a.istate.mode=BAD;a.msg="need dictionary";a.istate.marker=0;return Z_STREAM_ERROR;
case BLOCKS:c=a.istate.blocks.proc(a,c);if(c==Z_DATA_ERROR){a.istate.mode=BAD;a.istate.marker=0;break}if(c==Z_OK)c=b;if(c!=Z_STREAM_END)return c;c=b;a.istate.blocks.reset(a,a.istate.was);if(a.istate.nowrap!=0){a.istate.mode=DONE;break}a.istate.mode=CHECK4;case CHECK4:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=CHECK3;case CHECK3:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&
255)<<16&16711680;a.istate.mode=CHECK2;case CHECK2:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=CHECK1;case CHECK1:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;if(a.istate.was[0]!=a.istate.need){a.istate.mode=BAD;a.msg="incorrect data check";a.istate.marker=5;break}a.istate.mode=DONE;case DONE:return Z_STREAM_END;case BAD:return Z_DATA_ERROR;default:return Z_STREAM_ERROR}};
Inflate.prototype.inflateSetDictionary=function(a,b,c){var d=0,e=c;if(a==null||a.istate==null||a.istate.mode!=DICT0)return Z_STREAM_ERROR;if(a._adler.adler32(1,b,0,c)!=a.adler)return Z_DATA_ERROR;a.adler=a._adler.adler32(0,null,0,0);if(e>=1<<a.istate.wbits){e=(1<<a.istate.wbits)-1;d=c-e}a.istate.blocks.set_dictionary(b,d,e);a.istate.mode=BLOCKS;return Z_OK};var mark=[0,0,255,255];
Inflate.prototype.inflateSync=function(a){var b,c,d;if(a==null||a.istate==null)return Z_STREAM_ERROR;if(a.istate.mode!=BAD){a.istate.mode=BAD;a.istate.marker=0}if((b=a.avail_in)==0)return Z_BUF_ERROR;c=a.next_in_index;for(d=a.istate.marker;b!=0&&d<4;){if(a.next_in[c]==mark[d])d++;else d=a.next_in[c]!=0?0:4-d;c++;b--}a.total_in+=c-a.next_in_index;a.next_in_index=c;a.avail_in=b;a.istate.marker=d;if(d!=4)return Z_DATA_ERROR;b=a.total_in;c=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=c;a.istate.mode=
BLOCKS;return Z_OK};Inflate.prototype.inflateSyncPoint=function(a){if(a==null||a.istate==null||a.istate.blocks==null)return Z_STREAM_ERROR;return a.istate.blocks.sync_point()};var INFBLOCKS_BORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];
function InfBlocks(a,b,c){this.hufts=new Int32Array(MANY*3);this.window=new Uint8Array(c);this.end=c;this.checkfn=b;this.mode=IB_TYPE;this.reset(a,null);this.index=this.table=this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=new Int32Array(1);this.codes=new InfCodes;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new InfTree}
InfBlocks.prototype.reset=function(a,b){if(b)b[0]=this.check;this.mode==IB_CODES&&this.codes.free(a);this.mode=IB_TYPE;this.read=this.write=this.bitb=this.bitk=0;if(this.checkfn)a.adler=this.check=a._adler.adler32(0,null,0,0)};
InfBlocks.prototype.proc=function(a,b){var c,d,e,f,i,h,j;f=a.next_in_index;i=a.avail_in;d=this.bitb;e=this.bitk;h=this.write;for(j=h<this.read?this.read-h-1:this.end-h;;)switch(this.mode){case IB_TYPE:for(;e<3;){if(i!=0)b=Z_OK;else{this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,b)}i--;d|=(a.next_in[f++]&255)<<e;e+=8}c=d&7;this.last=c&1;switch(c>>>1){case 0:d>>>=3;e-=3;c=e&7;d>>>=c;e-=c;this.mode=IB_LENS;break;case 1:var l=
new Int32Array(1),p=new Int32Array(1),m=[],r=[];inflate_trees_fixed(l,p,m,r,a);this.codes.init(l[0],p[0],m[0],0,r[0],0,a);d>>>=3;e-=3;this.mode=IB_CODES;break;case 2:d>>>=3;e-=3;this.mode=IB_TABLE;break;case 3:d>>>=3;e-=3;this.mode=BAD;a.msg="invalid block type";b=Z_DATA_ERROR;this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,b)}break;case IB_LENS:for(;e<32;){if(i!=0)b=Z_OK;else{this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=
f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,b)}i--;d|=(a.next_in[f++]&255)<<e;e+=8}if((~d>>>16&65535)!=(d&65535)){this.mode=BAD;a.msg="invalid stored block lengths";b=Z_DATA_ERROR;this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,b)}this.left=d&65535;d=e=0;this.mode=left!=0?IB_STORED:this.last!=0?IB_DRY:IB_TYPE;break;case IB_STORED:if(i==0){this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=
f-a.next_in_index;a.next_in_index=f;write=h;return this.inflate_flush(a,b)}if(j==0){if(h==end&&read!=0){h=0;j=h<this.read?this.read-h-1:this.end-h}if(j==0){this.write=h;b=this.inflate_flush(a,b);h=this.write;j=h<this.read?this.read-h-1:this.end-h;if(h==this.end&&this.read!=0){h=0;j=h<this.read?this.read-h-1:this.end-h}if(j==0){this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,b)}}}b=Z_OK;c=this.left;if(c>i)c=i;if(c>j)c=j;
arrayCopy(a.next_in,f,window,h,c);f+=c;i-=c;h+=c;j-=c;if((this.left-=c)!=0)break;this.mode=this.last!=0?IB_DRY:IB_TYPE;break;case IB_TABLE:for(;e<14;){if(i!=0)b=Z_OK;else{this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,b)}i--;d|=(a.next_in[f++]&255)<<e;e+=8}this.table=c=d&16383;if((c&31)>29||(c>>5&31)>29){this.mode=IB_BAD;a.msg="too many length or distance symbols";b=Z_DATA_ERROR;this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=
f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,b)}c=258+(c&31)+(c>>5&31);if(this.blens==null||this.blens.length<c)this.blens=new Int32Array(c);else for(j=0;j<c;j++)this.blens[j]=0;d>>>=14;e-=14;this.index=0;mode=IB_BTREE;case IB_BTREE:for(;this.index<4+(this.table>>>10);){for(;e<3;){if(i!=0)b=Z_OK;else{this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,b)}i--;d|=(a.next_in[f++]&255)<<e;e+=8}this.blens[INFBLOCKS_BORDER[this.index++]]=
d&7;d>>>=3;e-=3}for(;this.index<19;)this.blens[INFBLOCKS_BORDER[this.index++]]=0;this.bb[0]=7;c=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a);if(c!=Z_OK){b=c;if(b==Z_DATA_ERROR){this.blens=null;this.mode=IB_BAD}this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=f;write=h;return this.inflate_flush(a,b)}this.index=0;this.mode=IB_DTREE;case IB_DTREE:for(;;){c=this.table;if(!(this.index<258+(c&31)+(c>>5&31)))break;for(c=this.bb[0];e<c;){if(i!=
0)b=Z_OK;else{this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,b)}i--;d|=(a.next_in[f++]&255)<<e;e+=8}c=this.hufts[(this.tb[0]+(d&inflate_mask[c]))*3+1];p=this.hufts[(this.tb[0]+(d&inflate_mask[c]))*3+2];if(p<16){d>>>=c;e-=c;this.blens[this.index++]=p}else{j=p==18?7:p-14;for(l=p==18?11:3;e<c+j;){if(i!=0)b=Z_OK;else{this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,
b)}i--;d|=(a.next_in[f++]&255)<<e;e+=8}d>>>=c;e-=c;l+=d&inflate_mask[j];d>>>=j;e-=j;j=this.index;c=this.table;if(j+l>258+(c&31)+(c>>5&31)||p==16&&j<1){this.blens=null;this.mode=IB_BAD;a.msg="invalid bit length repeat";b=Z_DATA_ERROR;this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,b)}p=p==16?this.blens[j-1]:0;do this.blens[j++]=p;while(--l!=0);this.index=j}}this.tb[0]=-1;l=new Int32Array(1);p=new Int32Array(1);m=new Int32Array(1);
r=new Int32Array(1);l[0]=9;p[0]=6;c=this.table;c=this.inftree.inflate_trees_dynamic(257+(c&31),1+(c>>5&31),this.blens,l,p,m,r,this.hufts,a);if(c!=Z_OK){if(c==Z_DATA_ERROR){this.blens=null;this.mode=BAD}b=c;this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,b)}this.codes.init(l[0],p[0],this.hufts,m[0],this.hufts,r[0],a);this.mode=IB_CODES;case IB_CODES:this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=
f;this.write=h;if((b=this.codes.proc(this,a,b))!=Z_STREAM_END)return this.inflate_flush(a,b);b=Z_OK;this.codes.free(a);f=a.next_in_index;i=a.avail_in;d=this.bitb;e=this.bitk;h=this.write;j=h<this.read?this.read-h-1:this.end-h;if(this.last==0){this.mode=IB_TYPE;break}this.mode=IB_DRY;case IB_DRY:this.write=h;b=this.inflate_flush(a,b);h=this.write;if(this.read!=this.write){this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,b)}mode=
DONE;case IB_DONE:b=Z_STREAM_END;this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,b);case IB_BAD:b=Z_DATA_ERROR;this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,b);default:b=Z_STREAM_ERROR;this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=f-a.next_in_index;a.next_in_index=f;this.write=h;return this.inflate_flush(a,b)}};
InfBlocks.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};InfBlocks.prototype.set_dictionary=function(a,b,c){arrayCopy(a,b,window,0,c);this.read=this.write=c};InfBlocks.prototype.sync_point=function(){return this.mode==IB_LENS};
InfBlocks.prototype.inflate_flush=function(a,b){var c,d,e;d=a.next_out_index;e=this.read;c=(e<=this.write?this.write:this.end)-e;if(c>a.avail_out)c=a.avail_out;if(c!=0&&b==Z_BUF_ERROR)b=Z_OK;a.avail_out-=c;a.total_out+=c;if(this.checkfn!=null)a.adler=this.check=a._adler.adler32(this.check,this.window,e,c);arrayCopy(this.window,e,a.next_out,d,c);d+=c;e+=c;if(e==this.end){e=0;if(this.write==this.end)this.write=0;c=this.write-e;if(c>a.avail_out)c=a.avail_out;if(c!=0&&b==Z_BUF_ERROR)b=Z_OK;a.avail_out-=
c;a.total_out+=c;if(this.checkfn!=null)a.adler=this.check=a._adler.adler32(this.check,this.window,e,c);arrayCopy(this.window,e,a.next_out,d,c);d+=c;e+=c}a.next_out_index=d;this.read=e;return b};var IC_START=0,IC_LEN=1,IC_LENEXT=2,IC_DIST=3,IC_DISTEXT=4,IC_COPY=5,IC_LIT=6,IC_WASH=7,IC_END=8,IC_BADCODE=9;function InfCodes(){}InfCodes.prototype.init=function(a,b,c,d,e,f){this.mode=IC_START;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=d;this.dtree=e;this.dtree_index=f;this.tree=null};
InfCodes.prototype.proc=function(a,b,c){var d,e,f=0,i=0,h=0,j,l,p;h=b.next_in_index;j=b.avail_in;f=a.bitb;i=a.bitk;l=a.write;for(p=l<a.read?a.read-l-1:a.end-l;;)switch(this.mode){case IC_START:if(p>=258&&j>=10){a.bitb=f;a.bitk=i;b.avail_in=j;b.total_in+=h-b.next_in_index;b.next_in_index=h;a.write=l;c=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,b);h=b.next_in_index;j=b.avail_in;f=a.bitb;i=a.bitk;l=a.write;p=l<a.read?a.read-l-1:a.end-l;if(c!=Z_OK){this.mode=
c==Z_STREAM_END?IC_WASH:IC_BADCODE;break}}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=IC_LEN;case IC_LEN:for(d=this.need;i<d;){if(j!=0)c=Z_OK;else{a.bitb=f;a.bitk=i;b.avail_in=j;b.total_in+=h-b.next_in_index;b.next_in_index=h;a.write=l;return a.inflate_flush(b,c)}j--;f|=(b.next_in[h++]&255)<<i;i+=8}d=(this.tree_index+(f&inflate_mask[d]))*3;f>>>=this.tree[d+1];i-=this.tree[d+1];e=this.tree[d];if(e==0){this.lit=this.tree[d+2];this.mode=IC_LIT;break}if((e&16)!=
0){this.get=e&15;this.len=this.tree[d+2];this.mode=IC_LENEXT;break}if((e&64)==0){this.need=e;this.tree_index=d/3+this.tree[d+2];break}if((e&32)!=0){this.mode=IC_WASH;break}this.mode=IC_BADCODE;b.msg="invalid literal/length code";c=Z_DATA_ERROR;a.bitb=f;a.bitk=i;b.avail_in=j;b.total_in+=h-b.next_in_index;b.next_in_index=h;a.write=l;return a.inflate_flush(b,c);case IC_LENEXT:for(d=this.get;i<d;){if(j!=0)c=Z_OK;else{a.bitb=f;a.bitk=i;b.avail_in=j;b.total_in+=h-b.next_in_index;b.next_in_index=h;a.write=
l;return a.inflate_flush(b,c)}j--;f|=(b.next_in[h++]&255)<<i;i+=8}this.len+=f&inflate_mask[d];f>>=d;i-=d;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=IC_DIST;case IC_DIST:for(d=this.need;i<d;){if(j!=0)c=Z_OK;else{a.bitb=f;a.bitk=i;b.avail_in=j;b.total_in+=h-b.next_in_index;b.next_in_index=h;a.write=l;return a.inflate_flush(b,c)}j--;f|=(b.next_in[h++]&255)<<i;i+=8}d=(this.tree_index+(f&inflate_mask[d]))*3;f>>=this.tree[d+1];i-=this.tree[d+1];e=this.tree[d];if((e&
16)!=0){this.get=e&15;this.dist=this.tree[d+2];this.mode=IC_DISTEXT;break}if((e&64)==0){this.need=e;this.tree_index=d/3+this.tree[d+2];break}this.mode=IC_BADCODE;b.msg="invalid distance code";c=Z_DATA_ERROR;a.bitb=f;a.bitk=i;b.avail_in=j;b.total_in+=h-b.next_in_index;b.next_in_index=h;a.write=l;return a.inflate_flush(b,c);case IC_DISTEXT:for(d=this.get;i<d;){if(j!=0)c=Z_OK;else{a.bitb=f;a.bitk=i;b.avail_in=j;b.total_in+=h-b.next_in_index;b.next_in_index=h;a.write=l;return a.inflate_flush(b,c)}j--;
f|=(b.next_in[h++]&255)<<i;i+=8}this.dist+=f&inflate_mask[d];f>>=d;i-=d;this.mode=IC_COPY;case IC_COPY:for(d=l-this.dist;d<0;)d+=a.end;for(;this.len!=0;){if(p==0){if(l==a.end&&a.read!=0){l=0;p=l<a.read?a.read-l-1:a.end-l}if(p==0){a.write=l;c=a.inflate_flush(b,c);l=a.write;p=l<a.read?a.read-l-1:a.end-l;if(l==a.end&&a.read!=0){l=0;p=l<a.read?a.read-l-1:a.end-l}if(p==0){a.bitb=f;a.bitk=i;b.avail_in=j;b.total_in+=h-b.next_in_index;b.next_in_index=h;a.write=l;return a.inflate_flush(b,c)}}}a.window[l++]=
a.window[d++];p--;if(d==a.end)d=0;this.len--}this.mode=IC_START;break;case IC_LIT:if(p==0){if(l==a.end&&a.read!=0){l=0;p=l<a.read?a.read-l-1:a.end-l}if(p==0){a.write=l;c=a.inflate_flush(b,c);l=a.write;p=l<a.read?a.read-l-1:a.end-l;if(l==a.end&&a.read!=0){l=0;p=l<a.read?a.read-l-1:a.end-l}if(p==0){a.bitb=f;a.bitk=i;b.avail_in=j;b.total_in+=h-b.next_in_index;b.next_in_index=h;a.write=l;return a.inflate_flush(b,c)}}}c=Z_OK;a.window[l++]=this.lit;p--;this.mode=IC_START;break;case IC_WASH:if(i>7){i-=8;
j++;h--}a.write=l;c=a.inflate_flush(b,c);l=a.write;if(a.read!=a.write){a.bitb=f;a.bitk=i;b.avail_in=j;b.total_in+=h-b.next_in_index;b.next_in_index=h;a.write=l;return a.inflate_flush(b,c)}this.mode=IC_END;case IC_END:c=Z_STREAM_END;a.bitb=f;a.bitk=i;b.avail_in=j;b.total_in+=h-b.next_in_index;b.next_in_index=h;a.write=l;return a.inflate_flush(b,c);case IC_BADCODE:c=Z_DATA_ERROR;a.bitb=f;a.bitk=i;b.avail_in=j;b.total_in+=h-b.next_in_index;b.next_in_index=h;a.write=l;return a.inflate_flush(b,c);default:c=
Z_STREAM_ERROR;a.bitb=f;a.bitk=i;b.avail_in=j;b.total_in+=h-b.next_in_index;b.next_in_index=h;a.write=l;return a.inflate_flush(b,c)}};InfCodes.prototype.free=function(){};
InfCodes.prototype.inflate_fast=function(a,b,c,d,e,f,i,h){var j,l,p,m,r,s,o,q,t,v,u,x;s=h.next_in_index;o=h.avail_in;m=i.bitb;r=i.bitk;q=i.write;t=q<i.read?i.read-q-1:i.end-q;a=inflate_mask[a];v=inflate_mask[b];do{for(;r<20;){o--;m|=(h.next_in[s++]&255)<<r;r+=8}j=m&a;l=c;p=d;x=(p+j)*3;if((b=l[x])==0){m>>=l[x+1];r-=l[x+1];i.window[q++]=l[x+2];t--}else{do{m>>=l[x+1];r-=l[x+1];if((b&16)!=0){b&=15;u=l[x+2]+(m&inflate_mask[b]);m>>=b;for(r-=b;r<15;){o--;m|=(h.next_in[s++]&255)<<r;r+=8}j=m&v;l=e;p=f;x=(p+
j)*3;b=l[x];do{m>>=l[x+1];r-=l[x+1];if((b&16)!=0){for(b&=15;r<b;){o--;m|=(h.next_in[s++]&255)<<r;r+=8}j=l[x+2]+(m&inflate_mask[b]);m>>=b;r-=b;t-=u;if(q>=j){j=q-j;i.window[q++]=i.window[j++];i.window[q++]=i.window[j++];u-=2}else{j=q-j;do j+=i.end;while(j<0);b=i.end-j;if(u>b){u-=b;if(q-j>0&&b>q-j){do i.window[q++]=i.window[j++];while(--b!=0)}else{arrayCopy(i.window,j,i.window,q,b);q+=b}j=0}}do i.window[q++]=i.window[j++];while(--u!=0);break}else if((b&64)==0){j+=l[x+2];j+=m&inflate_mask[b];x=(p+j)*
3;b=l[x]}else{h.msg="invalid distance code";u=h.avail_in-o;u=r>>3<u?r>>3:u;o+=u;s-=u;r-=u<<3;i.bitb=m;i.bitk=r;h.avail_in=o;h.total_in+=s-h.next_in_index;h.next_in_index=s;i.write=q;return Z_DATA_ERROR}}while(1);break}if((b&64)==0){j+=l[x+2];j+=m&inflate_mask[b];x=(p+j)*3;if((b=l[x])==0){m>>=l[x+1];r-=l[x+1];i.window[q++]=l[x+2];t--;break}}else if((b&32)!=0){u=h.avail_in-o;u=r>>3<u?r>>3:u;o+=u;s-=u;r-=u<<3;i.bitb=m;i.bitk=r;h.avail_in=o;h.total_in+=s-h.next_in_index;h.next_in_index=s;i.write=q;return Z_STREAM_END}else{h.msg=
"invalid literal/length code";u=h.avail_in-o;u=r>>3<u?r>>3:u;o+=u;s-=u;r-=u<<3;i.bitb=m;i.bitk=r;h.avail_in=o;h.total_in+=s-h.next_in_index;h.next_in_index=s;i.write=q;return Z_DATA_ERROR}}while(1)}}while(t>=258&&o>=10);u=h.avail_in-o;u=r>>3<u?r>>3:u;o+=u;s-=u;r-=u<<3;i.bitb=m;i.bitk=r;h.avail_in=o;h.total_in+=s-h.next_in_index;h.next_in_index=s;i.write=q;return Z_OK};function InfTree(){}
InfTree.prototype.huft_build=function(a,b,c,d,e,f,i,h,j,l,p){var m,r,s,o,q,t,v,u,x;t=0;r=c;do{this.c[a[b+t]]++;t++;r--}while(r!=0);if(this.c[0]==c){i[0]=-1;h[0]=0;return Z_OK}q=h[0];for(s=1;s<=BMAX;s++)if(this.c[s]!=0)break;o=s;if(q<s)q=s;for(r=BMAX;r!=0;r--)if(this.c[r]!=0)break;l=r;if(q>r)q=r;h[0]=q;for(h=1<<s;s<r;s++,h<<=1)if((h-=this.c[s])<0)return Z_DATA_ERROR;if((h-=this.c[r])<0)return Z_DATA_ERROR;this.c[r]+=h;this.x[1]=s=0;t=1;for(v=2;--r!=0;){this.x[v]=s+=this.c[t];v++;t++}t=r=0;do{if((s=
a[b+t])!=0)this.v[this.x[s]++]=r;t++}while(++r<c);c=this.x[l];t=this.x[0]=r=0;b=-1;u=-q;for(x=v=this.u[0]=0;o<=l;o++)for(a=this.c[o];a--!=0;){for(;o>u+q;){b++;u+=q;x=l-u;x=x>q?q:x;if((m=1<<(s=o-u))>a+1){m-=a+1;v=o;if(s<x)for(;++s<x;){if((m<<=1)<=this.c[++v])break;m-=this.c[v]}}x=1<<s;if(this.hn[0]+x>MANY)return Z_DATA_ERROR;this.u[b]=v=this.hn[0];this.hn[0]+=x;if(b!=0){this.x[b]=r;this.r[0]=s;this.r[1]=q;s=r>>>u-q;this.r[2]=v-this.u[b-1]-s;arrayCopy(this.r,0,j,(this.u[b-1]+s)*3,3)}else i[0]=v}this.r[1]=
o-u;if(t>=c)this.r[0]=192;else if(p[t]<d){this.r[0]=this.v[t]<256?0:96;this.r[2]=this.v[t++]}else{this.r[0]=f[this.v[t]-d]+16+64;this.r[2]=e[this.v[t++]-d]}m=1<<o-u;for(s=r>>>u;s<x;s+=m)arrayCopy(this.r,0,j,(v+s)*3,3);for(s=1<<o-1;(r&s)!=0;s>>>=1)r^=s;r^=s;for(s=(1<<u)-1;(r&s)!=this.x[b];){b--;u-=q;s=(1<<u)-1}}return h!=0&&l!=1?Z_BUF_ERROR:Z_OK};
InfTree.prototype.inflate_trees_bits=function(a,b,c,d,e){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,d,this.hn,this.v);if(a==Z_DATA_ERROR)e.msg="oversubscribed dynamic bit lengths tree";else if(a==Z_BUF_ERROR||b[0]==0){e.msg="incomplete dynamic bit lengths tree";a=Z_DATA_ERROR}return a};
InfTree.prototype.inflate_trees_dynamic=function(a,b,c,d,e,f,i,h,j){this.initWorkArea(288);this.hn[0]=0;f=this.huft_build(c,0,a,257,cplens,cplext,f,d,h,this.hn,this.v);if(f!=Z_OK||d[0]==0){if(f==Z_DATA_ERROR)j.msg="oversubscribed literal/length tree";else if(f!=Z_MEM_ERROR){j.msg="incomplete literal/length tree";f=Z_DATA_ERROR}return f}this.initWorkArea(288);f=this.huft_build(c,a,b,0,cpdist,cpdext,i,e,h,this.hn,this.v);if(f!=Z_OK||e[0]==0&&a>257){if(f==Z_DATA_ERROR)j.msg="oversubscribed distance tree";
else if(f==Z_BUF_ERROR){j.msg="incomplete distance tree";f=Z_DATA_ERROR}else if(f!=Z_MEM_ERROR){j.msg="empty distance tree with lengths";f=Z_DATA_ERROR}return f}return Z_OK};function inflate_trees_fixed(a,b,c,d){a[0]=fixed_bl;b[0]=fixed_bd;c[0]=fixed_tl;d[0]=fixed_td;return Z_OK}
InfTree.prototype.initWorkArea=function(a){if(this.hn==null){this.hn=new Int32Array(1);this.v=new Int32Array(a);this.c=new Int32Array(BMAX+1);this.r=new Int32Array(3);this.u=new Int32Array(BMAX);this.x=new Int32Array(BMAX+1)}if(this.v.length<a)this.v=new Int32Array(a);for(var b=0;b<a;b++)this.v[b]=0;for(b=0;b<BMAX+1;b++)this.c[b]=0;for(b=0;b<3;b++)this.r[b]=0;arrayCopy(this.c,0,this.u,0,BMAX);arrayCopy(this.c,0,this.x,0,BMAX+1)};
var testArray=new Uint8Array(1),hasSubarray=typeof testArray.subarray==="function",hasSlice=false;function arrayCopy(a,b,c,d,e){if(e!=0){if(a){if(!c)throw"Undef dest";}else throw"Undef src";if(b==0&&e==a.length)arrayCopy_fast(a,c,d);else if(hasSubarray)arrayCopy_fast(a.subarray(b,b+e),c,d);else a.BYTES_PER_ELEMENT==1&&e>100?arrayCopy_fast(new Uint8Array(a.buffer,a.byteOffset+b,e),c,d):arrayCopy_slow(a,b,c,d,e)}}function arrayCopy_slow(a,b,c,d,e){for(var f=0;f<e;++f)c[d+f]=a[b+f]}
function arrayCopy_fast(a,b,c){b.set(a,c)}var ADLER_BASE=65521,ADLER_NMAX=5552;
function adler32(a,b,c,d){if(b==null)return 1;var e=a&65535;a=a>>16&65535;for(var f;d>0;){f=d<ADLER_NMAX?d:ADLER_NMAX;for(d-=f;f>=16;){e+=b[c++]&255;a+=e;e+=b[c++]&255;a+=e;e+=b[c++]&255;a+=e;e+=b[c++]&255;a+=e;e+=b[c++]&255;a+=e;e+=b[c++]&255;a+=e;e+=b[c++]&255;a+=e;e+=b[c++]&255;a+=e;e+=b[c++]&255;a+=e;e+=b[c++]&255;a+=e;e+=b[c++]&255;a+=e;e+=b[c++]&255;a+=e;e+=b[c++]&255;a+=e;e+=b[c++]&255;a+=e;e+=b[c++]&255;a+=e;e+=b[c++]&255;a+=e;f-=16}if(f!=0){do{e+=b[c++]&255;a+=e}while(--f!=0)}e%=ADLER_BASE;
a%=ADLER_BASE}return a<<16|e}
function jszlib_inflate_buffer(a,b,c,d){a=b?new Uint8Array(a,b,c):new Uint8Array(a);c=new ZStream;c.inflateInit(DEF_WBITS,true);c.next_in=a;c.next_in_index=0;c.avail_in=a.length;a=[];for(var e=0;;){var f=new Uint8Array(32E3);c.next_out=f;c.next_out_index=0;c.avail_out=f.length;var i=c.inflate(Z_NO_FLUSH);if(i!=Z_OK&&i!=Z_STREAM_END)throw c.msg;if(c.avail_out!=0){var h=new Uint8Array(f.length-c.avail_out);arrayCopy(f,0,h,0,f.length-c.avail_out);f=h}a.push(f);e+=f.length;if(i==Z_STREAM_END)break}if(d)d[0]=
(b||0)+c.next_in_index;if(a.length==1)return a[0].buffer;else{b=new Uint8Array(e);for(c=d=0;c<a.length;++c){e=a[c];arrayCopy(e,0,b,d,e.length);d+=e.length}return b.buffer}}
(function(){function a(){r.call(document.querySelectorAll("input[type=range]"),c);(new MutationObserver(function(o){o.forEach(function(q){q.addedNodes&&r.call(q.addedNodes,function(t){b(t);t.childElementCount&&r.call(t.querySelectorAll("input"),b)})})})).observe(document,{childList:true,subtree:true})}function b(o){o.localName=="input"&&o.type!="range"&&o.getAttribute("type")=="range"&&c(o)}function c(o){function q(I){var S=(parseFloat(getComputedStyle(this,0).width)-j.width)/M;if(S){C+=(I.clientX-
G)/S;G=I.clientX;D=true;this.value=C}}function t(){this.removeEventListener("mousemove",q,true);this.removeEventListener("mouseup",t,true)}function v(){if(!z)this.style.boxShadow=!h?"0 0 0 2px #fb0":"inset 0 0 20px rgba(0,127,255,.1), 0 0 1px rgba(0,127,255,.4)"}function u(I){return!isNaN(I)&&+I==parseFloat(I)}function x(){B=u(o.min)?+o.min:0;P=u(o.max)?+o.max:100;if(P<B)P=B>100?B:100;Q=u(o.step)&&o.step>0?+o.step:1;M=P-B;y(true)}function y(I){if(!A&&!F)J=o.getAttribute("value");u(J)||(J=(B+P)/2);
J=Math.round((J-B)/Q)*Q+B;if(J<B)J=B;else if(J>P)J=B+~~(M/Q)*Q;D&&J!=E&&o.dispatchEvent(s);D=false;if(!(!I&&J==E)){E=J;d(o,{background:"-moz-element(#__sliderthumb__) "+(M?(J-B)/M*100:0)+"% no-repeat, "+l})}}var A,F,D,z,E,C,G,B,P,Q,M,J=o.value;if(!i){i=document.body.appendChild(document.createElement("hr"));d(i,{"-moz-appearance":h?"scale-horizontal":"scalethumb-horizontal",display:"block",visibility:"visible",opacity:1,position:"fixed",top:"-999999px"});document.mozSetImageElement("__sliderthumb__",
i)}var V=function(){return""+J};o.__defineGetter__("value",V);o.__defineSetter__("value",function I(S){J=""+S;A=true;y();delete o.value;o.value=J;o.__defineGetter__("value",V);o.__defineSetter__("value",I)});o.__defineGetter__("type",function(){return"range"});["min","max","step"].forEach(function(I){if(o.hasAttribute(I))F=true;o.__defineGetter__(I,function(){return this.hasAttribute(I)?this.getAttribute(I):""});o.__defineSetter__(I,function(S){S===null?this.removeAttribute(I):this.setAttribute(I,
S)})});o.readOnly=true;d(o,p);x();(new MutationObserver(function(I){I.forEach(function(S){if(S.attributeName!="value"){x();F=true}else if(!A){J=o.getAttribute("value");y()}})})).observe(o,m);o.addEventListener("mousedown",function(I){z=true;setTimeout(function(){z=false},0);if(!(I.button||!M)){var S=(parseFloat(getComputedStyle(this,0).width)-j.width)/M;if(S){var T=I.clientX-this.getBoundingClientRect().left-j.width/2-(J-B)*S;if(Math.abs(T)>j.radius){D=true;this.value-=-T/S}C=J;G=I.clientX;this.addEventListener("mousemove",
q,true);this.addEventListener("mouseup",t,true)}}},true);o.addEventListener("keydown",function(I){if(I.keyCode>36&&I.keyCode<41){v.call(this);D=true;this.value=J+(I.keyCode==38||I.keyCode==39?Q:-Q)}},true);o.addEventListener("focus",v,true);o.addEventListener("blur",function(){this.style.boxShadow=""},true)}function d(o,q){for(var t in q)o.style.setProperty(t,q[t],"important")}var e=document.createElement("input");try{e.type="range";if(e.type=="range")return}catch(f){return}e.style.background="linear-gradient(red, red)";
if(!(!e.style.backgroundImage||!("MozAppearance"in e.style)||!document.mozSetImageElement||!this.MutationObserver)){var i,h=navigator.platform=="MacIntel",j={radius:h?9:6,width:h?22:12,height:h?16:20},l="linear-gradient(transparent "+(h?"6px, #999 6px, #999 7px, #ccc 8px, #bbb 9px, #bbb 10px, transparent 10px":"9px, #999 9px, #bbb 10px, #fff 11px, transparent 11px")+", transparent)",p={"min-width":j.width+"px","min-height":j.height+"px","max-height":j.height+"px",padding:"0 0 "+(h?"2px":"1px"),border:0,
"border-radius":0,cursor:"default","text-indent":"-999999px"},m={attributes:true,attributeFilter:["min","max","step","value"]},r=Array.prototype.forEach,s=document.createEvent("HTMLEvents");s.initEvent("change",true,false);document.readyState=="loading"?document.addEventListener("DOMContentLoaded",a,true):a()}})();
